Global Const $bs_groupbox = 7
Global Const $bs_bottom = 2048
Global Const $bs_center = 768
Global Const $bs_defpushbutton = 1
Global Const $bs_left = 256
Global Const $bs_multiline = 8192
Global Const $bs_pushbox = 10
Global Const $bs_pushlike = 4096
Global Const $bs_right = 512
Global Const $bs_rightbutton = 32
Global Const $bs_top = 1024
Global Const $bs_vcenter = 3072
Global Const $bs_flat = 32768
Global Const $bs_icon = 64
Global Const $bs_bitmap = 128
Global Const $bs_notify = 16384
Global Const $bs_splitbutton = 12
Global Const $bs_defsplitbutton = 13
Global Const $bs_commandlink = 14
Global Const $bs_defcommandlink = 15
Global Const $bcsif_glyph = 1
Global Const $bcsif_image = 2
Global Const $bcsif_style = 4
Global Const $bcsif_size = 8
Global Const $bcss_nosplit = 1
Global Const $bcss_stretch = 2
Global Const $bcss_alignleft = 4
Global Const $bcss_image = 8
Global Const $button_imagelist_align_left = 0
Global Const $button_imagelist_align_right = 1
Global Const $button_imagelist_align_top = 2
Global Const $button_imagelist_align_bottom = 3
Global Const $button_imagelist_align_center = 4
Global Const $bs_3state = 5
Global Const $bs_auto3state = 6
Global Const $bs_autocheckbox = 3
Global Const $bs_checkbox = 2
Global Const $bs_radiobutton = 4
Global Const $bs_autoradiobutton = 9
Global Const $bs_ownerdraw = 11
Global Const $gui_ss_default_button = 0
Global Const $gui_ss_default_checkbox = 0
Global Const $gui_ss_default_group = 0
Global Const $gui_ss_default_radio = 0
Global Const $bcm_first = 5632
Global Const $bcm_getidealsize = ($bcm_first + 1)
Global Const $bcm_getimagelist = ($bcm_first + 3)
Global Const $bcm_getnote = ($bcm_first + 10)
Global Const $bcm_getnotelength = ($bcm_first + 11)
Global Const $bcm_getsplitinfo = ($bcm_first + 8)
Global Const $bcm_gettextmargin = ($bcm_first + 5)
Global Const $bcm_setdropdownstate = ($bcm_first + 6)
Global Const $bcm_setimagelist = ($bcm_first + 2)
Global Const $bcm_setnote = ($bcm_first + 9)
Global Const $bcm_setshield = ($bcm_first + 12)
Global Const $bcm_setsplitinfo = ($bcm_first + 7)
Global Const $bcm_settextmargin = ($bcm_first + 4)
Global Const $bm_click = 245
Global Const $bm_getcheck = 240
Global Const $bm_getimage = 246
Global Const $bm_getstate = 242
Global Const $bm_setcheck = 241
Global Const $bm_setdontclick = 248
Global Const $bm_setimage = 247
Global Const $bm_setstate = 243
Global Const $bm_setstyle = 244
Global Const $bcn_first = -1250
Global Const $bcn_dropdown = ($bcn_first + 2)
Global Const $bcn_hotitemchange = ($bcn_first + 1)
Global Const $bn_clicked = 0
Global Const $bn_paint = 1
Global Const $bn_hilite = 2
Global Const $bn_unhilite = 3
Global Const $bn_disable = 4
Global Const $bn_doubleclicked = 5
Global Const $bn_setfocus = 6
Global Const $bn_killfocus = 7
Global Const $bn_pushed = $bn_hilite
Global Const $bn_unpushed = $bn_unhilite
Global Const $bn_dblclk = $bn_doubleclicked
Global Const $bst_checked = 1
Global Const $bst_indeterminate = 2
Global Const $bst_unchecked = 0
Global Const $bst_focus = 8
Global Const $bst_pushed = 4
Global Const $bst_dontclick = 128
Global Const $gui_event_single = 0
Global Const $gui_event_array = 1
Global Const $gui_event_none = 0
Global Const $gui_event_close = -3
Global Const $gui_event_minimize = -4
Global Const $gui_event_restore = -5
Global Const $gui_event_maximize = -6
Global Const $gui_event_primarydown = -7
Global Const $gui_event_primaryup = -8
Global Const $gui_event_secondarydown = -9
Global Const $gui_event_secondaryup = -10
Global Const $gui_event_mousemove = -11
Global Const $gui_event_resized = -12
Global Const $gui_event_dropped = -13
Global Const $gui_rundefmsg = "GUI_RUNDEFMSG"
Global Const $gui_avistop = 0
Global Const $gui_avistart = 1
Global Const $gui_aviclose = 2
Global Const $gui_checked = 1
Global Const $gui_indeterminate = 2
Global Const $gui_unchecked = 4
Global Const $gui_dropaccepted = 8
Global Const $gui_nodropaccepted = 4096
Global Const $gui_acceptfiles = $gui_dropaccepted
Global Const $gui_show = 16
Global Const $gui_hide = 32
Global Const $gui_enable = 64
Global Const $gui_disable = 128
Global Const $gui_focus = 256
Global Const $gui_nofocus = 8192
Global Const $gui_defbutton = 512
Global Const $gui_expand = 1024
Global Const $gui_ontop = 2048
Global Const $gui_fontnormal = 0
Global Const $gui_fontitalic = 2
Global Const $gui_fontunder = 4
Global Const $gui_fontstrike = 8
Global Const $gui_dockauto = 1
Global Const $gui_dockleft = 2
Global Const $gui_dockright = 4
Global Const $gui_dockhcenter = 8
Global Const $gui_docktop = 32
Global Const $gui_dockbottom = 64
Global Const $gui_dockvcenter = 128
Global Const $gui_dockwidth = 256
Global Const $gui_dockheight = 512
Global Const $gui_docksize = 768
Global Const $gui_dockmenubar = 544
Global Const $gui_dockstatebar = 576
Global Const $gui_dockall = 802
Global Const $gui_dockborders = 102
Global Const $gui_gr_close = 1
Global Const $gui_gr_line = 2
Global Const $gui_gr_bezier = 4
Global Const $gui_gr_move = 6
Global Const $gui_gr_color = 8
Global Const $gui_gr_rect = 10
Global Const $gui_gr_ellipse = 12
Global Const $gui_gr_pie = 14
Global Const $gui_gr_dot = 16
Global Const $gui_gr_pixel = 18
Global Const $gui_gr_hint = 20
Global Const $gui_gr_refresh = 22
Global Const $gui_gr_pensize = 24
Global Const $gui_gr_nobkcolor = -2
Global Const $gui_bkcolor_default = -1
Global Const $gui_bkcolor_transparent = -2
Global Const $gui_bkcolor_lv_alternate = -33554432
Global Const $gui_read_default = 0
Global Const $gui_read_extended = 1
Global Const $gui_cursor_nooverride = 0
Global Const $gui_cursor_override = 1
Global Const $gui_ws_ex_parentdrag = 1048576
Global Const $ss_left = 0
Global Const $ss_center = 1
Global Const $ss_right = 2
Global Const $ss_icon = 3
Global Const $ss_blackrect = 4
Global Const $ss_grayrect = 5
Global Const $ss_whiterect = 6
Global Const $ss_blackframe = 7
Global Const $ss_grayframe = 8
Global Const $ss_whiteframe = 9
Global Const $ss_simple = 11
Global Const $ss_leftnowordwrap = 12
Global Const $ss_bitmap = 14
Global Const $ss_enhmetafile = 15
Global Const $ss_etchedhorz = 16
Global Const $ss_etchedvert = 17
Global Const $ss_etchedframe = 18
Global Const $ss_realsizecontrol = 64
Global Const $ss_noprefix = 128
Global Const $ss_notify = 256
Global Const $ss_centerimage = 512
Global Const $ss_rightjust = 1024
Global Const $ss_sunken = 4096
Global Const $gui_ss_default_label = 0
Global Const $gui_ss_default_graphic = 0
Global Const $gui_ss_default_icon = $ss_notify
Global Const $gui_ss_default_pic = $ss_notify
Global Const $stm_seticon = 368
Global Const $stm_geticon = 369
Global Const $stm_setimage = 370
Global Const $stm_getimage = 371
Global Const $wc_animate = "SysAnimate32"
Global Const $wc_button = "Button"
Global Const $wc_combobox = "ComboBox"
Global Const $wc_comboboxex = "ComboBoxEx32"
Global Const $wc_datetimepick = "SysDateTimePick32"
Global Const $wc_edit = "Edit"
Global Const $wc_header = "SysHeader32"
Global Const $wc_hotkey = "msctls_hotkey32"
Global Const $wc_ipaddress = "SysIPAddress32"
Global Const $wc_link = "SysLink"
Global Const $wc_listbox = "ListBox"
Global Const $wc_listview = "SysListView32"
Global Const $wc_monthcal = "SysMonthCal32"
Global Const $wc_nativefontctl = "NativeFontCtl"
Global Const $wc_pagescroller = "SysPager"
Global Const $wc_progress = "msctls_progress32"
Global Const $wc_rebar = "ReBarWindow32"
Global Const $wc_scrollbar = "ScrollBar"
Global Const $wc_static = "Static"
Global Const $wc_statusbar = "msctls_statusbar32"
Global Const $wc_tabcontrol = "SysTabControl32"
Global Const $wc_toolbar = "ToolbarWindow32"
Global Const $wc_tooltips = "tooltips_class32"
Global Const $wc_trackbar = "msctls_trackbar32"
Global Const $wc_treeview = "SysTreeView32"
Global Const $wc_updown = "msctls_updown32"
Global Const $ws_overlapped = 0
Global Const $ws_tiled = $ws_overlapped
Global Const $ws_maximizebox = 65536
Global Const $ws_minimizebox = 131072
Global Const $ws_tabstop = 65536
Global Const $ws_group = 131072
Global Const $ws_sizebox = 262144
Global Const $ws_thickframe = $ws_sizebox
Global Const $ws_sysmenu = 524288
Global Const $ws_hscroll = 1048576
Global Const $ws_vscroll = 2097152
Global Const $ws_dlgframe = 4194304
Global Const $ws_border = 8388608
Global Const $ws_caption = 12582912
Global Const $ws_overlappedwindow = BitOR($ws_caption, $ws_maximizebox, $ws_minimizebox, $ws_overlapped, $ws_sysmenu, $ws_thickframe)
Global Const $ws_tiledwindow = $ws_overlappedwindow
Global Const $ws_maximize = 16777216
Global Const $ws_clipchildren = 33554432
Global Const $ws_clipsiblings = 67108864
Global Const $ws_disabled = 134217728
Global Const $ws_visible = 268435456
Global Const $ws_minimize = 536870912
Global Const $ws_iconic = $ws_minimize
Global Const $ws_child = 1073741824
Global Const $ws_childwindow = $ws_child
Global Const $ws_popup = -2147483648
Global Const $ws_popupwindow = -2138570752
Global Const $ds_3dlook = 4
Global Const $ds_absalign = 1
Global Const $ds_center = 2048
Global Const $ds_centermouse = 4096
Global Const $ds_contexthelp = 8192
Global Const $ds_control = 1024
Global Const $ds_fixedsys = 8
Global Const $ds_localedit = 32
Global Const $ds_modalframe = 128
Global Const $ds_nofailcreate = 16
Global Const $ds_noidlemsg = 256
Global Const $ds_setfont = 64
Global Const $ds_setforeground = 512
Global Const $ds_shellfont = BitOR($ds_fixedsys, $ds_setfont)
Global Const $ds_sysmodal = 2
Global Const $ws_ex_acceptfiles = 16
Global Const $ws_ex_appwindow = 262144
Global Const $ws_ex_composited = 33554432
Global Const $ws_ex_controlparent = 65536
Global Const $ws_ex_clientedge = 512
Global Const $ws_ex_contexthelp = 1024
Global Const $ws_ex_dlgmodalframe = 1
Global Const $ws_ex_layered = 524288
Global Const $ws_ex_layoutrtl = 4194304
Global Const $ws_ex_left = 0
Global Const $ws_ex_leftscrollbar = 16384
Global Const $ws_ex_ltrreading = 0
Global Const $ws_ex_mdichild = 64
Global Const $ws_ex_noactivate = 134217728
Global Const $ws_ex_noinheritlayout = 1048576
Global Const $ws_ex_noparentnotify = 4
Global Const $ws_ex_right = 4096
Global Const $ws_ex_rightscrollbar = 0
Global Const $ws_ex_rtlreading = 8192
Global Const $ws_ex_staticedge = 131072
Global Const $ws_ex_toolwindow = 128
Global Const $ws_ex_topmost = 8
Global Const $ws_ex_transparent = 32
Global Const $ws_ex_windowedge = 256
Global Const $ws_ex_overlappedwindow = BitOR($ws_ex_clientedge, $ws_ex_windowedge)
Global Const $ws_ex_palettewindow = BitOR($ws_ex_toolwindow, $ws_ex_topmost, $ws_ex_windowedge)
Global Const $wm_null = 0
Global Const $wm_create = 1
Global Const $wm_destroy = 2
Global Const $wm_move = 3
Global Const $wm_sizewait = 4
Global Const $wm_size = 5
Global Const $wm_activate = 6
Global Const $wm_setfocus = 7
Global Const $wm_killfocus = 8
Global Const $wm_setvisible = 9
Global Const $wm_enable = 10
Global Const $wm_setredraw = 11
Global Const $wm_settext = 12
Global Const $wm_gettext = 13
Global Const $wm_gettextlength = 14
Global Const $wm_paint = 15
Global Const $wm_close = 16
Global Const $wm_queryendsession = 17
Global Const $wm_quit = 18
Global Const $wm_erasebkgnd = 20
Global Const $wm_queryopen = 19
Global Const $wm_syscolorchange = 21
Global Const $wm_endsession = 22
Global Const $wm_systemerror = 23
Global Const $wm_showwindow = 24
Global Const $wm_ctlcolor = 25
Global Const $wm_settingchange = 26
Global Const $wm_wininichange = 26
Global Const $wm_devmodechange = 27
Global Const $wm_activateapp = 28
Global Const $wm_fontchange = 29
Global Const $wm_timechange = 30
Global Const $wm_cancelmode = 31
Global Const $wm_setcursor = 32
Global Const $wm_mouseactivate = 33
Global Const $wm_childactivate = 34
Global Const $wm_queuesync = 35
Global Const $wm_getminmaxinfo = 36
Global Const $wm_logoff = 37
Global Const $wm_painticon = 38
Global Const $wm_iconerasebkgnd = 39
Global Const $wm_nextdlgctl = 40
Global Const $wm_alttabactive = 41
Global Const $wm_spoolerstatus = 42
Global Const $wm_drawitem = 43
Global Const $wm_measureitem = 44
Global Const $wm_deleteitem = 45
Global Const $wm_vkeytoitem = 46
Global Const $wm_chartoitem = 47
Global Const $wm_setfont = 48
Global Const $wm_getfont = 49
Global Const $wm_sethotkey = 50
Global Const $wm_gethotkey = 51
Global Const $wm_filesyschange = 52
Global Const $wm_isactiveicon = 53
Global Const $wm_queryparkicon = 54
Global Const $wm_querydragicon = 55
Global Const $wm_winhelp = 56
Global Const $wm_compareitem = 57
Global Const $wm_fullscreen = 58
Global Const $wm_clientshutdown = 59
Global Const $wm_ddemlevent = 60
Global Const $wm_getobject = 61
Global Const $wm_calcscroll = 63
Global Const $wm_testing = 64
Global Const $wm_compacting = 65
Global Const $wm_otherwindowcreated = 66
Global Const $wm_otherwindowdestroyed = 67
Global Const $wm_commnotify = 68
Global Const $wm_mediastatuschange = 69
Global Const $wm_windowposchanging = 70
Global Const $wm_windowposchanged = 71
Global Const $wm_power = 72
Global Const $wm_copyglobaldata = 73
Global Const $wm_copydata = 74
Global Const $wm_canceljournal = 75
Global Const $wm_logonnotify = 76
Global Const $wm_keyf1 = 77
Global Const $wm_notify = 78
Global Const $wm_access_window = 79
Global Const $wm_inputlangchangerequest = 80
Global Const $wm_inputlangchange = 81
Global Const $wm_tcard = 82
Global Const $wm_help = 83
Global Const $wm_userchanged = 84
Global Const $wm_notifyformat = 85
Global Const $wm_qm_activate = 96
Global Const $wm_hook_do_callback = 97
Global Const $wm_syscopydata = 98
Global Const $wm_finaldestroy = 112
Global Const $wm_measureitem_clientdata = 113
Global Const $wm_contextmenu = 123
Global Const $wm_stylechanging = 124
Global Const $wm_stylechanged = 125
Global Const $wm_displaychange = 126
Global Const $wm_geticon = 127
Global Const $wm_seticon = 128
Global Const $wm_nccreate = 129
Global Const $wm_ncdestroy = 130
Global Const $wm_nccalcsize = 131
Global Const $wm_nchittest = 132
Global Const $wm_ncpaint = 133
Global Const $wm_ncactivate = 134
Global Const $wm_getdlgcode = 135
Global Const $wm_syncpaint = 136
Global Const $wm_synctask = 137
Global Const $wm_kludgeminrect = 139
Global Const $wm_lpkdrawswitchwnd = 140
Global Const $wm_uahdestroywindow = 144
Global Const $wm_uahdrawmenu = 145
Global Const $wm_uahdrawmenuitem = 146
Global Const $wm_uahinitmenu = 147
Global Const $wm_uahmeasuremenuitem = 148
Global Const $wm_uahncpaintmenupopup = 149
Global Const $wm_ncmousemove = 160
Global Const $wm_nclbuttondown = 161
Global Const $wm_nclbuttonup = 162
Global Const $wm_nclbuttondblclk = 163
Global Const $wm_ncrbuttondown = 164
Global Const $wm_ncrbuttonup = 165
Global Const $wm_ncrbuttondblclk = 166
Global Const $wm_ncmbuttondown = 167
Global Const $wm_ncmbuttonup = 168
Global Const $wm_ncmbuttondblclk = 169
Global Const $wm_ncxbuttondown = 171
Global Const $wm_ncxbuttonup = 172
Global Const $wm_ncxbuttondblclk = 173
Global Const $wm_ncuahdrawcaption = 174
Global Const $wm_ncuahdrawframe = 175
Global Const $wm_input_device_change = 254
Global Const $wm_input = 255
Global Const $wm_keydown = 256
Global Const $wm_keyfirst = 256
Global Const $wm_keyup = 257
Global Const $wm_char = 258
Global Const $wm_deadchar = 259
Global Const $wm_syskeydown = 260
Global Const $wm_syskeyup = 261
Global Const $wm_syschar = 262
Global Const $wm_sysdeadchar = 263
Global Const $wm_yomichar = 264
Global Const $wm_keylast = 265
Global Const $wm_unichar = 265
Global Const $wm_convertrequest = 266
Global Const $wm_convertresult = 267
Global Const $wm_im_info = 268
Global Const $wm_ime_startcomposition = 269
Global Const $wm_ime_endcomposition = 270
Global Const $wm_ime_composition = 271
Global Const $wm_ime_keylast = 271
Global Const $wm_initdialog = 272
Global Const $wm_command = 273
Global Const $wm_syscommand = 274
Global Const $wm_timer = 275
Global Const $wm_hscroll = 276
Global Const $wm_vscroll = 277
Global Const $wm_initmenu = 278
Global Const $wm_initmenupopup = 279
Global Const $wm_systimer = 280
Global Const $wm_gesture = 281
Global Const $wm_gesturenotify = 282
Global Const $wm_gestureinput = 283
Global Const $wm_gesturenotified = 284
Global Const $wm_menuselect = 287
Global Const $wm_menuchar = 288
Global Const $wm_enteridle = 289
Global Const $wm_menurbuttonup = 290
Global Const $wm_menudrag = 291
Global Const $wm_menugetobject = 292
Global Const $wm_uninitmenupopup = 293
Global Const $wm_menucommand = 294
Global Const $wm_changeuistate = 295
Global Const $wm_updateuistate = 296
Global Const $wm_queryuistate = 297
Global Const $wm_lbtrackpoint = 305
Global Const $wm_ctlcolormsgbox = 306
Global Const $wm_ctlcoloredit = 307
Global Const $wm_ctlcolorlistbox = 308
Global Const $wm_ctlcolorbtn = 309
Global Const $wm_ctlcolordlg = 310
Global Const $wm_ctlcolorscrollbar = 311
Global Const $wm_ctlcolorstatic = 312
Global Const $mn_gethmenu = 481
Global Const $wm_parentnotify = 528
Global Const $wm_entermenuloop = 529
Global Const $wm_exitmenuloop = 530
Global Const $wm_nextmenu = 531
Global Const $wm_sizing = 532
Global Const $wm_capturechanged = 533
Global Const $wm_moving = 534
Global Const $wm_powerbroadcast = 536
Global Const $wm_devicechange = 537
Global Const $wm_mdicreate = 544
Global Const $wm_mdidestroy = 545
Global Const $wm_mdiactivate = 546
Global Const $wm_mdirestore = 547
Global Const $wm_mdinext = 548
Global Const $wm_mdimaximize = 549
Global Const $wm_mditile = 550
Global Const $wm_mdicascade = 551
Global Const $wm_mdiiconarrange = 552
Global Const $wm_mdigetactive = 553
Global Const $wm_dropobject = 554
Global Const $wm_querydropobject = 555
Global Const $wm_begindrag = 556
Global Const $wm_dragloop = 557
Global Const $wm_dragselect = 558
Global Const $wm_dragmove = 559
Global Const $wm_mdisetmenu = 560
Global Const $wm_entersizemove = 561
Global Const $wm_exitsizemove = 562
Global Const $wm_dropfiles = 563
Global Const $wm_mdirefreshmenu = 564
Global Const $wm_touch = 576
Global Const $wm_ime_setcontext = 641
Global Const $wm_ime_notify = 642
Global Const $wm_ime_control = 643
Global Const $wm_ime_compositionfull = 644
Global Const $wm_ime_select = 645
Global Const $wm_ime_char = 646
Global Const $wm_ime_system = 647
Global Const $wm_ime_request = 648
Global Const $wm_ime_keydown = 656
Global Const $wm_ime_keyup = 657
Global Const $wm_ncmousehover = 672
Global Const $wm_mousehover = 673
Global Const $wm_ncmouseleave = 674
Global Const $wm_mouseleave = 675
Global Const $wm_wtssession_change = 689
Global Const $wm_tablet_first = 704
Global Const $wm_tablet_last = 735
Global Const $wm_cut = 768
Global Const $wm_copy = 769
Global Const $wm_paste = 770
Global Const $wm_clear = 771
Global Const $wm_undo = 772
Global Const $wm_paletteischanging = 784
Global Const $wm_hotkey = 786
Global Const $wm_palettechanged = 785
Global Const $wm_sysmenu = 787
Global Const $wm_hookmsg = 788
Global Const $wm_exitprocess = 789
Global Const $wm_wakethread = 790
Global Const $wm_print = 791
Global Const $wm_printclient = 792
Global Const $wm_appcommand = 793
Global Const $wm_querynewpalette = 783
Global Const $wm_themechanged = 794
Global Const $wm_uahinit = 795
Global Const $wm_desktopnotify = 796
Global Const $wm_clipboardupdate = 797
Global Const $wm_dwmcompositionchanged = 798
Global Const $wm_dwmncrenderingchanged = 799
Global Const $wm_dwmcolorizationcolorchanged = 800
Global Const $wm_dwmwindowmaximizedchange = 801
Global Const $wm_dwmexileframe = 802
Global Const $wm_dwmsendiconicthumbnail = 803
Global Const $wm_magnification_started = 804
Global Const $wm_magnification_ended = 805
Global Const $wm_dwmsendiconiclivepreviewbitmap = 806
Global Const $wm_dwmthumbnailsizechanged = 807
Global Const $wm_magnification_output = 808
Global Const $wm_measurecontrol = 816
Global Const $wm_getactiontext = 817
Global Const $wm_forwardkeydown = 819
Global Const $wm_forwardkeyup = 820
Global Const $wm_gettitlebarinfoex = 831
Global Const $wm_notifywow = 832
Global Const $wm_handheldfirst = 856
Global Const $wm_handheldlast = 863
Global Const $wm_afxfirst = 864
Global Const $wm_afxlast = 895
Global Const $wm_penwinfirst = 896
Global Const $wm_penwinlast = 911
Global Const $wm_dde_initiate = 992
Global Const $wm_dde_terminate = 993
Global Const $wm_dde_advise = 994
Global Const $wm_dde_unadvise = 995
Global Const $wm_dde_ack = 996
Global Const $wm_dde_data = 997
Global Const $wm_dde_request = 998
Global Const $wm_dde_poke = 999
Global Const $wm_dde_execute = 1000
Global Const $wm_dbnotification = 1021
Global Const $wm_netconnect = 1022
Global Const $wm_hibernate = 1023
Global Const $wm_user = 1024
Global Const $wm_app = 32768
Global Const $nm_first = 0
Global Const $nm_outofmemory = $nm_first - 1
Global Const $nm_click = $nm_first - 2
Global Const $nm_dblclk = $nm_first - 3
Global Const $nm_return = $nm_first - 4
Global Const $nm_rclick = $nm_first - 5
Global Const $nm_rdblclk = $nm_first - 6
Global Const $nm_setfocus = $nm_first - 7
Global Const $nm_killfocus = $nm_first - 8
Global Const $nm_customdraw = $nm_first - 12
Global Const $nm_hover = $nm_first - 13
Global Const $nm_nchittest = $nm_first - 14
Global Const $nm_keydown = $nm_first - 15
Global Const $nm_releasedcapture = $nm_first - 16
Global Const $nm_setcursor = $nm_first - 17
Global Const $nm_char = $nm_first - 18
Global Const $nm_tooltipscreated = $nm_first - 19
Global Const $nm_ldown = $nm_first - 20
Global Const $nm_rdown = $nm_first - 21
Global Const $nm_themechanged = $nm_first - 22
Global Const $wm_mousefirst = 512
Global Const $wm_mousemove = 512
Global Const $wm_lbuttondown = 513
Global Const $wm_lbuttonup = 514
Global Const $wm_lbuttondblclk = 515
Global Const $wm_rbuttondown = 516
Global Const $wm_rbuttonup = 517
Global Const $wm_rbuttondblclk = 518
Global Const $wm_mbuttondown = 519
Global Const $wm_mbuttonup = 520
Global Const $wm_mbuttondblclk = 521
Global Const $wm_mousewheel = 522
Global Const $wm_xbuttondown = 523
Global Const $wm_xbuttonup = 524
Global Const $wm_xbuttondblclk = 525
Global Const $wm_mousehwheel = 526
Global Const $ps_solid = 0
Global Const $ps_dash = 1
Global Const $ps_dot = 2
Global Const $ps_dashdot = 3
Global Const $ps_dashdotdot = 4
Global Const $ps_null = 5
Global Const $ps_insideframe = 6
Global Const $ps_userstyle = 7
Global Const $ps_alternate = 8
Global Const $ps_endcap_round = 0
Global Const $ps_endcap_square = 256
Global Const $ps_endcap_flat = 512
Global Const $ps_join_bevel = 4096
Global Const $ps_join_miter = 8192
Global Const $ps_join_round = 0
Global Const $ps_geometric = 65536
Global Const $ps_cosmetic = 0
Global Const $lwa_alpha = 2
Global Const $lwa_colorkey = 1
Global Const $rgn_and = 1
Global Const $rgn_or = 2
Global Const $rgn_xor = 3
Global Const $rgn_diff = 4
Global Const $rgn_copy = 5
Global Const $errorregion = 0
Global Const $nullregion = 1
Global Const $simpleregion = 2
Global Const $complexregion = 3
Global Const $transparent = 1
Global Const $opaque = 2
Global Const $ccm_first = 8192
Global Const $ccm_getunicodeformat = ($ccm_first + 6)
Global Const $ccm_setunicodeformat = ($ccm_first + 5)
Global Const $ccm_setbkcolor = $ccm_first + 1
Global Const $ccm_setcolorscheme = $ccm_first + 2
Global Const $ccm_getcolorscheme = $ccm_first + 3
Global Const $ccm_getdroptarget = $ccm_first + 4
Global Const $ccm_setwindowtheme = $ccm_first + 11
Global Const $ga_parent = 1
Global Const $ga_root = 2
Global Const $ga_rootowner = 3
Global Const $sm_cxscreen = 0
Global Const $sm_cyscreen = 1
Global Const $sm_cxvscroll = 2
Global Const $sm_cyhscroll = 3
Global Const $sm_cycaption = 4
Global Const $sm_cxborder = 5
Global Const $sm_cyborder = 6
Global Const $sm_cxdlgframe = 7
Global Const $sm_cydlgframe = 8
Global Const $sm_cyvthumb = 9
Global Const $sm_cxhthumb = 10
Global Const $sm_cxicon = 11
Global Const $sm_cyicon = 12
Global Const $sm_cxcursor = 13
Global Const $sm_cycursor = 14
Global Const $sm_cymenu = 15
Global Const $sm_cxfullscreen = 16
Global Const $sm_cyfullscreen = 17
Global Const $sm_cykanjiwindow = 18
Global Const $sm_mousepresent = 19
Global Const $sm_cyvscroll = 20
Global Const $sm_cxhscroll = 21
Global Const $sm_debug = 22
Global Const $sm_swapbutton = 23
Global Const $sm_reserved1 = 24
Global Const $sm_reserved2 = 25
Global Const $sm_reserved3 = 26
Global Const $sm_reserved4 = 27
Global Const $sm_cxmin = 28
Global Const $sm_cymin = 29
Global Const $sm_cxsize = 30
Global Const $sm_cysize = 31
Global Const $sm_cxframe = 32
Global Const $sm_cyframe = 33
Global Const $sm_cxmintrack = 34
Global Const $sm_cymintrack = 35
Global Const $sm_cxdoubleclk = 36
Global Const $sm_cydoubleclk = 37
Global Const $sm_cxiconspacing = 38
Global Const $sm_cyiconspacing = 39
Global Const $sm_menudropalignment = 40
Global Const $sm_penwindows = 41
Global Const $sm_dbcsenabled = 42
Global Const $sm_cmousebuttons = 43
Global Const $sm_secure = 44
Global Const $sm_cxedge = 45
Global Const $sm_cyedge = 46
Global Const $sm_cxminspacing = 47
Global Const $sm_cyminspacing = 48
Global Const $sm_cxsmicon = 49
Global Const $sm_cysmicon = 50
Global Const $sm_cysmcaption = 51
Global Const $sm_cxsmsize = 52
Global Const $sm_cysmsize = 53
Global Const $sm_cxmenusize = 54
Global Const $sm_cymenusize = 55
Global Const $sm_arrange = 56
Global Const $sm_cxminimized = 57
Global Const $sm_cyminimized = 58
Global Const $sm_cxmaxtrack = 59
Global Const $sm_cymaxtrack = 60
Global Const $sm_cxmaximized = 61
Global Const $sm_cymaximized = 62
Global Const $sm_network = 63
Global Const $sm_cleanboot = 67
Global Const $sm_cxdrag = 68
Global Const $sm_cydrag = 69
Global Const $sm_showsounds = 70
Global Const $sm_cxmenucheck = 71
Global Const $sm_cymenucheck = 72
Global Const $sm_slowmachine = 73
Global Const $sm_mideastenabled = 74
Global Const $sm_mousewheelpresent = 75
Global Const $sm_xvirtualscreen = 76
Global Const $sm_yvirtualscreen = 77
Global Const $sm_cxvirtualscreen = 78
Global Const $sm_cyvirtualscreen = 79
Global Const $sm_cmonitors = 80
Global Const $sm_samedisplayformat = 81
Global Const $sm_immenabled = 82
Global Const $sm_cxfocusborder = 83
Global Const $sm_cyfocusborder = 84
Global Const $sm_tabletpc = 86
Global Const $sm_mediacenter = 87
Global Const $sm_starter = 88
Global Const $sm_serverr2 = 89
Global Const $sm_cmetrics = 90
Global Const $sm_remotesession = 4096
Global Const $sm_shuttingdown = 8192
Global Const $sm_remotecontrol = 8193
Global Const $sm_caretblinkingenabled = 8194
Global Const $blackness = 66
Global Const $captureblt = 1073741824
Global Const $dstinvert = 5570569
Global Const $mergecopy = 12583114
Global Const $mergepaint = 12255782
Global Const $nomirrorbitmap = -2147483648
Global Const $notsrccopy = 3342344
Global Const $notsrcerase = 1114278
Global Const $patcopy = 15728673
Global Const $patinvert = 5898313
Global Const $patpaint = 16452105
Global Const $srcand = 8913094
Global Const $srccopy = 13369376
Global Const $srcerase = 4457256
Global Const $srcinvert = 6684742
Global Const $srcpaint = 15597702
Global Const $whiteness = 16711778
Global Const $dt_bottom = 8
Global Const $dt_calcrect = 1024
Global Const $dt_center = 1
Global Const $dt_editcontrol = 8192
Global Const $dt_end_ellipsis = 32768
Global Const $dt_expandtabs = 64
Global Const $dt_externalleading = 512
Global Const $dt_hideprefix = 1048576
Global Const $dt_internal = 4096
Global Const $dt_left = 0
Global Const $dt_modifystring = 65536
Global Const $dt_noclip = 256
Global Const $dt_nofullwidthcharbreak = 524288
Global Const $dt_noprefix = 2048
Global Const $dt_path_ellipsis = 16384
Global Const $dt_prefixonly = 2097152
Global Const $dt_right = 2
Global Const $dt_rtlreading = 131072
Global Const $dt_singleline = 32
Global Const $dt_tabstop = 128
Global Const $dt_top = 0
Global Const $dt_vcenter = 4
Global Const $dt_wordbreak = 16
Global Const $dt_word_ellipsis = 262144
Global Const $rdw_erase = 4
Global Const $rdw_frame = 1024
Global Const $rdw_internalpaint = 2
Global Const $rdw_invalidate = 1
Global Const $rdw_noerase = 32
Global Const $rdw_noframe = 2048
Global Const $rdw_nointernalpaint = 16
Global Const $rdw_validate = 8
Global Const $rdw_erasenow = 512
Global Const $rdw_updatenow = 256
Global Const $rdw_allchildren = 128
Global Const $rdw_nochildren = 64
Global Const $wm_renderformat = 773
Global Const $wm_renderallformats = 774
Global Const $wm_destroyclipboard = 775
Global Const $wm_drawclipboard = 776
Global Const $wm_paintclipboard = 777
Global Const $wm_vscrollclipboard = 778
Global Const $wm_sizeclipboard = 779
Global Const $wm_askcbformatname = 780
Global Const $wm_changecbchain = 781
Global Const $wm_hscrollclipboard = 782
Global Const $hterror = -2
Global Const $httransparent = -1
Global Const $htnowhere = 0
Global Const $htclient = 1
Global Const $htcaption = 2
Global Const $htsysmenu = 3
Global Const $htgrowbox = 4
Global Const $htsize = $htgrowbox
Global Const $htmenu = 5
Global Const $hthscroll = 6
Global Const $htvscroll = 7
Global Const $htminbutton = 8
Global Const $htmaxbutton = 9
Global Const $htleft = 10
Global Const $htright = 11
Global Const $httop = 12
Global Const $httopleft = 13
Global Const $httopright = 14
Global Const $htbottom = 15
Global Const $htbottomleft = 16
Global Const $htbottomright = 17
Global Const $htborder = 18
Global Const $htreduce = $htminbutton
Global Const $htzoom = $htmaxbutton
Global Const $htsizefirst = $htleft
Global Const $htsizelast = $htbottomright
Global Const $htobject = 19
Global Const $htclose = 20
Global Const $hthelp = 21
Global Const $color_scrollbar = 0
Global Const $color_background = 1
Global Const $color_activecaption = 2
Global Const $color_inactivecaption = 3
Global Const $color_menu = 4
Global Const $color_window = 5
Global Const $color_windowframe = 6
Global Const $color_menutext = 7
Global Const $color_windowtext = 8
Global Const $color_captiontext = 9
Global Const $color_activeborder = 10
Global Const $color_inactiveborder = 11
Global Const $color_appworkspace = 12
Global Const $color_highlight = 13
Global Const $color_highlighttext = 14
Global Const $color_btnface = 15
Global Const $color_btnshadow = 16
Global Const $color_graytext = 17
Global Const $color_btntext = 18
Global Const $color_inactivecaptiontext = 19
Global Const $color_btnhighlight = 20
Global Const $color_3ddkshadow = 21
Global Const $color_3dlight = 22
Global Const $color_infotext = 23
Global Const $color_infobk = 24
Global Const $color_hotlight = 26
Global Const $color_gradientactivecaption = 27
Global Const $color_gradientinactivecaption = 28
Global Const $color_menuhilight = 29
Global Const $color_menubar = 30
Global Const $color_desktop = 1
Global Const $color_3dface = 15
Global Const $color_3dshadow = 16
Global Const $color_3dhighlight = 20
Global Const $color_3dhilight = 20
Global Const $color_btnhilight = 20
Global Const $hinst_commctrl = -1
Global Const $idb_std_small_color = 0
Global Const $idb_std_large_color = 1
Global Const $idb_view_small_color = 4
Global Const $idb_view_large_color = 5
Global Const $idb_hist_small_color = 8
Global Const $idb_hist_large_color = 9
Global Const $startf_forceofffeedback = 128
Global Const $startf_forceonfeedback = 64
Global Const $startf_preventpinning = 8192
Global Const $startf_runfullscreen = 32
Global Const $startf_titleisappid = 4096
Global Const $startf_titleislinkname = 2048
Global Const $startf_usecountchars = 8
Global Const $startf_usefillattribute = 16
Global Const $startf_usehotkey = 512
Global Const $startf_useposition = 4
Global Const $startf_useshowwindow = 1
Global Const $startf_usesize = 2
Global Const $startf_usestdhandles = 256
Global Const $cdds_prepaint = 1
Global Const $cdds_postpaint = 2
Global Const $cdds_preerase = 3
Global Const $cdds_posterase = 4
Global Const $cdds_item = 65536
Global Const $cdds_itemprepaint = 65537
Global Const $cdds_itempostpaint = 65538
Global Const $cdds_itempreerase = 65539
Global Const $cdds_itemposterase = 65540
Global Const $cdds_subitem = 131072
Global Const $cdis_selected = 1
Global Const $cdis_grayed = 2
Global Const $cdis_disabled = 4
Global Const $cdis_checked = 8
Global Const $cdis_focus = 16
Global Const $cdis_default = 32
Global Const $cdis_hot = 64
Global Const $cdis_marked = 128
Global Const $cdis_indeterminate = 256
Global Const $cdis_showkeyboardcues = 512
Global Const $cdis_nearhot = 1024
Global Const $cdis_othersidehot = 2048
Global Const $cdis_drophilited = 4096
Global Const $cdrf_dodefault = 0
Global Const $cdrf_newfont = 2
Global Const $cdrf_skipdefault = 4
Global Const $cdrf_notifypostpaint = 16
Global Const $cdrf_notifyitemdraw = 32
Global Const $cdrf_notifysubitemdraw = 32
Global Const $cdrf_notifyposterase = 64
Global Const $cdrf_doerase = 8
Global Const $cdrf_skippostpaint = 256
Global Const $gui_ss_default_gui = BitOR($ws_minimizebox, $ws_caption, $ws_popup, $ws_sysmenu)
Global Const $color_aqua = 65535
Global Const $color_black = 0
Global Const $color_blue = 255
Global Const $color_cream = 16776176
Global Const $color_fuchsia = 16711935
Global Const $color_gray = 8421504
Global Const $color_green = 32768
Global Const $color_lime = 65280
Global Const $color_maroon = 9116770
Global Const $color_medblue = 708
Global Const $color_medgray = 10526884
Global Const $color_moneygreen = 12639424
Global Const $color_navy = 128
Global Const $color_olive = 8421376
Global Const $color_purple = 8388736
Global Const $color_red = 16711680
Global Const $color_silver = 12632256
Global Const $color_skyblue = 10930928
Global Const $color_teal = 32896
Global Const $color_white = 16777215
Global Const $color_yellow = 16776960
Global Const $clr_none = -1
Global Const $clr_default = -16777216
Global Const $clr_aqua = 16776960
Global Const $clr_black = 0
Global Const $clr_blue = 16711680
Global Const $clr_cream = 15793151
Global Const $clr_fuchsia = 16711935
Global Const $clr_gray = 8421504
Global Const $clr_green = 32768
Global Const $clr_lime = 65280
Global Const $clr_maroon = 6429835
Global Const $clr_medblue = 12845568
Global Const $clr_medgray = 10789024
Global Const $clr_moneygreen = 12639424
Global Const $clr_navy = 8388608
Global Const $clr_olive = 32896
Global Const $clr_purple = 8388736
Global Const $clr_red = 255
Global Const $clr_silver = 12632256
Global Const $clr_skyblue = 15780518
Global Const $clr_teal = 8421376
Global Const $clr_white = 16777215
Global Const $clr_yellow = 65535
Global Const $cc_anycolor = 256
Global Const $cc_fullopen = 2
Global Const $cc_rgbinit = 1
Global Const $opt_coordsrelative = 0
Global Const $opt_coordsabsolute = 1
Global Const $opt_coordsclient = 2
Global Const $opt_errorsilent = 0
Global Const $opt_errorfatal = 1
Global Const $opt_capsnostore = 0
Global Const $opt_capsstore = 1
Global Const $opt_matchstart = 1
Global Const $opt_matchany = 2
Global Const $opt_matchexact = 3
Global Const $opt_matchadvanced = 4
Global Const $ccs_top = 1
Global Const $ccs_nomovey = 2
Global Const $ccs_bottom = 3
Global Const $ccs_noresize = 4
Global Const $ccs_noparentalign = 8
Global Const $ccs_nohilite = 16
Global Const $ccs_adjustable = 32
Global Const $ccs_nodivider = 64
Global Const $ccs_vert = 128
Global Const $ccs_left = 129
Global Const $ccs_nomovex = 130
Global Const $ccs_right = 131
Global Const $dt_drivetype = 1
Global Const $dt_ssdstatus = 2
Global Const $dt_bustype = 3
Global Const $proxy_ie = 0
Global Const $proxy_none = 1
Global Const $proxy_specified = 2
Global Const $objid_window = 0
Global Const $objid_titlebar = -2
Global Const $objid_sizegrip = -7
Global Const $objid_caret = -8
Global Const $objid_cursor = -9
Global Const $objid_alert = -10
Global Const $objid_sound = -11
Global Const $dlg_centerontop = 0
Global Const $dlg_notitle = 1
Global Const $dlg_notontop = 2
Global Const $dlg_textleft = 4
Global Const $dlg_textright = 8
Global Const $dlg_moveable = 16
Global Const $dlg_textvcenter = 32
Global Const $idc_unknown = 0
Global Const $idc_appstarting = 1
Global Const $idc_arrow = 2
Global Const $idc_cross = 3
Global Const $idc_hand = 32649
Global Const $idc_help = 4
Global Const $idc_ibeam = 5
Global Const $idc_icon = 6
Global Const $idc_no = 7
Global Const $idc_size = 8
Global Const $idc_sizeall = 9
Global Const $idc_sizenesw = 10
Global Const $idc_sizens = 11
Global Const $idc_sizenwse = 12
Global Const $idc_sizewe = 13
Global Const $idc_uparrow = 14
Global Const $idc_wait = 15
Global Const $idi_application = 32512
Global Const $idi_asterisk = 32516
Global Const $idi_exclamation = 32515
Global Const $idi_hand = 32513
Global Const $idi_question = 32514
Global Const $idi_winlogo = 32517
Global Const $idi_shield = 32518
Global Const $idi_error = $idi_hand
Global Const $idi_information = $idi_asterisk
Global Const $idi_warning = $idi_exclamation
Global Const $sd_logoff = 0
Global Const $sd_shutdown = 1
Global Const $sd_reboot = 2
Global Const $sd_force = 4
Global Const $sd_powerdown = 8
Global Const $sd_forcehung = 16
Global Const $sd_standby = 32
Global Const $sd_hibernate = 64
Global Const $stdin_child = 1
Global Const $stdout_child = 2
Global Const $stderr_child = 4
Global Const $stderr_merged = 8
Global Const $stdio_inherit_parent = 16
Global Const $run_create_new_console = 65536
Global Const $ubound_dimensions = 0
Global Const $ubound_rows = 1
Global Const $ubound_columns = 2
Global Const $mouseeventf_absolute = 32768
Global Const $mouseeventf_move = 1
Global Const $mouseeventf_leftdown = 2
Global Const $mouseeventf_leftup = 4
Global Const $mouseeventf_rightdown = 8
Global Const $mouseeventf_rightup = 16
Global Const $mouseeventf_middledown = 32
Global Const $mouseeventf_middleup = 64
Global Const $mouseeventf_wheel = 2048
Global Const $mouseeventf_xdown = 128
Global Const $mouseeventf_xup = 256
Global Const $reg_none = 0
Global Const $reg_sz = 1
Global Const $reg_expand_sz = 2
Global Const $reg_binary = 3
Global Const $reg_dword = 4
Global Const $reg_dword_little_endian = 4
Global Const $reg_dword_big_endian = 5
Global Const $reg_link = 6
Global Const $reg_multi_sz = 7
Global Const $reg_resource_list = 8
Global Const $reg_full_resource_descriptor = 9
Global Const $reg_resource_requirements_list = 10
Global Const $reg_qword = 11
Global Const $reg_qword_little_endian = 11
Global Const $hwnd_bottom = 1
Global Const $hwnd_notopmost = -2
Global Const $hwnd_top = 0
Global Const $hwnd_topmost = -1
Global Const $swp_nosize = 1
Global Const $swp_nomove = 2
Global Const $swp_nozorder = 4
Global Const $swp_noredraw = 8
Global Const $swp_noactivate = 16
Global Const $swp_framechanged = 32
Global Const $swp_drawframe = 32
Global Const $swp_showwindow = 64
Global Const $swp_hidewindow = 128
Global Const $swp_nocopybits = 256
Global Const $swp_noownerzorder = 512
Global Const $swp_noreposition = 512
Global Const $swp_nosendchanging = 1024
Global Const $swp_defererase = 8192
Global Const $swp_asyncwindowpos = 16384
Global Const $keyword_default = 1
Global Const $keyword_null = 2
Global Const $declared_local = -1
Global Const $declared_unknown = 0
Global Const $declared_global = 1
Global Const $assign_create = 0
Global Const $assign_forcelocal = 1
Global Const $assign_forceglobal = 2
Global Const $assign_existfail = 4
Global Const $bi_enable = 0
Global Const $bi_disable = 1
Global Const $break_enable = 1
Global Const $break_disable = 0
Global Const $cdtray_open = "open"
Global Const $cdtray_closed = "closed"
Global Const $send_default = 0
Global Const $send_raw = 1
Global Const $dir_default = 0
Global Const $dir_extended = 1
Global Const $dir_norecurse = 2
Global Const $dir_remove = 1
Global Const $dt_all = "ALL"
Global Const $dt_cdrom = "CDROM"
Global Const $dt_removable = "REMOVABLE"
Global Const $dt_fixed = "FIXED"
Global Const $dt_network = "NETWORK"
Global Const $dt_ramdisk = "RAMDISK"
Global Const $dt_unknown = "UNKNOWN"
Global Const $dt_undefined = 1
Global Const $dt_fat = "FAT"
Global Const $dt_fat32 = "FAT32"
Global Const $dt_exfat = "exFAT"
Global Const $dt_ntfs = "NTFS"
Global Const $dt_nwfs = "NWFS"
Global Const $dt_cdfs = "CDFS"
Global Const $dt_udf = "UDF"
Global Const $dma_default = 0
Global Const $dma_persistent = 1
Global Const $dma_authentication = 8
Global Const $ds_unknown = "UNKNOWN"
Global Const $ds_ready = "READY"
Global Const $ds_notready = "NOTREADY"
Global Const $ds_invalid = "INVALID"
Global Const $mouse_click_left = "left"
Global Const $mouse_click_right = "right"
Global Const $mouse_click_middle = "middle"
Global Const $mouse_click_main = "main"
Global Const $mouse_click_menu = "menu"
Global Const $mouse_click_primary = "primary"
Global Const $mouse_click_secondary = "secondary"
Global Const $mouse_wheel_up = "up"
Global Const $mouse_wheel_down = "down"
Global Const $number_auto = 0
Global Const $number_32bit = 1
Global Const $number_64bit = 2
Global Const $number_double = 3
Global Const $obj_name = 1
Global Const $obj_string = 2
Global Const $obj_progid = 3
Global Const $obj_file = 4
Global Const $obj_module = 5
Global Const $obj_clsid = 6
Global Const $obj_iid = 7
Global Const $exitclose_normal = 0
Global Const $exitclose_byexit = 1
Global Const $exitclose_byclick = 2
Global Const $exitclose_bylogoff = 3
Global Const $exitclose_bysutdown = 4
Global Const $process_stats_memory = 0
Global Const $process_stats_io = 1
Global Const $process_low = 0
Global Const $process_belownormal = 1
Global Const $process_normal = 2
Global Const $process_abovenormal = 3
Global Const $process_high = 4
Global Const $process_realtime = 5
Global Const $run_logon_noprofile = 0
Global Const $run_logon_profile = 1
Global Const $run_logon_network = 2
Global Const $run_logon_inherit = 4
Global Const $sound_nowait = 0
Global Const $sound_wait = 1
Global Const $shex_open = "open"
Global Const $shex_edit = "edit"
Global Const $shex_print = "print"
Global Const $shex_properties = "properties"
Global Const $tcp_data_default = 0
Global Const $tcp_data_binary = 1
Global Const $udp_open_default = 0
Global Const $udp_open_broadcast = 1
Global Const $udp_data_default = 0
Global Const $udp_data_binary = 1
Global Const $udp_data_array = 2
Global Const $tip_noicon = 0
Global Const $tip_infoicon = 1
Global Const $tip_warningicon = 2
Global Const $tip_erroricon = 3
Global Const $tip_balloon = 1
Global Const $tip_center = 2
Global Const $tip_forcevisible = 4
Global Const $windows_noontop = 0
Global Const $windows_ontop = 1
Global Const $mb_ok = 0
Global Const $mb_okcancel = 1
Global Const $mb_abortretryignore = 2
Global Const $mb_yesnocancel = 3
Global Const $mb_yesno = 4
Global Const $mb_retrycancel = 5
Global Const $mb_canceltrycontinue = 6
Global Const $mb_help = 16384
Global Const $mb_iconstop = 16
Global Const $mb_iconerror = 16
Global Const $mb_iconhand = 16
Global Const $mb_iconquestion = 32
Global Const $mb_iconexclamation = 48
Global Const $mb_iconwarning = 48
Global Const $mb_iconinformation = 64
Global Const $mb_iconasterisk = 64
Global Const $mb_usericon = 128
Global Const $mb_defbutton1 = 0
Global Const $mb_defbutton2 = 256
Global Const $mb_defbutton3 = 512
Global Const $mb_defbutton4 = 768
Global Const $mb_applmodal = 0
Global Const $mb_systemmodal = 4096
Global Const $mb_taskmodal = 8192
Global Const $mb_default_desktop_only = 131072
Global Const $mb_right = 524288
Global Const $mb_rtlreading = 1048576
Global Const $mb_setforeground = 65536
Global Const $mb_topmost = 262144
Global Const $mb_service_notification = 2097152
Global Const $mb_rightjustified = $mb_right
Global Const $idtimeout = -1
Global Const $idok = 1
Global Const $idcancel = 2
Global Const $idabort = 3
Global Const $idretry = 4
Global Const $idignore = 5
Global Const $idyes = 6
Global Const $idno = 7
Global Const $idclose = 8
Global Const $idhelp = 9
Global Const $idtryagain = 10
Global Const $idcontinue = 11
Global Const $str_nocasesense = 0
Global Const $str_casesense = 1
Global Const $str_nocasesensebasic = 2
Global Const $str_stripleading = 1
Global Const $str_striptrailing = 2
Global Const $str_stripspaces = 4
Global Const $str_stripall = 8
Global Const $str_chrsplit = 0
Global Const $str_entiresplit = 1
Global Const $str_nocount = 2
Global Const $str_regexpmatch = 0
Global Const $str_regexparraymatch = 1
Global Const $str_regexparrayfullmatch = 2
Global Const $str_regexparrayglobalmatch = 3
Global Const $str_regexparrayglobalfullmatch = 4
Global Const $str_endisstart = 0
Global Const $str_endnotstart = 1
Global Const $sb_ansi = 1
Global Const $sb_utf16le = 2
Global Const $sb_utf16be = 3
Global Const $sb_utf8 = 4
Global Const $se_utf16 = 0
Global Const $se_ansi = 1
Global Const $se_utf8 = 2
Global Const $str_utf16 = 0
Global Const $str_ucs2 = 1
Global Enum $arrayfill_force_default, $arrayfill_force_singleitem, $arrayfill_force_int, $arrayfill_force_number, $arrayfill_force_ptr, $arrayfill_force_hwnd, $arrayfill_force_string
Global Enum $arrayunique_nocount, $arrayunique_count
Global Enum $arrayunique_auto, $arrayunique_force32, $arrayunique_force64, $arrayunique_match, $arrayunique_distinct

Func _arrayadd(ByRef $aarray, $vvalue, $istart = 0, $sdelim_item = "|", $sdelim_row = @CRLF, $iforce = $arrayfill_force_default)
	If $istart = Default Then $istart = 0
	If $sdelim_item = Default Then $sdelim_item = "|"
	If $sdelim_row = Default Then $sdelim_row = @CRLF
	If $iforce = Default Then $iforce = $arrayfill_force_default
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows)
	Local $hdatatype = 0
	Switch $iforce
		Case $arrayfill_force_int
			$hdatatype = Int
		Case $arrayfill_force_number
			$hdatatype = Number
		Case $arrayfill_force_ptr
			$hdatatype = Ptr
		Case $arrayfill_force_hwnd
			$hdatatype = HWnd
		Case $arrayfill_force_string
			$hdatatype = String
	EndSwitch
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $iforce = $arrayfill_force_singleitem Then
				ReDim $aarray[$idim_1 + 1]
				$aarray[$idim_1] = $vvalue
				Return $idim_1
			EndIf
			If IsArray($vvalue) Then
				If UBound($vvalue, $ubound_dimensions) <> 1 Then Return SetError(5, 0, -1)
				$hdatatype = 0
			Else
				Local $atmp = StringSplit($vvalue, $sdelim_item, $str_nocount + $str_entiresplit)
				If UBound($atmp, $ubound_rows) = 1 Then
					$atmp[0] = $vvalue
				EndIf
				$vvalue = $atmp
			EndIf
			Local $iadd = UBound($vvalue, $ubound_rows)
			ReDim $aarray[$idim_1 + $iadd]
			For $i = 0 To $iadd - 1
				If IsFunc($hdatatype) Then
					$aarray[$idim_1 + $i] = $hdatatype($vvalue[$i])
				Else
					$aarray[$idim_1 + $i] = $vvalue[$i]
				EndIf
			Next
			Return $idim_1 + $iadd - 1
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns)
			If $istart < 0 OR $istart > $idim_2 - 1 Then Return SetError(4, 0, -1)
			Local $ivaldim_1, $ivaldim_2 = 0, $icolcount
			If IsArray($vvalue) Then
				If UBound($vvalue, $ubound_dimensions) <> 2 Then Return SetError(5, 0, -1)
				$ivaldim_1 = UBound($vvalue, $ubound_rows)
				$ivaldim_2 = UBound($vvalue, $ubound_columns)
				$hdatatype = 0
			Else
				Local $asplit_1 = StringSplit($vvalue, $sdelim_row, $str_nocount + $str_entiresplit)
				$ivaldim_1 = UBound($asplit_1, $ubound_rows)
				Local $atmp[$ivaldim_1][0], $asplit_2
				For $i = 0 To $ivaldim_1 - 1
					$asplit_2 = StringSplit($asplit_1[$i], $sdelim_item, $str_nocount + $str_entiresplit)
					$icolcount = UBound($asplit_2)
					If $icolcount > $ivaldim_2 Then
						$ivaldim_2 = $icolcount
						ReDim $atmp[$ivaldim_1][$ivaldim_2]
					EndIf
					For $j = 0 To $icolcount - 1
						$atmp[$i][$j] = $asplit_2[$j]
					Next
				Next
				$vvalue = $atmp
			EndIf
			If UBound($vvalue, $ubound_columns) + $istart > UBound($aarray, $ubound_columns) Then Return SetError(3, 0, -1)
			ReDim $aarray[$idim_1 + $ivaldim_1][$idim_2]
			For $iwriteto_index = 0 To $ivaldim_1 - 1
				For $j = 0 To $idim_2 - 1
					If $j < $istart Then
						$aarray[$iwriteto_index + $idim_1][$j] = ""
					ElseIf $j - $istart > $ivaldim_2 - 1 Then
						$aarray[$iwriteto_index + $idim_1][$j] = ""
					Else
						If IsFunc($hdatatype) Then
							$aarray[$iwriteto_index + $idim_1][$j] = $hdatatype($vvalue[$iwriteto_index][$j - $istart])
						Else
							$aarray[$iwriteto_index + $idim_1][$j] = $vvalue[$iwriteto_index][$j - $istart]
						EndIf
					EndIf
				Next
			Next
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return UBound($aarray, $ubound_rows) - 1
EndFunc

Func _arraybinarysearch(Const ByRef $aarray, $vvalue, $istart = 0, $iend = 0, $icolumn = 0)
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $icolumn = Default Then $icolumn = 0
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows)
	If $idim_1 = 0 Then Return SetError(6, 0, -1)
	If $iend < 1 OR $iend > $idim_1 - 1 Then $iend = $idim_1 - 1
	If $istart < 0 Then $istart = 0
	If $istart > $iend Then Return SetError(4, 0, -1)
	Local $imid = Int(($iend + $istart) / 2)
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $aarray[$istart] > $vvalue OR $aarray[$iend] < $vvalue Then Return SetError(2, 0, -1)
			While $istart <= $imid AND $vvalue <> $aarray[$imid]
				If $vvalue < $aarray[$imid] Then
					$iend = $imid - 1
				Else
					$istart = $imid + 1
				EndIf
				$imid = Int(($iend + $istart) / 2)
			WEnd
			If $istart > $iend Then Return SetError(3, 0, -1)
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns) - 1
			If $icolumn < 0 OR $icolumn > $idim_2 Then Return SetError(7, 0, -1)
			If $aarray[$istart][$icolumn] > $vvalue OR $aarray[$iend][$icolumn] < $vvalue Then Return SetError(2, 0, -1)
			While $istart <= $imid AND $vvalue <> $aarray[$imid][$icolumn]
				If $vvalue < $aarray[$imid][$icolumn] Then
					$iend = $imid - 1
				Else
					$istart = $imid + 1
				EndIf
				$imid = Int(($iend + $istart) / 2)
			WEnd
			If $istart > $iend Then Return SetError(3, 0, -1)
		Case Else
			Return SetError(5, 0, -1)
	EndSwitch
	Return $imid
EndFunc

Func _arraycoldelete(ByRef $aarray, $icolumn, $bconvert = False)
	If $bconvert = Default Then $bconvert = False
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows)
	If UBound($aarray, $ubound_dimensions) <> 2 Then Return SetError(2, 0, -1)
	Local $idim_2 = UBound($aarray, $ubound_columns)
	Switch $idim_2
		Case 2
			If $icolumn < 0 OR $icolumn > 1 Then Return SetError(3, 0, -1)
			If $bconvert Then
				Local $atemparray[$idim_1]
				For $i = 0 To $idim_1 - 1
					$atemparray[$i] = $aarray[$i][(NOT $icolumn)]
				Next
				$aarray = $atemparray
			Else
				ContinueCase
			EndIf
		Case Else
			If $icolumn < 0 OR $icolumn > $idim_2 - 1 Then Return SetError(3, 0, -1)
			For $i = 0 To $idim_1 - 1
				For $j = $icolumn To $idim_2 - 2
					$aarray[$i][$j] = $aarray[$i][$j + 1]
				Next
			Next
			ReDim $aarray[$idim_1][$idim_2 - 1]
	EndSwitch
	Return UBound($aarray, $ubound_columns)
EndFunc

Func _arraycolinsert(ByRef $aarray, $icolumn)
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows)
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			Local $atemparray[$idim_1][2]
			Switch $icolumn
				Case 0, 1
					For $i = 0 To $idim_1 - 1
						$atemparray[$i][(NOT $icolumn)] = $aarray[$i]
					Next
				Case Else
					Return SetError(3, 0, -1)
			EndSwitch
			$aarray = $atemparray
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns)
			If $icolumn < 0 OR $icolumn > $idim_2 Then Return SetError(3, 0, -1)
			ReDim $aarray[$idim_1][$idim_2 + 1]
			For $i = 0 To $idim_1 - 1
				For $j = $idim_2 To $icolumn + 1 Step -1
					$aarray[$i][$j] = $aarray[$i][$j - 1]
				Next
				$aarray[$i][$icolumn] = ""
			Next
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return UBound($aarray, $ubound_columns)
EndFunc

Func _arraycombinations(Const ByRef $aarray, $iset, $sdelimiter = "")
	If $sdelimiter = Default Then $sdelimiter = ""
	If NOT IsArray($aarray) Then Return SetError(1, 0, 0)
	If UBound($aarray, $ubound_dimensions) <> 1 Then Return SetError(2, 0, 0)
	Local $in = UBound($aarray)
	Local $ir = $iset
	Local $aidx[$ir]
	For $i = 0 To $ir - 1
		$aidx[$i] = $i
	Next
	Local $itotal = __array_combinations($in, $ir)
	Local $ileft = $itotal
	Local $aresult[$itotal + 1]
	$aresult[0] = $itotal
	Local $icount = 1
	While $ileft > 0
		__array_getnext($in, $ir, $ileft, $itotal, $aidx)
		For $i = 0 To $iset - 1
			$aresult[$icount] &= $aarray[$aidx[$i]] & $sdelimiter
		Next
		If $sdelimiter <> "" Then $aresult[$icount] = StringTrimRight($aresult[$icount], 1)
		$icount += 1
	WEnd
	Return $aresult
EndFunc

Func _arrayconcatenate(ByRef $aarraytarget, Const ByRef $aarraysource, $istart = 0)
	If $istart = Default Then $istart = 0
	If NOT IsArray($aarraytarget) Then Return SetError(1, 0, -1)
	If NOT IsArray($aarraysource) Then Return SetError(2, 0, -1)
	Local $idim_total_tgt = UBound($aarraytarget, $ubound_dimensions)
	Local $idim_total_src = UBound($aarraysource, $ubound_dimensions)
	Local $idim_1_tgt = UBound($aarraytarget, $ubound_rows)
	Local $idim_1_src = UBound($aarraysource, $ubound_rows)
	If $istart < 0 OR $istart > $idim_1_src - 1 Then Return SetError(6, 0, -1)
	Switch $idim_total_tgt
		Case 1
			If $idim_total_src <> 1 Then Return SetError(4, 0, -1)
			ReDim $aarraytarget[$idim_1_tgt + $idim_1_src - $istart]
			For $i = $istart To $idim_1_src - 1
				$aarraytarget[$idim_1_tgt + $i - $istart] = $aarraysource[$i]
			Next
		Case 2
			If $idim_total_src <> 2 Then Return SetError(4, 0, -1)
			Local $idim_2_tgt = UBound($aarraytarget, $ubound_columns)
			If UBound($aarraysource, $ubound_columns) <> $idim_2_tgt Then Return SetError(5, 0, -1)
			ReDim $aarraytarget[$idim_1_tgt + $idim_1_src - $istart][$idim_2_tgt]
			For $i = $istart To $idim_1_src - 1
				For $j = 0 To $idim_2_tgt - 1
					$aarraytarget[$idim_1_tgt + $i - $istart][$j] = $aarraysource[$i][$j]
				Next
			Next
		Case Else
			Return SetError(3, 0, -1)
	EndSwitch
	Return UBound($aarraytarget, $ubound_rows)
EndFunc

Func _arraydelete(ByRef $aarray, $vrange)
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	If IsArray($vrange) Then
		If UBound($vrange, $ubound_dimensions) <> 1 OR UBound($vrange, $ubound_rows) < 2 Then Return SetError(4, 0, -1)
	Else
		Local $inumber, $asplit_1, $asplit_2
		$vrange = StringStripWS($vrange, 8)
		$asplit_1 = StringSplit($vrange, ";")
		$vrange = ""
		For $i = 1 To $asplit_1[0]
			If NOT StringRegExp($asplit_1[$i], "^\d+(-\d+)?$") Then Return SetError(3, 0, -1)
			$asplit_2 = StringSplit($asplit_1[$i], "-")
			Switch $asplit_2[0]
				Case 1
					$vrange &= $asplit_2[1] & ";"
				Case 2
					If Number($asplit_2[2]) >= Number($asplit_2[1]) Then
						$inumber = $asplit_2[1] - 1
						Do
							$inumber += 1
							$vrange &= $inumber & ";"
						Until $inumber = $asplit_2[2]
					EndIf
			EndSwitch
		Next
		$vrange = StringSplit(StringTrimRight($vrange, 1), ";")
	EndIf
	If $vrange[1] < 0 OR $vrange[$vrange[0]] > $idim_1 Then Return SetError(5, 0, -1)
	Local $icopyto_index = 0
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			For $i = 1 To $vrange[0]
				$aarray[$vrange[$i]] = ChrW(64177)
			Next
			For $ireadfrom_index = 0 To $idim_1
				If $aarray[$ireadfrom_index] == ChrW(64177) Then
					ContinueLoop
				Else
					If $ireadfrom_index <> $icopyto_index Then
						$aarray[$icopyto_index] = $aarray[$ireadfrom_index]
					EndIf
					$icopyto_index += 1
				EndIf
			Next
			ReDim $aarray[$idim_1 - $vrange[0] + 1]
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns) - 1
			For $i = 1 To $vrange[0]
				$aarray[$vrange[$i]][0] = ChrW(64177)
			Next
			For $ireadfrom_index = 0 To $idim_1
				If $aarray[$ireadfrom_index][0] == ChrW(64177) Then
					ContinueLoop
				Else
					If $ireadfrom_index <> $icopyto_index Then
						For $j = 0 To $idim_2
							$aarray[$icopyto_index][$j] = $aarray[$ireadfrom_index][$j]
						Next
					EndIf
					$icopyto_index += 1
				EndIf
			Next
			ReDim $aarray[$idim_1 - $vrange[0] + 1][$idim_2 + 1]
		Case Else
			Return SetError(2, 0, False)
	EndSwitch
	Return UBound($aarray, $ubound_rows)
EndFunc

Func _arraydisplay(Const ByRef $aarray, $stitle = Default, $sarrayrange = Default, $iflags = Default, $vuser_separator = Default, $sheader = Default, $imax_colwidth = Default, $ialt_color = Default, $huser_function = Default)
	If $stitle = Default Then $stitle = "ArrayDisplay"
	If $sarrayrange = Default Then $sarrayrange = ""
	If $iflags = Default Then $iflags = 0
	If $vuser_separator = Default Then $vuser_separator = ""
	If $sheader = Default Then $sheader = ""
	If $imax_colwidth = Default Then $imax_colwidth = 350
	If $ialt_color = Default Then $ialt_color = 0
	If $huser_function = Default Then $huser_function = 0
	Local $itranspose = BitAND($iflags, 1)
	Local $icolalign = BitAND($iflags, 6)
	Local $iverbose = BitAND($iflags, 8)
	Local $ibuttonmargin = ((BitAND($iflags, 32)) ? (0) : ((BitAND($iflags, 16)) ? (20) : (40)))
	Local $inorow = BitAND($iflags, 64)
	Local $smsg = "", $iret = 1
	If IsArray($aarray) Then
		Local $idimension = UBound($aarray, $ubound_dimensions), $irowcount = UBound($aarray, $ubound_rows), $icolcount = UBound($aarray, $ubound_columns)
		If $idimension > 2 Then
			$smsg = "Larger than 2D array passed to function"
			$iret = 2
		EndIf
	Else
		$smsg = "No array variable passed to function"
	EndIf
	If $smsg Then
		If $iverbose AND MsgBox($mb_systemmodal + $mb_iconerror + $mb_yesno, "ArrayDisplay Error: " & $stitle, $smsg & @CRLF & @CRLF & "Exit the script?") = $idyes Then
			Exit
		Else
			Return SetError($iret, 0, "")
		EndIf
	EndIf
	Local $icw_colwidth = Number($vuser_separator)
	Local $sad_separator = ChrW(64177)
	Local $scurr_separator = Opt("GUIDataSeparatorChar", $sad_separator)
	If $vuser_separator = "" Then $vuser_separator = $scurr_separator
	Local $vtmp, $irowlimit = 65525, $icollimit = 250
	Local $idatarow = $irowcount
	Local $idatacol = $icolcount
	Local $iitem_start = 0, $iitem_end = $irowcount - 1, $isubitem_start = 0, $isubitem_end = (($idimension = 2) ? ($icolcount - 1) : (0))
	Local $brange_flag = False, $avrangesplit
	If $sarrayrange Then
		Local $aarray_range = StringRegExp($sarrayrange & "||", "(?U)(.*)\|", 3)
		If $aarray_range[0] Then
			$avrangesplit = StringSplit($aarray_range[0], ":")
			If @error Then
				$iitem_end = Number($avrangesplit[1])
			Else
				$iitem_start = Number($avrangesplit[1])
				$iitem_end = Number($avrangesplit[2])
			EndIf
		EndIf
		If $iitem_start > $iitem_end Then
			$vtmp = $iitem_start
			$iitem_start = $iitem_end
			$iitem_end = $vtmp
		EndIf
		If $iitem_start < 0 Then $iitem_start = 0
		If $iitem_end > $irowcount - 1 Then $iitem_end = $irowcount - 1
		If $iitem_start <> 0 OR $iitem_end <> $irowcount - 1 Then $brange_flag = True
		If $idimension = 2 AND $aarray_range[1] Then
			$avrangesplit = StringSplit($aarray_range[1], ":")
			If @error Then
				$isubitem_end = Number($avrangesplit[1])
			Else
				$isubitem_start = Number($avrangesplit[1])
				$isubitem_end = Number($avrangesplit[2])
			EndIf
			If $isubitem_start > $isubitem_end Then
				$vtmp = $isubitem_start
				$isubitem_start = $isubitem_end
				$isubitem_end = $vtmp
			EndIf
			If $isubitem_start < 0 Then $isubitem_start = 0
			If $isubitem_end > $icolcount - 1 Then $isubitem_end = $icolcount - 1
			If $isubitem_start <> 0 OR $isubitem_end <> $icolcount - 1 Then $brange_flag = True
		EndIf
	EndIf
	Local $sdisplaydata = "[" & $idatarow
	Local $btruncated = False
	If $itranspose Then
		If $iitem_end - $iitem_start > $icollimit Then
			$btruncated = True
			$iitem_end = $iitem_start + $icollimit - 1
		EndIf
	Else
		If $iitem_end - $iitem_start > $irowlimit Then
			$btruncated = True
			$iitem_end = $iitem_start + $irowlimit - 1
		EndIf
	EndIf
	If $btruncated Then
		$sdisplaydata &= "*]"
	Else
		$sdisplaydata &= "]"
	EndIf
	If $idimension = 2 Then
		$sdisplaydata &= " [" & $idatacol
		If $itranspose Then
			If $isubitem_end - $isubitem_start > $irowlimit Then
				$btruncated = True
				$isubitem_end = $isubitem_start + $irowlimit - 1
			EndIf
		Else
			If $isubitem_end - $isubitem_start > $icollimit Then
				$btruncated = True
				$isubitem_end = $isubitem_start + $icollimit - 1
			EndIf
		EndIf
		If $btruncated Then
			$sdisplaydata &= "*]"
		Else
			$sdisplaydata &= "]"
		EndIf
	EndIf
	Local $stipdata = ""
	If $btruncated Then $stipdata &= "Truncated"
	If $brange_flag Then
		If $stipdata Then $stipdata &= " - "
		$stipdata &= "Range set"
	EndIf
	If $itranspose Then
		If $stipdata Then $stipdata &= " - "
		$stipdata &= "Transposed"
	EndIf
	Local $asheader = StringSplit($sheader, $scurr_separator, $str_nocount)
	If UBound($asheader) = 0 Then Local $asheader[1] = [""]
	$sheader = "Row"
	Local $iindex = $isubitem_start
	If $itranspose Then
		For $j = $iitem_start To $iitem_end
			$sheader &= $sad_separator & "Col " & $j
		Next
	Else
		If $asheader[0] Then
			For $iindex = $isubitem_start To $isubitem_end
				If $iindex >= UBound($asheader) Then ExitLoop
				$sheader &= $sad_separator & $asheader[$iindex]
			Next
		EndIf
		For $j = $iindex To $isubitem_end
			$sheader &= $sad_separator & "Col " & $j
		Next
	EndIf
	If $inorow Then $sheader = StringTrimLeft($sheader, 4)
	If $iverbose AND ($iitem_end - $iitem_start + 1) * ($isubitem_end - $isubitem_start + 1) > 10000 Then
		SplashTextOn("ArrayDisplay", "Preparing display" & @CRLF & @CRLF & "Please be patient", 300, 100)
	EndIf
	Local $ibuffer = 4094
	If $itranspose Then
		$vtmp = $iitem_start
		$iitem_start = $isubitem_start
		$isubitem_start = $vtmp
		$vtmp = $iitem_end
		$iitem_end = $isubitem_end
		$isubitem_end = $vtmp
	EndIf
	Local $avarraytext[$iitem_end - $iitem_start + 1]
	For $i = $iitem_start To $iitem_end
		If NOT $inorow Then $avarraytext[$i - $iitem_start] = "[" & $i & "]"
		For $j = $isubitem_start To $isubitem_end
			If $idimension = 1 Then
				If $itranspose Then
					Switch VarGetType($aarray[$j])
						Case "Array"
							$vtmp = "{Array}"
						Case Else
							$vtmp = $aarray[$j]
					EndSwitch
				Else
					Switch VarGetType($aarray[$i])
						Case "Array"
							$vtmp = "{Array}"
						Case Else
							$vtmp = $aarray[$i]
					EndSwitch
				EndIf
			Else
				If $itranspose Then
					Switch VarGetType($aarray[$j][$i])
						Case "Array"
							$vtmp = "{Array}"
						Case Else
							$vtmp = $aarray[$j][$i]
					EndSwitch
				Else
					Switch VarGetType($aarray[$i][$j])
						Case "Array"
							$vtmp = "{Array}"
						Case Else
							$vtmp = $aarray[$i][$j]
					EndSwitch
				EndIf
			EndIf
			If StringLen($vtmp) > $ibuffer Then $vtmp = StringLeft($vtmp, $ibuffer)
			$avarraytext[$i - $iitem_start] &= $sad_separator & $vtmp
		Next
		If $inorow Then $avarraytext[$i - $iitem_start] = StringTrimLeft($avarraytext[$i - $iitem_start], 1)
	Next
	Local Const $_arrayconstant_gui_dockbottom = 64
	Local Const $_arrayconstant_gui_dockborders = 102
	Local Const $_arrayconstant_gui_dockheight = 512
	Local Const $_arrayconstant_gui_dockleft = 2
	Local Const $_arrayconstant_gui_dockright = 4
	Local Const $_arrayconstant_gui_dockhcenter = 8
	Local Const $_arrayconstant_gui_event_close = -3
	Local Const $_arrayconstant_gui_focus = 256
	Local Const $_arrayconstant_gui_bkcolor_lv_alternate = -33554432
	Local Const $_arrayconstant_ss_center = 1
	Local Const $_arrayconstant_ss_centerimage = 512
	Local Const $_arrayconstant_lvm_getitemcount = (4096 + 4)
	Local Const $_arrayconstant_lvm_getitemrect = (4096 + 14)
	Local Const $_arrayconstant_lvm_getcolumnwidth = (4096 + 29)
	Local Const $_arrayconstant_lvm_setcolumnwidth = (4096 + 30)
	Local Const $_arrayconstant_lvm_getitemstate = (4096 + 44)
	Local Const $_arrayconstant_lvm_getselectedcount = (4096 + 50)
	Local Const $_arrayconstant_lvm_setextendedlistviewstyle = (4096 + 54)
	Local Const $_arrayconstant_lvs_ex_gridlines = 1
	Local Const $_arrayconstant_lvis_selected = 2
	Local Const $_arrayconstant_lvs_showselalways = 8
	Local Const $_arrayconstant_lvs_ex_fullrowselect = 32
	Local Const $_arrayconstant_ws_ex_clientedge = 512
	Local Const $_arrayconstant_ws_maximizebox = 65536
	Local Const $_arrayconstant_ws_minimizebox = 131072
	Local Const $_arrayconstant_ws_sizebox = 262144
	Local Const $_arrayconstant_wm_setredraw = 11
	Local Const $_arrayconstant_lvscw_autosize = -1
	Local $icoordmode = Opt("GUICoordMode", 1)
	Local $iorgwidth = 210, $iheight = 200, $iminsize = 250
	Local $hgui = GUICreate($stitle, $iorgwidth, $iheight, Default, Default, BitOR($_arrayconstant_ws_sizebox, $_arrayconstant_ws_minimizebox, $_arrayconstant_ws_maximizebox))
	Local $aiguisize = WinGetClientSize($hgui)
	Local $ibuttonwidth_2 = $aiguisize[0] / 2
	Local $ibuttonwidth_3 = $aiguisize[0] / 3
	Local $idlistview = GUICtrlCreateListView($sheader, 0, 0, $aiguisize[0], $aiguisize[1] - $ibuttonmargin, $_arrayconstant_lvs_showselalways)
	GUICtrlSetBkColor($idlistview, $_arrayconstant_gui_bkcolor_lv_alternate)
	GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setextendedlistviewstyle, $_arrayconstant_lvs_ex_gridlines, $_arrayconstant_lvs_ex_gridlines)
	GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setextendedlistviewstyle, $_arrayconstant_lvs_ex_fullrowselect, $_arrayconstant_lvs_ex_fullrowselect)
	GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setextendedlistviewstyle, $_arrayconstant_ws_ex_clientedge, $_arrayconstant_ws_ex_clientedge)
	Local $idcopy_id = 9999, $idcopy_data = 99999, $iddata_label = 99999, $iduser_func = 99999, $idexit_script = 99999
	If $ibuttonmargin Then
		$idcopy_id = GUICtrlCreateButton("Copy Data && Hdr/Row", 0, $aiguisize[1] - $ibuttonmargin, $ibuttonwidth_2, 20)
		$idcopy_data = GUICtrlCreateButton("Copy Data Only", $ibuttonwidth_2, $aiguisize[1] - $ibuttonmargin, $ibuttonwidth_2, 20)
		If $ibuttonmargin = 40 Then
			Local $ibuttonwidth_var = $ibuttonwidth_2
			Local $ioffset = $ibuttonwidth_2
			If IsFunc($huser_function) Then
				$iduser_func = GUICtrlCreateButton("Run User Func", $ibuttonwidth_3, $aiguisize[1] - 20, $ibuttonwidth_3, 20)
				$ibuttonwidth_var = $ibuttonwidth_3
				$ioffset = $ibuttonwidth_3 * 2
			EndIf
			$idexit_script = GUICtrlCreateButton("Exit Script", $ioffset, $aiguisize[1] - 20, $ibuttonwidth_var, 20)
			$iddata_label = GUICtrlCreateLabel($sdisplaydata, 0, $aiguisize[1] - 20, $ibuttonwidth_var, 18, BitOR($_arrayconstant_ss_center, $_arrayconstant_ss_centerimage))
			Select
				Case $btruncated OR $itranspose OR $brange_flag
					GUICtrlSetColor($iddata_label, 16711680)
					GUICtrlSetTip($iddata_label, $stipdata)
			EndSelect
		EndIf
	EndIf
	GUICtrlSetResizing($idlistview, $_arrayconstant_gui_dockborders)
	GUICtrlSetResizing($idcopy_id, $_arrayconstant_gui_dockleft + $_arrayconstant_gui_dockbottom + $_arrayconstant_gui_dockheight)
	GUICtrlSetResizing($idcopy_data, $_arrayconstant_gui_dockright + $_arrayconstant_gui_dockbottom + $_arrayconstant_gui_dockheight)
	GUICtrlSetResizing($iddata_label, $_arrayconstant_gui_dockleft + $_arrayconstant_gui_dockbottom + $_arrayconstant_gui_dockheight)
	GUICtrlSetResizing($iduser_func, $_arrayconstant_gui_dockhcenter + $_arrayconstant_gui_dockbottom + $_arrayconstant_gui_dockheight)
	GUICtrlSetResizing($idexit_script, $_arrayconstant_gui_dockright + $_arrayconstant_gui_dockbottom + $_arrayconstant_gui_dockheight)
	GUICtrlSendMsg($idlistview, $_arrayconstant_wm_setredraw, 0, 0)
	Local $iditem
	For $i = 0 To UBound($avarraytext) - 1
		$iditem = GUICtrlCreateListViewItem($avarraytext[$i], $idlistview)
		If $ialt_color Then
			GUICtrlSetBkColor($iditem, $ialt_color)
		EndIf
	Next
	If $icolalign Then
		Local Const $_arrayconstant_lvcf_fmt = 1
		Local Const $_arrayconstant_lvm_setcolumnw = (4096 + 96)
		Local $tcolumn = DllStructCreate("uint Mask;int Fmt;int CX;ptr Text;int TextMax;int SubItem;int Image;int Order;int cxMin;int cxDefault;int cxIdeal")
		DllStructSetData($tcolumn, "Mask", $_arrayconstant_lvcf_fmt)
		DllStructSetData($tcolumn, "Fmt", $icolalign / 2)
		Local $pcolumn = DllStructGetPtr($tcolumn)
		For $i = 1 To $isubitem_end - $isubitem_start + 1
			GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setcolumnw, $i, $pcolumn)
		Next
	EndIf
	GUICtrlSendMsg($idlistview, $_arrayconstant_wm_setredraw, 1, 0)
	Local $iborder = 45
	If UBound($avarraytext) > 20 Then
		$iborder += 20
	EndIf
	Local $iwidth = $iborder, $icolwidth = 0, $aicolwidth[$isubitem_end - $isubitem_start + 2], $imin_colwidth = 55
	For $i = 0 To $isubitem_end - $isubitem_start + 1
		GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setcolumnwidth, $i, $_arrayconstant_lvscw_autosize)
		$icolwidth = GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_getcolumnwidth, $i, 0)
		If $icolwidth < $imin_colwidth Then
			GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setcolumnwidth, $i, $imin_colwidth)
			$icolwidth = $imin_colwidth
		EndIf
		$iwidth += $icolwidth
		$aicolwidth[$i] = $icolwidth
	Next
	If $inorow Then $iwidth -= 55
	If $iwidth > @DesktopWidth - 100 Then
		$iwidth = $iborder
		For $i = 0 To $isubitem_end - $isubitem_start + 1
			If $aicolwidth[$i] > $imax_colwidth Then
				GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_setcolumnwidth, $i, $imax_colwidth)
				$iwidth += $imax_colwidth
			Else
				$iwidth += $aicolwidth[$i]
			EndIf
		Next
	EndIf
	If $iwidth > @DesktopWidth - 100 Then
		$iwidth = @DesktopWidth - 100
	ElseIf $iwidth < $iminsize Then
		$iwidth = $iminsize
	EndIf
	Local $trect = DllStructCreate("struct; long Left;long Top;long Right;long Bottom; endstruct")
	DllCall("user32.dll", "struct*", "SendMessageW", "hwnd", GUICtrlGetHandle($idlistview), "uint", $_arrayconstant_lvm_getitemrect, "wparam", 0, "struct*", $trect)
	Local $aiwin_pos = WinGetPos($hgui)
	Local $ailv_pos = ControlGetPos($hgui, "", $idlistview)
	$iheight = ((UBound($avarraytext) + 2) * (DllStructGetData($trect, "Bottom") - DllStructGetData($trect, "Top"))) + $aiwin_pos[3] - $ailv_pos[3]
	If $iheight > @DesktopHeight - 100 Then
		$iheight = @DesktopHeight - 100
	ElseIf $iheight < $iminsize Then
		$iheight = $iminsize
	EndIf
	If $iverbose Then SplashOff()
	GUISetState(@SW_HIDE, $hgui)
	WinMove($hgui, "", (@DesktopWidth - $iwidth) / 2, (@DesktopHeight - $iheight) / 2, $iwidth, $iheight)
	GUISetState(@SW_SHOW, $hgui)
	Local $ioneventmode = Opt("GUIOnEventMode", 0), $imsg
	While 1
		$imsg = GUIGetMsg()
		Switch $imsg
			Case $_arrayconstant_gui_event_close
				ExitLoop
			Case $idcopy_id, $idcopy_data
				Local $isel_count = GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_getselectedcount, 0, 0)
				If $iverbose AND (NOT $isel_count) AND ($iitem_end - $iitem_start) * ($isubitem_end - $isubitem_start) > 10000 Then
					SplashTextOn("ArrayDisplay", "Copying data" & @CRLF & @CRLF & "Please be patient", 300, 100)
				EndIf
				Local $sclip = "", $sitem, $asplit
				For $i = 0 To $iitem_end - $iitem_start
					If $isel_count AND NOT (GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_getitemstate, $i, $_arrayconstant_lvis_selected)) Then
						ContinueLoop
					EndIf
					$sitem = $avarraytext[$i]
					If $imsg = $idcopy_data Then
						$sitem = StringRegExpReplace($sitem, "^\[\d+\].(.*)$", "$1")
					EndIf
					If $icw_colwidth Then
						$asplit = StringSplit($sitem, $sad_separator)
						$sitem = ""
						For $j = 1 To $asplit[0]
							$sitem &= StringFormat("%-" & $icw_colwidth + 1 & "s", StringLeft($asplit[$j], $icw_colwidth))
						Next
					Else
						$sitem = StringReplace($sitem, $sad_separator, $vuser_separator)
					EndIf
					$sclip &= $sitem & @CRLF
				Next
				If $imsg = $idcopy_id Then
					If $icw_colwidth Then
						$asplit = StringSplit($sheader, $sad_separator)
						$sitem = ""
						For $j = 1 To $asplit[0]
							$sitem &= StringFormat("%-" & $icw_colwidth + 1 & "s", StringLeft($asplit[$j], $icw_colwidth))
						Next
					Else
						$sitem = StringReplace($sheader, $sad_separator, $vuser_separator)
					EndIf
					$sclip = $sitem & @CRLF & $sclip
				EndIf
				ClipPut($sclip)
				SplashOff()
				GUICtrlSetState($idlistview, $_arrayconstant_gui_focus)
			Case $iduser_func
				Local $aiselitems[$irowlimit] = [0]
				For $i = 0 To GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_getitemcount, 0, 0)
					If GUICtrlSendMsg($idlistview, $_arrayconstant_lvm_getitemstate, $i, $_arrayconstant_lvis_selected) Then
						$aiselitems[0] += 1
						$aiselitems[$aiselitems[0]] = $i + $iitem_start
					EndIf
				Next
				ReDim $aiselitems[$aiselitems[0] + 1]
				$huser_function($aarray, $aiselitems)
				GUICtrlSetState($idlistview, $_arrayconstant_gui_focus)
			Case $idexit_script
				GUIDelete($hgui)
				Exit
		EndSwitch
	WEnd
	GUIDelete($hgui)
	Opt("GUICoordMode", $icoordmode)
	Opt("GUIOnEventMode", $ioneventmode)
	Opt("GUIDataSeparatorChar", $scurr_separator)
	Return 1
EndFunc

Func _arrayextract(Const ByRef $aarray, $istart_row = -1, $iend_row = -1, $istart_col = -1, $iend_col = -1)
	If $istart_row = Default Then $istart_row = -1
	If $iend_row = Default Then $iend_row = -1
	If $istart_col = Default Then $istart_col = -1
	If $iend_col = Default Then $iend_col = -1
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	If $iend_row = -1 Then $iend_row = $idim_1
	If $istart_row = -1 Then $istart_row = 0
	If $istart_row < -1 OR $iend_row < -1 Then Return SetError(3, 0, -1)
	If $istart_row > $idim_1 OR $iend_row > $idim_1 Then Return SetError(3, 0, -1)
	If $istart_row > $iend_row Then Return SetError(4, 0, -1)
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			Local $aretarray[$iend_row - $istart_row + 1]
			For $i = 0 To $iend_row - $istart_row
				$aretarray[$i] = $aarray[$i + $istart_row]
			Next
			Return $aretarray
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns) - 1
			If $iend_col = -1 Then $iend_col = $idim_2
			If $istart_col = -1 Then $istart_col = 0
			If $istart_col < -1 OR $iend_col < -1 Then Return SetError(5, 0, -1)
			If $istart_col > $idim_2 OR $iend_col > $idim_2 Then Return SetError(5, 0, -1)
			If $istart_col > $iend_col Then Return SetError(6, 0, -1)
			If $istart_col = $iend_col Then
				Local $aretarray[$iend_row - $istart_row + 1]
			Else
				Local $aretarray[$iend_row - $istart_row + 1][$iend_col - $istart_col + 1]
			EndIf
			For $i = 0 To $iend_row - $istart_row
				For $j = 0 To $iend_col - $istart_col
					If $istart_col = $iend_col Then
						$aretarray[$i] = $aarray[$i + $istart_row][$j + $istart_col]
					Else
						$aretarray[$i][$j] = $aarray[$i + $istart_row][$j + $istart_col]
					EndIf
				Next
			Next
			Return $aretarray
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return 1
EndFunc

Func _arrayfindall(Const ByRef $aarray, $vvalue, $istart = 0, $iend = 0, $icase = 0, $icompare = 0, $isubitem = 0, $brow = False)
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $icase = Default Then $icase = 0
	If $icompare = Default Then $icompare = 0
	If $isubitem = Default Then $isubitem = 0
	If $brow = Default Then $brow = False
	$istart = _arraysearch($aarray, $vvalue, $istart, $iend, $icase, $icompare, 1, $isubitem, $brow)
	If @error Then Return SetError(@error, 0, -1)
	Local $iindex = 0, $avresult[UBound($aarray, ($brow ? $ubound_columns : $ubound_rows))]
	Do
		$avresult[$iindex] = $istart
		$iindex += 1
		$istart = _arraysearch($aarray, $vvalue, $istart + 1, $iend, $icase, $icompare, 1, $isubitem, $brow)
	Until @error
	ReDim $avresult[$iindex]
	Return $avresult
EndFunc

Func _arrayinsert(ByRef $aarray, $vrange, $vvalue = "", $istart = 0, $sdelim_item = "|", $sdelim_row = @CRLF, $iforce = $arrayfill_force_default)
	If $vvalue = Default Then $vvalue = ""
	If $istart = Default Then $istart = 0
	If $sdelim_item = Default Then $sdelim_item = "|"
	If $sdelim_row = Default Then $sdelim_row = @CRLF
	If $iforce = Default Then $iforce = $arrayfill_force_default
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	Local $hdatatype = 0
	Switch $iforce
		Case $arrayfill_force_int
			$hdatatype = Int
		Case $arrayfill_force_number
			$hdatatype = Number
		Case $arrayfill_force_ptr
			$hdatatype = Ptr
		Case $arrayfill_force_hwnd
			$hdatatype = HWnd
		Case $arrayfill_force_string
			$hdatatype = String
	EndSwitch
	Local $asplit_1, $asplit_2
	If IsArray($vrange) Then
		If UBound($vrange, $ubound_dimensions) <> 1 OR UBound($vrange, $ubound_rows) < 2 Then Return SetError(4, 0, -1)
	Else
		Local $inumber
		$vrange = StringStripWS($vrange, 8)
		$asplit_1 = StringSplit($vrange, ";")
		$vrange = ""
		For $i = 1 To $asplit_1[0]
			If NOT StringRegExp($asplit_1[$i], "^\d+(-\d+)?$") Then Return SetError(3, 0, -1)
			$asplit_2 = StringSplit($asplit_1[$i], "-")
			Switch $asplit_2[0]
				Case 1
					$vrange &= $asplit_2[1] & ";"
				Case 2
					If Number($asplit_2[2]) >= Number($asplit_2[1]) Then
						$inumber = $asplit_2[1] - 1
						Do
							$inumber += 1
							$vrange &= $inumber & ";"
						Until $inumber = $asplit_2[2]
					EndIf
			EndSwitch
		Next
		$vrange = StringSplit(StringTrimRight($vrange, 1), ";")
	EndIf
	If $vrange[1] < 0 OR $vrange[$vrange[0]] > $idim_1 Then Return SetError(5, 0, -1)
	For $i = 2 To $vrange[0]
		If $vrange[$i] < $vrange[$i - 1] Then Return SetError(3, 0, -1)
	Next
	Local $icopyto_index = $idim_1 + $vrange[0]
	Local $iinsertpoint_index = $vrange[0]
	Local $iinsert_index = $vrange[$iinsertpoint_index]
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $iforce = $arrayfill_force_singleitem Then
				ReDim $aarray[$idim_1 + $vrange[0] + 1]
				For $ireadfromindex = $idim_1 To 0 Step -1
					$aarray[$icopyto_index] = $aarray[$ireadfromindex]
					$icopyto_index -= 1
					$iinsert_index = $vrange[$iinsertpoint_index]
					While $ireadfromindex = $iinsert_index
						$aarray[$icopyto_index] = $vvalue
						$icopyto_index -= 1
						$iinsertpoint_index -= 1
						If $iinsertpoint_index < 1 Then ExitLoop 2
						$iinsert_index = $vrange[$iinsertpoint_index]
					WEnd
				Next
				Return $idim_1 + $vrange[0] + 1
			EndIf
			ReDim $aarray[$idim_1 + $vrange[0] + 1]
			If IsArray($vvalue) Then
				If UBound($vvalue, $ubound_dimensions) <> 1 Then Return SetError(5, 0, -1)
				$hdatatype = 0
			Else
				Local $atmp = StringSplit($vvalue, $sdelim_item, $str_nocount + $str_entiresplit)
				If UBound($atmp, $ubound_rows) = 1 Then
					$atmp[0] = $vvalue
					$hdatatype = 0
				EndIf
				$vvalue = $atmp
			EndIf
			For $ireadfromindex = $idim_1 To 0 Step -1
				$aarray[$icopyto_index] = $aarray[$ireadfromindex]
				$icopyto_index -= 1
				$iinsert_index = $vrange[$iinsertpoint_index]
				While $ireadfromindex = $iinsert_index
					If $iinsertpoint_index <= UBound($vvalue, $ubound_rows) Then
						If IsFunc($hdatatype) Then
							$aarray[$icopyto_index] = $hdatatype($vvalue[$iinsertpoint_index - 1])
						Else
							$aarray[$icopyto_index] = $vvalue[$iinsertpoint_index - 1]
						EndIf
					Else
						$aarray[$icopyto_index] = ""
					EndIf
					$icopyto_index -= 1
					$iinsertpoint_index -= 1
					If $iinsertpoint_index = 0 Then ExitLoop 2
					$iinsert_index = $vrange[$iinsertpoint_index]
				WEnd
			Next
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns)
			If $istart < 0 OR $istart > $idim_2 - 1 Then Return SetError(6, 0, -1)
			Local $ivaldim_1, $ivaldim_2
			If IsArray($vvalue) Then
				If UBound($vvalue, $ubound_dimensions) <> 2 Then Return SetError(7, 0, -1)
				$ivaldim_1 = UBound($vvalue, $ubound_rows)
				$ivaldim_2 = UBound($vvalue, $ubound_columns)
				$hdatatype = 0
			Else
				$asplit_1 = StringSplit($vvalue, $sdelim_row, $str_nocount + $str_entiresplit)
				$ivaldim_1 = UBound($asplit_1, $ubound_rows)
				StringReplace($asplit_1[0], $sdelim_item, "")
				$ivaldim_2 = @extended + 1
				Local $atmp[$ivaldim_1][$ivaldim_2]
				For $i = 0 To $ivaldim_1 - 1
					$asplit_2 = StringSplit($asplit_1[$i], $sdelim_item, $str_nocount + $str_entiresplit)
					For $j = 0 To $ivaldim_2 - 1
						$atmp[$i][$j] = $asplit_2[$j]
					Next
				Next
				$vvalue = $atmp
			EndIf
			If UBound($vvalue, $ubound_columns) + $istart > UBound($aarray, $ubound_columns) Then Return SetError(8, 0, -1)
			ReDim $aarray[$idim_1 + $vrange[0] + 1][$idim_2]
			For $ireadfromindex = $idim_1 To 0 Step -1
				For $j = 0 To $idim_2 - 1
					$aarray[$icopyto_index][$j] = $aarray[$ireadfromindex][$j]
				Next
				$icopyto_index -= 1
				$iinsert_index = $vrange[$iinsertpoint_index]
				While $ireadfromindex = $iinsert_index
					For $j = 0 To $idim_2 - 1
						If $j < $istart Then
							$aarray[$icopyto_index][$j] = ""
						ElseIf $j - $istart > $ivaldim_2 - 1 Then
							$aarray[$icopyto_index][$j] = ""
						Else
							If $iinsertpoint_index - 1 < $ivaldim_1 Then
								If IsFunc($hdatatype) Then
									$aarray[$icopyto_index][$j] = $hdatatype($vvalue[$iinsertpoint_index - 1][$j - $istart])
								Else
									$aarray[$icopyto_index][$j] = $vvalue[$iinsertpoint_index - 1][$j - $istart]
								EndIf
							Else
								$aarray[$icopyto_index][$j] = ""
							EndIf
						EndIf
					Next
					$icopyto_index -= 1
					$iinsertpoint_index -= 1
					If $iinsertpoint_index = 0 Then ExitLoop 2
					$iinsert_index = $vrange[$iinsertpoint_index]
				WEnd
			Next
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return UBound($aarray, $ubound_rows)
EndFunc

Func _arraymax(Const ByRef $aarray, $icompnumeric = 0, $istart = -1, $iend = -1, $isubitem = 0)
	Local $iresult = _arraymaxindex($aarray, $icompnumeric, $istart, $iend, $isubitem)
	If @error Then Return SetError(@error, 0, "")
	If UBound($aarray, $ubound_dimensions) = 1 Then
		Return $aarray[$iresult]
	Else
		Return $aarray[$iresult][$isubitem]
	EndIf
EndFunc

Func _arraymaxindex(Const ByRef $aarray, $icompnumeric = 0, $istart = -1, $iend = -1, $isubitem = 0)
	If $icompnumeric = Default Then $icompnumeric = 0
	If $istart = Default Then $istart = -1
	If $iend = Default Then $iend = -1
	If $isubitem = Default Then $isubitem = 0
	Local $iret = __array_minmaxindex($aarray, $icompnumeric, $istart, $iend, $isubitem, __array_greaterthan)
	Return SetError(@error, 0, $iret)
EndFunc

Func _arraymin(Const ByRef $aarray, $icompnumeric = 0, $istart = -1, $iend = -1, $isubitem = 0)
	Local $iresult = _arrayminindex($aarray, $icompnumeric, $istart, $iend, $isubitem)
	If @error Then Return SetError(@error, 0, "")
	If UBound($aarray, $ubound_dimensions) = 1 Then
		Return $aarray[$iresult]
	Else
		Return $aarray[$iresult][$isubitem]
	EndIf
EndFunc

Func _arrayminindex(Const ByRef $aarray, $icompnumeric = 0, $istart = -1, $iend = -1, $isubitem = 0)
	If $icompnumeric = Default Then $icompnumeric = 0
	If $istart = Default Then $istart = -1
	If $iend = Default Then $iend = -1
	If $isubitem = Default Then $isubitem = 0
	Local $iret = __array_minmaxindex($aarray, $icompnumeric, $istart, $iend, $isubitem, __array_lessthan)
	Return SetError(@error, 0, $iret)
EndFunc

Func _arraypermute(ByRef $aarray, $sdelimiter = "")
	If $sdelimiter = Default Then $sdelimiter = ""
	If NOT IsArray($aarray) Then Return SetError(1, 0, 0)
	If UBound($aarray, $ubound_dimensions) <> 1 Then Return SetError(2, 0, 0)
	Local $isize = UBound($aarray), $ifactorial = 1, $aidx[$isize], $aresult[1], $icount = 1
	If UBound($aarray) Then
		For $i = 0 To $isize - 1
			$aidx[$i] = $i
		Next
		For $i = $isize To 1 Step -1
			$ifactorial *= $i
		Next
		ReDim $aresult[$ifactorial + 1]
		$aresult[0] = $ifactorial
		__array_exeterinternal($aarray, 0, $isize, $sdelimiter, $aidx, $aresult, $icount)
	Else
		$aresult[0] = 0
	EndIf
	Return $aresult
EndFunc

Func _arraypop(ByRef $aarray)
	If (NOT IsArray($aarray)) Then Return SetError(1, 0, "")
	If UBound($aarray, $ubound_dimensions) <> 1 Then Return SetError(2, 0, "")
	Local $iubound = UBound($aarray) - 1
	If $iubound = -1 Then Return SetError(3, 0, "")
	Local $slastval = $aarray[$iubound]
	If $iubound > -1 Then
		ReDim $aarray[$iubound]
	EndIf
	Return $slastval
EndFunc

Func _arraypush(ByRef $aarray, $vvalue, $idirection = 0)
	If $idirection = Default Then $idirection = 0
	If (NOT IsArray($aarray)) Then Return SetError(1, 0, 0)
	If UBound($aarray, $ubound_dimensions) <> 1 Then Return SetError(3, 0, 0)
	Local $iubound = UBound($aarray) - 1
	If IsArray($vvalue) Then
		Local $iubounds = UBound($vvalue)
		If ($iubounds - 1) > $iubound Then Return SetError(2, 0, 0)
		If $idirection Then
			For $i = $iubound To $iubounds Step -1
				$aarray[$i] = $aarray[$i - $iubounds]
			Next
			For $i = 0 To $iubounds - 1
				$aarray[$i] = $vvalue[$i]
			Next
		Else
			For $i = 0 To $iubound - $iubounds
				$aarray[$i] = $aarray[$i + $iubounds]
			Next
			For $i = 0 To $iubounds - 1
				$aarray[$i + $iubound - $iubounds + 1] = $vvalue[$i]
			Next
		EndIf
	Else
		If $iubound > -1 Then
			If $idirection Then
				For $i = $iubound To 1 Step -1
					$aarray[$i] = $aarray[$i - 1]
				Next
				$aarray[0] = $vvalue
			Else
				For $i = 0 To $iubound - 1
					$aarray[$i] = $aarray[$i + 1]
				Next
				$aarray[$iubound] = $vvalue
			EndIf
		EndIf
	EndIf
	Return 1
EndFunc

Func _arrayreverse(ByRef $aarray, $istart = 0, $iend = 0)
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If NOT IsArray($aarray) Then Return SetError(1, 0, 0)
	If UBound($aarray, $ubound_dimensions) <> 1 Then Return SetError(3, 0, 0)
	If NOT UBound($aarray) Then Return SetError(4, 0, 0)
	Local $vtmp, $iubound = UBound($aarray) - 1
	If $iend < 1 OR $iend > $iubound Then $iend = $iubound
	If $istart < 0 Then $istart = 0
	If $istart > $iend Then Return SetError(2, 0, 0)
	For $i = $istart To Int(($istart + $iend - 1) / 2)
		$vtmp = $aarray[$i]
		$aarray[$i] = $aarray[$iend]
		$aarray[$iend] = $vtmp
		$iend -= 1
	Next
	Return 1
EndFunc

Func _arraysearch(Const ByRef $aarray, $vvalue, $istart = 0, $iend = 0, $icase = 0, $icompare = 0, $iforward = 1, $isubitem = -1, $brow = False)
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $icase = Default Then $icase = 0
	If $icompare = Default Then $icompare = 0
	If $iforward = Default Then $iforward = 1
	If $isubitem = Default Then $isubitem = -1
	If $brow = Default Then $brow = False
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray) - 1
	If $idim_1 = -1 Then Return SetError(3, 0, -1)
	Local $idim_2 = UBound($aarray, $ubound_columns) - 1
	Local $bcomptype = False
	If $icompare = 2 Then
		$icompare = 0
		$bcomptype = True
	EndIf
	If $brow Then
		If UBound($aarray, $ubound_dimensions) = 1 Then Return SetError(5, 0, -1)
		If $iend < 1 OR $iend > $idim_2 Then $iend = $idim_2
		If $istart < 0 Then $istart = 0
		If $istart > $iend Then Return SetError(4, 0, -1)
	Else
		If $iend < 1 OR $iend > $idim_1 Then $iend = $idim_1
		If $istart < 0 Then $istart = 0
		If $istart > $iend Then Return SetError(4, 0, -1)
	EndIf
	Local $istep = 1
	If NOT $iforward Then
		Local $itmp = $istart
		$istart = $iend
		$iend = $itmp
		$istep = -1
	EndIf
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If NOT $icompare Then
				If NOT $icase Then
					For $i = $istart To $iend Step $istep
						If $bcomptype AND VarGetType($aarray[$i]) <> VarGetType($vvalue) Then ContinueLoop
						If $aarray[$i] = $vvalue Then Return $i
					Next
				Else
					For $i = $istart To $iend Step $istep
						If $bcomptype AND VarGetType($aarray[$i]) <> VarGetType($vvalue) Then ContinueLoop
						If $aarray[$i] == $vvalue Then Return $i
					Next
				EndIf
			Else
				For $i = $istart To $iend Step $istep
					If $icompare = 3 Then
						If StringRegExp($aarray[$i], $vvalue) Then Return $i
					Else
						If StringInStr($aarray[$i], $vvalue, $icase) > 0 Then Return $i
					EndIf
				Next
			EndIf
		Case 2
			Local $idim_sub
			If $brow Then
				$idim_sub = $idim_1
				If $isubitem > $idim_sub Then $isubitem = $idim_sub
				If $isubitem < 0 Then
					$isubitem = 0
				Else
					$idim_sub = $isubitem
				EndIf
			Else
				$idim_sub = $idim_2
				If $isubitem > $idim_sub Then $isubitem = $idim_sub
				If $isubitem < 0 Then
					$isubitem = 0
				Else
					$idim_sub = $isubitem
				EndIf
			EndIf
			For $j = $isubitem To $idim_sub
				If NOT $icompare Then
					If NOT $icase Then
						For $i = $istart To $iend Step $istep
							If $brow Then
								If $bcomptype AND VarGetType($aarray[$j][$j]) <> VarGetType($vvalue) Then ContinueLoop
								If $aarray[$j][$i] = $vvalue Then Return $i
							Else
								If $bcomptype AND VarGetType($aarray[$i][$j]) <> VarGetType($vvalue) Then ContinueLoop
								If $aarray[$i][$j] = $vvalue Then Return $i
							EndIf
						Next
					Else
						For $i = $istart To $iend Step $istep
							If $brow Then
								If $bcomptype AND VarGetType($aarray[$j][$i]) <> VarGetType($vvalue) Then ContinueLoop
								If $aarray[$j][$i] == $vvalue Then Return $i
							Else
								If $bcomptype AND VarGetType($aarray[$i][$j]) <> VarGetType($vvalue) Then ContinueLoop
								If $aarray[$i][$j] == $vvalue Then Return $i
							EndIf
						Next
					EndIf
				Else
					For $i = $istart To $iend Step $istep
						If $icompare = 3 Then
							If $brow Then
								If StringRegExp($aarray[$j][$i], $vvalue) Then Return $i
							Else
								If StringRegExp($aarray[$i][$j], $vvalue) Then Return $i
							EndIf
						Else
							If $brow Then
								If StringInStr($aarray[$j][$i], $vvalue, $icase) > 0 Then Return $i
							Else
								If StringInStr($aarray[$i][$j], $vvalue, $icase) > 0 Then Return $i
							EndIf
						EndIf
					Next
				EndIf
			Next
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return SetError(6, 0, -1)
EndFunc

Func _arrayshuffle(ByRef $aarray, $istart_row = 0, $iend_row = 0, $icol = -1)
	If $istart_row = Default Then $istart_row = 0
	If $iend_row = Default Then $iend_row = 0
	If $icol = Default Then $icol = -1
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows)
	If $iend_row = 0 Then $iend_row = $idim_1 - 1
	If $istart_row < 0 OR $istart_row > $idim_1 - 1 Then Return SetError(3, 0, -1)
	If $iend_row < 1 OR $iend_row > $idim_1 - 1 Then Return SetError(3, 0, -1)
	If $istart_row > $iend_row Then Return SetError(4, 0, -1)
	Local $vtmp, $irand
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			For $i = $iend_row To $istart_row + 1 Step -1
				$irand = Random($istart_row, $i, 1)
				$vtmp = $aarray[$i]
				$aarray[$i] = $aarray[$irand]
				$aarray[$irand] = $vtmp
			Next
			Return 1
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns)
			If $icol < -1 OR $icol > $idim_2 - 1 Then Return SetError(5, 0, -1)
			Local $icol_start, $icol_end
			If $icol = -1 Then
				$icol_start = 0
				$icol_end = $idim_2 - 1
			Else
				$icol_start = $icol
				$icol_end = $icol
			EndIf
			For $i = $iend_row To $istart_row + 1 Step -1
				$irand = Random($istart_row, $i, 1)
				For $j = $icol_start To $icol_end
					$vtmp = $aarray[$i][$j]
					$aarray[$i][$j] = $aarray[$irand][$j]
					$aarray[$irand][$j] = $vtmp
				Next
			Next
			Return 1
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
EndFunc

Func _arraysort(ByRef $aarray, $idescending = 0, $istart = 0, $iend = 0, $isubitem = 0, $ipivot = 0)
	If $idescending = Default Then $idescending = 0
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $isubitem = Default Then $isubitem = 0
	If $ipivot = Default Then $ipivot = 0
	If NOT IsArray($aarray) Then Return SetError(1, 0, 0)
	Local $iubound = UBound($aarray) - 1
	If $iubound = -1 Then Return SetError(5, 0, 0)
	If $iend = Default Then $iend = 0
	If $iend < 1 OR $iend > $iubound OR $iend = Default Then $iend = $iubound
	If $istart < 0 OR $istart = Default Then $istart = 0
	If $istart > $iend Then Return SetError(2, 0, 0)
	If $idescending = Default Then $idescending = 0
	If $ipivot = Default Then $ipivot = 0
	If $isubitem = Default Then $isubitem = 0
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $ipivot Then
				__arraydualpivotsort($aarray, $istart, $iend)
			Else
				__arrayquicksort1d($aarray, $istart, $iend)
			EndIf
			If $idescending Then _arrayreverse($aarray, $istart, $iend)
		Case 2
			If $ipivot Then Return SetError(6, 0, 0)
			Local $isubmax = UBound($aarray, $ubound_columns) - 1
			If $isubitem > $isubmax Then Return SetError(3, 0, 0)
			If $idescending Then
				$idescending = -1
			Else
				$idescending = 1
			EndIf
			__arrayquicksort2d($aarray, $idescending, $istart, $iend, $isubitem, $isubmax)
		Case Else
			Return SetError(4, 0, 0)
	EndSwitch
	Return 1
EndFunc

Func __arrayquicksort1d(ByRef $aarray, Const ByRef $istart, Const ByRef $iend)
	If $iend <= $istart Then Return
	Local $vtmp
	If ($iend - $istart) < 15 Then
		Local $vcur
		For $i = $istart + 1 To $iend
			$vtmp = $aarray[$i]
			If IsNumber($vtmp) Then
				For $j = $i - 1 To $istart Step -1
					$vcur = $aarray[$j]
					If ($vtmp >= $vcur AND IsNumber($vcur)) OR (NOT IsNumber($vcur) AND StringCompare($vtmp, $vcur) >= 0) Then ExitLoop
					$aarray[$j + 1] = $vcur
				Next
			Else
				For $j = $i - 1 To $istart Step -1
					If (StringCompare($vtmp, $aarray[$j]) >= 0) Then ExitLoop
					$aarray[$j + 1] = $aarray[$j]
				Next
			EndIf
			$aarray[$j + 1] = $vtmp
		Next
		Return
	EndIf
	Local $l = $istart, $r = $iend, $vpivot = $aarray[Int(($istart + $iend) / 2)], $bnum = IsNumber($vpivot)
	Do
		If $bnum Then
			While ($aarray[$l] < $vpivot AND IsNumber($aarray[$l])) OR (NOT IsNumber($aarray[$l]) AND StringCompare($aarray[$l], $vpivot) < 0)
				$l += 1
			WEnd
			While ($aarray[$r] > $vpivot AND IsNumber($aarray[$r])) OR (NOT IsNumber($aarray[$r]) AND StringCompare($aarray[$r], $vpivot) > 0)
				$r -= 1
			WEnd
		Else
			While (StringCompare($aarray[$l], $vpivot) < 0)
				$l += 1
			WEnd
			While (StringCompare($aarray[$r], $vpivot) > 0)
				$r -= 1
			WEnd
		EndIf
		If $l <= $r Then
			$vtmp = $aarray[$l]
			$aarray[$l] = $aarray[$r]
			$aarray[$r] = $vtmp
			$l += 1
			$r -= 1
		EndIf
	Until $l > $r
	__arrayquicksort1d($aarray, $istart, $r)
	__arrayquicksort1d($aarray, $l, $iend)
EndFunc

Func __arrayquicksort2d(ByRef $aarray, Const ByRef $istep, Const ByRef $istart, Const ByRef $iend, Const ByRef $isubitem, Const ByRef $isubmax)
	If $iend <= $istart Then Return
	Local $vtmp, $l = $istart, $r = $iend, $vpivot = $aarray[Int(($istart + $iend) / 2)][$isubitem], $bnum = IsNumber($vpivot)
	Do
		If $bnum Then
			While ($istep * ($aarray[$l][$isubitem] - $vpivot) < 0 AND IsNumber($aarray[$l][$isubitem])) OR (NOT IsNumber($aarray[$l][$isubitem]) AND $istep * StringCompare($aarray[$l][$isubitem], $vpivot) < 0)
				$l += 1
			WEnd
			While ($istep * ($aarray[$r][$isubitem] - $vpivot) > 0 AND IsNumber($aarray[$r][$isubitem])) OR (NOT IsNumber($aarray[$r][$isubitem]) AND $istep * StringCompare($aarray[$r][$isubitem], $vpivot) > 0)
				$r -= 1
			WEnd
		Else
			While ($istep * StringCompare($aarray[$l][$isubitem], $vpivot) < 0)
				$l += 1
			WEnd
			While ($istep * StringCompare($aarray[$r][$isubitem], $vpivot) > 0)
				$r -= 1
			WEnd
		EndIf
		If $l <= $r Then
			For $i = 0 To $isubmax
				$vtmp = $aarray[$l][$i]
				$aarray[$l][$i] = $aarray[$r][$i]
				$aarray[$r][$i] = $vtmp
			Next
			$l += 1
			$r -= 1
		EndIf
	Until $l > $r
	__arrayquicksort2d($aarray, $istep, $istart, $r, $isubitem, $isubmax)
	__arrayquicksort2d($aarray, $istep, $l, $iend, $isubitem, $isubmax)
EndFunc

Func __arraydualpivotsort(ByRef $aarray, $ipivot_left, $ipivot_right, $bleftmost = True)
	If $ipivot_left > $ipivot_right Then Return
	Local $ilength = $ipivot_right - $ipivot_left + 1
	Local $i, $j, $k, $iai, $iak, $ia1, $ia2, $ilast
	If $ilength < 45 Then
		If $bleftmost Then
			$i = $ipivot_left
			While $i < $ipivot_right
				$j = $i
				$iai = $aarray[$i + 1]
				While $iai < $aarray[$j]
					$aarray[$j + 1] = $aarray[$j]
					$j -= 1
					If $j + 1 = $ipivot_left Then ExitLoop
				WEnd
				$aarray[$j + 1] = $iai
				$i += 1
			WEnd
		Else
			While 1
				If $ipivot_left >= $ipivot_right Then Return 1
				$ipivot_left += 1
				If $aarray[$ipivot_left] < $aarray[$ipivot_left - 1] Then ExitLoop
			WEnd
			While 1
				$k = $ipivot_left
				$ipivot_left += 1
				If $ipivot_left > $ipivot_right Then ExitLoop
				$ia1 = $aarray[$k]
				$ia2 = $aarray[$ipivot_left]
				If $ia1 < $ia2 Then
					$ia2 = $ia1
					$ia1 = $aarray[$ipivot_left]
				EndIf
				$k -= 1
				While $ia1 < $aarray[$k]
					$aarray[$k + 2] = $aarray[$k]
					$k -= 1
				WEnd
				$aarray[$k + 2] = $ia1
				While $ia2 < $aarray[$k]
					$aarray[$k + 1] = $aarray[$k]
					$k -= 1
				WEnd
				$aarray[$k + 1] = $ia2
				$ipivot_left += 1
			WEnd
			$ilast = $aarray[$ipivot_right]
			$ipivot_right -= 1
			While $ilast < $aarray[$ipivot_right]
				$aarray[$ipivot_right + 1] = $aarray[$ipivot_right]
				$ipivot_right -= 1
			WEnd
			$aarray[$ipivot_right + 1] = $ilast
		EndIf
		Return 1
	EndIf
	Local $iseventh = BitShift($ilength, 3) + BitShift($ilength, 6) + 1
	Local $ie1, $ie2, $ie3, $ie4, $ie5, $t
	$ie3 = Ceiling(($ipivot_left + $ipivot_right) / 2)
	$ie2 = $ie3 - $iseventh
	$ie1 = $ie2 - $iseventh
	$ie4 = $ie3 + $iseventh
	$ie5 = $ie4 + $iseventh
	If $aarray[$ie2] < $aarray[$ie1] Then
		$t = $aarray[$ie2]
		$aarray[$ie2] = $aarray[$ie1]
		$aarray[$ie1] = $t
	EndIf
	If $aarray[$ie3] < $aarray[$ie2] Then
		$t = $aarray[$ie3]
		$aarray[$ie3] = $aarray[$ie2]
		$aarray[$ie2] = $t
		If $t < $aarray[$ie1] Then
			$aarray[$ie2] = $aarray[$ie1]
			$aarray[$ie1] = $t
		EndIf
	EndIf
	If $aarray[$ie4] < $aarray[$ie3] Then
		$t = $aarray[$ie4]
		$aarray[$ie4] = $aarray[$ie3]
		$aarray[$ie3] = $t
		If $t < $aarray[$ie2] Then
			$aarray[$ie3] = $aarray[$ie2]
			$aarray[$ie2] = $t
			If $t < $aarray[$ie1] Then
				$aarray[$ie2] = $aarray[$ie1]
				$aarray[$ie1] = $t
			EndIf
		EndIf
	EndIf
	If $aarray[$ie5] < $aarray[$ie4] Then
		$t = $aarray[$ie5]
		$aarray[$ie5] = $aarray[$ie4]
		$aarray[$ie4] = $t
		If $t < $aarray[$ie3] Then
			$aarray[$ie4] = $aarray[$ie3]
			$aarray[$ie3] = $t
			If $t < $aarray[$ie2] Then
				$aarray[$ie3] = $aarray[$ie2]
				$aarray[$ie2] = $t
				If $t < $aarray[$ie1] Then
					$aarray[$ie2] = $aarray[$ie1]
					$aarray[$ie1] = $t
				EndIf
			EndIf
		EndIf
	EndIf
	Local $iless = $ipivot_left
	Local $igreater = $ipivot_right
	If (($aarray[$ie1] <> $aarray[$ie2]) AND ($aarray[$ie2] <> $aarray[$ie3]) AND ($aarray[$ie3] <> $aarray[$ie4]) AND ($aarray[$ie4] <> $aarray[$ie5])) Then
		Local $ipivot_1 = $aarray[$ie2]
		Local $ipivot_2 = $aarray[$ie4]
		$aarray[$ie2] = $aarray[$ipivot_left]
		$aarray[$ie4] = $aarray[$ipivot_right]
		Do
			$iless += 1
		Until $aarray[$iless] >= $ipivot_1
		Do
			$igreater -= 1
		Until $aarray[$igreater] <= $ipivot_2
		$k = $iless
		While $k <= $igreater
			$iak = $aarray[$k]
			If $iak < $ipivot_1 Then
				$aarray[$k] = $aarray[$iless]
				$aarray[$iless] = $iak
				$iless += 1
			ElseIf $iak > $ipivot_2 Then
				While $aarray[$igreater] > $ipivot_2
					$igreater -= 1
					If $igreater + 1 = $k Then ExitLoop 2
				WEnd
				If $aarray[$igreater] < $ipivot_1 Then
					$aarray[$k] = $aarray[$iless]
					$aarray[$iless] = $aarray[$igreater]
					$iless += 1
				Else
					$aarray[$k] = $aarray[$igreater]
				EndIf
				$aarray[$igreater] = $iak
				$igreater -= 1
			EndIf
			$k += 1
		WEnd
		$aarray[$ipivot_left] = $aarray[$iless - 1]
		$aarray[$iless - 1] = $ipivot_1
		$aarray[$ipivot_right] = $aarray[$igreater + 1]
		$aarray[$igreater + 1] = $ipivot_2
		__arraydualpivotsort($aarray, $ipivot_left, $iless - 2, True)
		__arraydualpivotsort($aarray, $igreater + 2, $ipivot_right, False)
		If ($iless < $ie1) AND ($ie5 < $igreater) Then
			While $aarray[$iless] = $ipivot_1
				$iless += 1
			WEnd
			While $aarray[$igreater] = $ipivot_2
				$igreater -= 1
			WEnd
			$k = $iless
			While $k <= $igreater
				$iak = $aarray[$k]
				If $iak = $ipivot_1 Then
					$aarray[$k] = $aarray[$iless]
					$aarray[$iless] = $iak
					$iless += 1
				ElseIf $iak = $ipivot_2 Then
					While $aarray[$igreater] = $ipivot_2
						$igreater -= 1
						If $igreater + 1 = $k Then ExitLoop 2
					WEnd
					If $aarray[$igreater] = $ipivot_1 Then
						$aarray[$k] = $aarray[$iless]
						$aarray[$iless] = $ipivot_1
						$iless += 1
					Else
						$aarray[$k] = $aarray[$igreater]
					EndIf
					$aarray[$igreater] = $iak
					$igreater -= 1
				EndIf
				$k += 1
			WEnd
		EndIf
		__arraydualpivotsort($aarray, $iless, $igreater, False)
	Else
		Local $ipivot = $aarray[$ie3]
		$k = $iless
		While $k <= $igreater
			If $aarray[$k] = $ipivot Then
				$k += 1
				ContinueLoop
			EndIf
			$iak = $aarray[$k]
			If $iak < $ipivot Then
				$aarray[$k] = $aarray[$iless]
				$aarray[$iless] = $iak
				$iless += 1
			Else
				While $aarray[$igreater] > $ipivot
					$igreater -= 1
				WEnd
				If $aarray[$igreater] < $ipivot Then
					$aarray[$k] = $aarray[$iless]
					$aarray[$iless] = $aarray[$igreater]
					$iless += 1
				Else
					$aarray[$k] = $ipivot
				EndIf
				$aarray[$igreater] = $iak
				$igreater -= 1
			EndIf
			$k += 1
		WEnd
		__arraydualpivotsort($aarray, $ipivot_left, $iless - 1, True)
		__arraydualpivotsort($aarray, $igreater + 1, $ipivot_right, False)
	EndIf
EndFunc

Func _arrayswap(ByRef $aarray, $iindex_1, $iindex_2, $bcol = False, $istart = -1, $iend = -1)
	If $bcol = Default Then $bcol = False
	If $istart = Default Then $istart = -1
	If $iend = Default Then $iend = -1
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	Local $idim_2 = UBound($aarray, $ubound_columns) - 1
	If $idim_2 = -1 Then
		$bcol = False
		$istart = -1
		$iend = -1
	EndIf
	If $istart > $iend Then Return SetError(5, 0, -1)
	If $bcol Then
		If $iindex_1 < 0 OR $iindex_2 > $idim_2 Then Return SetError(3, 0, -1)
		If $istart = -1 Then $istart = 0
		If $iend = -1 Then $iend = $idim_1
	Else
		If $iindex_1 < 0 OR $iindex_2 > $idim_1 Then Return SetError(3, 0, -1)
		If $istart = -1 Then $istart = 0
		If $iend = -1 Then $iend = $idim_2
	EndIf
	Local $vtmp
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			$vtmp = $aarray[$iindex_1]
			$aarray[$iindex_1] = $aarray[$iindex_2]
			$aarray[$iindex_2] = $vtmp
		Case 2
			If $istart < -1 OR $iend < -1 Then Return SetError(4, 0, -1)
			If $bcol Then
				If $istart > $idim_1 OR $iend > $idim_1 Then Return SetError(4, 0, -1)
				For $j = $istart To $iend
					$vtmp = $aarray[$j][$iindex_1]
					$aarray[$j][$iindex_1] = $aarray[$j][$iindex_2]
					$aarray[$j][$iindex_2] = $vtmp
				Next
			Else
				If $istart > $idim_2 OR $iend > $idim_2 Then Return SetError(4, 0, -1)
				For $j = $istart To $iend
					$vtmp = $aarray[$iindex_1][$j]
					$aarray[$iindex_1][$j] = $aarray[$iindex_2][$j]
					$aarray[$iindex_2][$j] = $vtmp
				Next
			EndIf
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return 1
EndFunc

Func _arraytoclip(Const ByRef $aarray, $sdelim_col = "|", $istart_row = -1, $iend_row = -1, $sdelim_row = @CRLF, $istart_col = -1, $iend_col = -1)
	Local $sresult = _arraytostring($aarray, $sdelim_col, $istart_row, $iend_row, $sdelim_row, $istart_col, $iend_col)
	If @error Then Return SetError(@error, 0, 0)
	If ClipPut($sresult) Then Return 1
	Return SetError(-1, 0, 0)
EndFunc

Func _arraytostring(Const ByRef $aarray, $sdelim_col = "|", $istart_row = -1, $iend_row = -1, $sdelim_row = @CRLF, $istart_col = -1, $iend_col = -1)
	If $sdelim_col = Default Then $sdelim_col = "|"
	If $sdelim_row = Default Then $sdelim_row = @CRLF
	If $istart_row = Default Then $istart_row = -1
	If $iend_row = Default Then $iend_row = -1
	If $istart_col = Default Then $istart_col = -1
	If $iend_col = Default Then $iend_col = -1
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	If $istart_row = -1 Then $istart_row = 0
	If $iend_row = -1 Then $iend_row = $idim_1
	If $istart_row < -1 OR $iend_row < -1 Then Return SetError(3, 0, -1)
	If $istart_row > $idim_1 OR $iend_row > $idim_1 Then Return SetError(3, 0, "")
	If $istart_row > $iend_row Then Return SetError(4, 0, -1)
	Local $sret = ""
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			For $i = $istart_row To $iend_row
				$sret &= $aarray[$i] & $sdelim_col
			Next
			Return StringTrimRight($sret, StringLen($sdelim_col))
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns) - 1
			If $istart_col = -1 Then $istart_col = 0
			If $iend_col = -1 Then $iend_col = $idim_2
			If $istart_col < -1 OR $iend_col < -1 Then Return SetError(5, 0, -1)
			If $istart_col > $idim_2 OR $iend_col > $idim_2 Then Return SetError(5, 0, -1)
			If $istart_col > $iend_col Then Return SetError(6, 0, -1)
			For $i = $istart_row To $iend_row
				For $j = $istart_col To $iend_col
					$sret &= $aarray[$i][$j] & $sdelim_col
				Next
				$sret = StringTrimRight($sret, StringLen($sdelim_col)) & $sdelim_row
			Next
			Return StringTrimRight($sret, StringLen($sdelim_row))
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return 1
EndFunc

Func _arraytranspose(ByRef $aarray)
	Switch UBound($aarray, 0)
		Case 0
			Return SetError(2, 0, 0)
		Case 1
			Local $atemp[1][UBound($aarray)]
			For $i = 0 To UBound($aarray) - 1
				$atemp[0][$i] = $aarray[$i]
			Next
			$aarray = $atemp
		Case 2
			Local $idim_1 = UBound($aarray, 1), $idim_2 = UBound($aarray, 2)
			If $idim_1 <> $idim_2 Then
				Local $atemp[$idim_2][$idim_1]
				For $i = 0 To $idim_1 - 1
					For $j = 0 To $idim_2 - 1
						$atemp[$j][$i] = $aarray[$i][$j]
					Next
				Next
				$aarray = $atemp
			Else
				Local $velement
				For $i = 0 To $idim_1 - 1
					For $j = $i + 1 To $idim_2 - 1
						$velement = $aarray[$i][$j]
						$aarray[$i][$j] = $aarray[$j][$i]
						$aarray[$j][$i] = $velement
					Next
				Next
			EndIf
		Case Else
			Return SetError(1, 0, 0)
	EndSwitch
	Return 1
EndFunc

Func _arraytrim(ByRef $aarray, $itrimnum, $idirection = 0, $istart = 0, $iend = 0, $isubitem = 0)
	If $idirection = Default Then $idirection = 0
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $isubitem = Default Then $isubitem = 0
	If NOT IsArray($aarray) Then Return SetError(1, 0, 0)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	If $iend = 0 Then $iend = $idim_1
	If $istart > $iend Then Return SetError(3, 0, -1)
	If $istart < 0 OR $iend < 0 Then Return SetError(3, 0, -1)
	If $istart > $idim_1 OR $iend > $idim_1 Then Return SetError(3, 0, -1)
	If $istart > $iend Then Return SetError(4, 0, -1)
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $idirection Then
				For $i = $istart To $iend
					$aarray[$i] = StringTrimRight($aarray[$i], $itrimnum)
				Next
			Else
				For $i = $istart To $iend
					$aarray[$i] = StringTrimLeft($aarray[$i], $itrimnum)
				Next
			EndIf
		Case 2
			Local $idim_2 = UBound($aarray, $ubound_columns) - 1
			If $isubitem < 0 OR $isubitem > $idim_2 Then Return SetError(5, 0, -1)
			If $idirection Then
				For $i = $istart To $iend
					$aarray[$i][$isubitem] = StringTrimRight($aarray[$i][$isubitem], $itrimnum)
				Next
			Else
				For $i = $istart To $iend
					$aarray[$i][$isubitem] = StringTrimLeft($aarray[$i][$isubitem], $itrimnum)
				Next
			EndIf
		Case Else
			Return SetError(2, 0, 0)
	EndSwitch
	Return 1
EndFunc

Func _arrayunique(Const ByRef $aarray, $icolumn = 0, $ibase = 0, $icase = 0, $icount = $arrayunique_count, $iinttype = $arrayunique_auto)
	If $icolumn = Default Then $icolumn = 0
	If $ibase = Default Then $ibase = 0
	If $icase = Default Then $icase = 0
	If $icount = Default Then $icount = $arrayunique_count
	If UBound($aarray, $ubound_rows) = 0 Then Return SetError(1, 0, 0)
	Local $idims = UBound($aarray, $ubound_dimensions), $inumcolumns = UBound($aarray, $ubound_columns)
	If $idims > 2 Then Return SetError(2, 0, 0)
	If $ibase < 0 OR $ibase > 1 OR (NOT IsInt($ibase)) Then Return SetError(3, 0, 0)
	If $icase < 0 OR $icase > 1 OR (NOT IsInt($icase)) Then Return SetError(3, 0, 0)
	If $icount < 0 OR $icount > 1 OR (NOT IsInt($icount)) Then Return SetError(4, 0, 0)
	If $iinttype < 0 OR $iinttype > 4 OR (NOT IsInt($iinttype)) Then Return SetError(5, 0, 0)
	If $icolumn < 0 OR ($inumcolumns = 0 AND $icolumn > 0) OR ($inumcolumns > 0 AND $icolumn >= $inumcolumns) Then Return SetError(6, 0, 0)
	If $iinttype = $arrayunique_auto Then
		Local $vfirstelem = (($idims = 1) ? ($aarray[$ibase]) : ($aarray[$icolumn][$ibase]))
		If IsInt($vfirstelem) Then
			Switch VarGetType($vfirstelem)
				Case "Int32"
					$iinttype = $arrayunique_force32
				Case "Int64"
					$iinttype = $arrayunique_force64
			EndSwitch
		Else
			$iinttype = $arrayunique_force32
		EndIf
	EndIf
	ObjEvent("AutoIt.Error", "__ArrayUnique_AutoErrFunc")
	Local $odictionary = ObjCreate("Scripting.Dictionary")
	$odictionary.comparemode = Number(NOT $icase)
	Local $velem, $stype, $vkey, $bcomerror = False
	For $i = $ibase To UBound($aarray) - 1
		If $idims = 1 Then
			$velem = $aarray[$i]
		Else
			$velem = $aarray[$i][$icolumn]
		EndIf
		Switch $iinttype
			Case $arrayunique_force32
				$odictionary.item($velem)
				If @error Then
					$bcomerror = True
					ExitLoop
				EndIf
			Case $arrayunique_force64
				$stype = VarGetType($velem)
				If $stype = "Int32" Then
					$bcomerror = True
					ExitLoop
				EndIf
				$vkey = "#" & $stype & "#" & String($velem)
				If NOT $odictionary.item($vkey) Then
					$odictionary($vkey) = $velem
				EndIf
			Case $arrayunique_match
				$stype = VarGetType($velem)
				If StringLeft($stype, 3) = "Int" Then
					$vkey = "#Int#" & String($velem)
				Else
					$vkey = "#" & $stype & "#" & String($velem)
				EndIf
				If NOT $odictionary.item($vkey) Then
					$odictionary($vkey) = $velem
				EndIf
			Case $arrayunique_distinct
				$vkey = "#" & VarGetType($velem) & "#" & String($velem)
				If NOT $odictionary.item($vkey) Then
					$odictionary($vkey) = $velem
				EndIf
		EndSwitch
	Next
	Local $avalues, $j = 0
	If $bcomerror Then
		Return SetError(7, 0, 0)
	ElseIf $iinttype <> $arrayunique_force32 Then
		Local $avalues[$odictionary.count]
		For $vkey In $odictionary.keys()
			$avalues[$j] = $odictionary($vkey)
			If StringLeft($vkey, 5) = "#Ptr#" Then
				$avalues[$j] = Ptr($avalues[$j])
			EndIf
			$j += 1
		Next
	Else
		$avalues = $odictionary.keys()
	EndIf
	If $icount Then
		_arrayinsert($avalues, 0, $odictionary.count)
	EndIf
	Return $avalues
EndFunc

Func _array1dtohistogram($aarray, $isizing = 100)
	If UBound($aarray, 0) > 1 Then Return SetError(1, 0, "")
	$isizing = $isizing * 8
	Local $t, $n, $imin = 0, $imax = 0, $ioffset = 0
	For $i = 0 To UBound($aarray) - 1
		$t = $aarray[$i]
		$t = IsNumber($t) ? Round($t) : 0
		If $t < $imin Then $imin = $t
		If $t > $imax Then $imax = $t
	Next
	Local $irange = Int(Round(($imax - $imin) / 8)) * 8
	Local $ispaceratio = 4
	For $i = 0 To UBound($aarray) - 1
		$t = $aarray[$i]
		If $t Then
			$n = Abs(Round(($isizing * $t) / $irange) / 8)
			$aarray[$i] = ""
			If $t > 0 Then
				If $imin Then
					$ioffset = Int(Abs(Round(($isizing * $imin) / $irange) / 8) / 8 * $ispaceratio)
					$aarray[$i] = __array_stringrepeat(ChrW(32), $ioffset)
				EndIf
			Else
				If $imin <> $t Then
					$ioffset = Int(Abs(Round(($isizing * ($t - $imin)) / $irange) / 8) / 8 * $ispaceratio)
					$aarray[$i] = __array_stringrepeat(ChrW(32), $ioffset)
				EndIf
			EndIf
			$aarray[$i] &= __array_stringrepeat(ChrW(9608), Int($n / 8))
			$n = Mod($n, 8)
			If $n > 0 Then $aarray[$i] &= ChrW(9608 + 8 - $n)
			$aarray[$i] &= " " & $t
		Else
			$aarray[$i] = ""
		EndIf
	Next
	Return $aarray
EndFunc

Func __array_stringrepeat($sstring, $irepeatcount)
	$irepeatcount = Int($irepeatcount)
	If StringLen($sstring) < 1 OR $irepeatcount <= 0 Then Return SetError(1, 0, "")
	Local $sresult = ""
	While $irepeatcount > 1
		If BitAND($irepeatcount, 1) Then $sresult &= $sstring
		$sstring &= $sstring
		$irepeatcount = BitShift($irepeatcount, 1)
	WEnd
	Return $sstring & $sresult
EndFunc

Func __array_exeterinternal(ByRef $aarray, $istart, $isize, $sdelimiter, ByRef $aidx, ByRef $aresult, ByRef $icount)
	If $istart == $isize - 1 Then
		For $i = 0 To $isize - 1
			$aresult[$icount] &= $aarray[$aidx[$i]] & $sdelimiter
		Next
		If $sdelimiter <> "" Then $aresult[$icount] = StringTrimRight($aresult[$icount], StringLen($sdelimiter))
		$icount += 1
	Else
		Local $itemp
		For $i = $istart To $isize - 1
			$itemp = $aidx[$i]
			$aidx[$i] = $aidx[$istart]
			$aidx[$istart] = $itemp
			__array_exeterinternal($aarray, $istart + 1, $isize, $sdelimiter, $aidx, $aresult, $icount)
			$aidx[$istart] = $aidx[$i]
			$aidx[$i] = $itemp
		Next
	EndIf
EndFunc

Func __array_combinations($in, $ir)
	Local $i_total = 1
	For $i = $ir To 1 Step -1
		$i_total *= ($in / $i)
		$in -= 1
	Next
	Return Round($i_total)
EndFunc

Func __array_getnext($in, $ir, ByRef $ileft, $itotal, ByRef $aidx)
	If $ileft == $itotal Then
		$ileft -= 1
		Return
	EndIf
	Local $i = $ir - 1
	While $aidx[$i] == $in - $ir + $i
		$i -= 1
	WEnd
	$aidx[$i] += 1
	For $j = $i + 1 To $ir - 1
		$aidx[$j] = $aidx[$i] + $j - $i
	Next
	$ileft -= 1
EndFunc

Func __array_minmaxindex(Const ByRef $aarray, $icompnumeric, $istart, $iend, $isubitem, $fucomparison)
	If $icompnumeric = Default Then $icompnumeric = 0
	If $icompnumeric <> 1 Then $icompnumeric = 0
	If $istart = Default Then $istart = 0
	If $iend = Default Then $iend = 0
	If $isubitem = Default Then $isubitem = 0
	If NOT IsArray($aarray) Then Return SetError(1, 0, -1)
	Local $idim_1 = UBound($aarray, $ubound_rows) - 1
	If $idim_1 < 0 Then Return SetError(1, 0, -1)
	If $iend = -1 Then $iend = $idim_1
	If $istart = -1 Then $istart = 0
	If $istart < -1 OR $iend < -1 Then Return SetError(3, 0, -1)
	If $istart > $idim_1 OR $iend > $idim_1 Then Return SetError(3, 0, -1)
	If $istart > $iend Then Return SetError(4, 0, -1)
	If $idim_1 < 0 Then Return SetError(5, 0, -1)
	Local $imaxminindex = $istart
	Switch UBound($aarray, $ubound_dimensions)
		Case 1
			If $icompnumeric Then
				For $i = $istart To $iend
					If $fucomparison(Number($aarray[$i]), Number($aarray[$imaxminindex])) Then $imaxminindex = $i
				Next
			Else
				For $i = $istart To $iend
					If $fucomparison($aarray[$i], $aarray[$imaxminindex]) Then $imaxminindex = $i
				Next
			EndIf
		Case 2
			If $isubitem < 0 OR $isubitem > UBound($aarray, $ubound_columns) - 1 Then Return SetError(6, 0, -1)
			If $icompnumeric Then
				For $i = $istart To $iend
					If $fucomparison(Number($aarray[$i][$isubitem]), Number($aarray[$imaxminindex][$isubitem])) Then $imaxminindex = $i
				Next
			Else
				For $i = $istart To $iend
					If $fucomparison($aarray[$i][$isubitem], $aarray[$imaxminindex][$isubitem]) Then $imaxminindex = $i
				Next
			EndIf
		Case Else
			Return SetError(2, 0, -1)
	EndSwitch
	Return $imaxminindex
EndFunc

Func __array_greaterthan($vvalue1, $vvalue2)
	Return $vvalue1 > $vvalue2
EndFunc

Func __array_lessthan($vvalue1, $vvalue2)
	Return $vvalue1 < $vvalue2
EndFunc

Func __arrayunique_autoerrfunc()
EndFunc

#RequireAdmin
If @AutoItX64 Then
	MsgBox(16, "Error!", "Please run all bots in 32-bit (x86) mode.")
	Exit
EndIf
#Region Declarations
	Local $mkernelhandle
	Local $mgwprochandle
	Local $mgwhwnd
	Local $mmemory
	Local $mlabels[1][2]
	Local $mbase = 14548992
	Local $masmstring, $masmsize, $masmcodeoffset
	Local $mgui = GUICreate("GWA"), $mskillactivate, $mskillcancel, $mskillcomplete, $mchatreceive, $mloadfinished
	Local $mskilllogstruct = DllStructCreate("dword;dword;dword;float")
	Local $mskilllogstructptr = DllStructGetPtr($mskilllogstruct)
	Local $mchatlogstruct = DllStructCreate("dword;wchar[256]")
	Local $mchatlogstructptr = DllStructGetPtr($mchatlogstruct)
	GUIRegisterMsg(1281, "Event")
	Local $mqueuecounter, $mqueuesize, $mqueuebase
	Local $mtargetlogbase
	Local $mstringlogbase
	Local $mskillbase
	Local $mensureenglish
	Local $mmyid, $mcurrenttarget
	Local $magentbase
	Local $mbasepointer
	Local $mregion, $mlanguage
	Local $mping
	Local $mcharname
	Local $mmapid
	Local $mmaxagents
	Local $mmaploading
	Local $mmapisloaded
	Local $mloggedin
	Local $mstringhandlerptr
	Local $mwritechatsender
	Local $mtraderquoteid, $mtradercostid, $mtradercostvalue
	Local $mskilltimer
	Local $mbuildnumber
	Local $mzoomstill, $mzoommoving
	Local $mdisablerendering
	Local $magentcopycount
	Local $magentcopybase
	Local $musestringlog
	Local $museeventsystem
#EndRegion Declarations
#Region CommandStructs
	Local $museskill = DllStructCreate("ptr;dword;dword;dword")
	Local $museskillptr = DllStructGetPtr($museskill)
	Local $mmove = DllStructCreate("ptr;float;float;float")
	Local $mmoveptr = DllStructGetPtr($mmove)
	Local $mchangetarget = DllStructCreate("ptr;dword")
	Local $mchangetargetptr = DllStructGetPtr($mchangetarget)
	Local $mmove = DllStructCreate("ptr;float;float;float")
	Local $mmoveptr = DllStructGetPtr($mmove)
	Local $mpacket = DllStructCreate("ptr;dword;dword;dword;dword;dword;dword;dword;dword;dword;dword;dword;dword")
	Local $mpacketptr = DllStructGetPtr($mpacket)
	Local $mwritechat = DllStructCreate("ptr")
	Local $mwritechatptr = DllStructGetPtr($mwritechat)
	Local $msellitem = DllStructCreate("ptr;dword;dword")
	Local $msellitemptr = DllStructGetPtr($msellitem)
	Local $maction = DllStructCreate("ptr;dword;dword")
	Local $mactionptr = DllStructGetPtr($maction)
	Local $mtogglelanguage = DllStructCreate("ptr;dword")
	Local $mtogglelanguageptr = DllStructGetPtr($mtogglelanguage)
	Local $museheroskill = DllStructCreate("ptr;dword;dword;dword")
	Local $museheroskillptr = DllStructGetPtr($museheroskill)
	Local $mbuyitem = DllStructCreate("ptr;dword;dword;dword")
	Local $mbuyitemptr = DllStructGetPtr($mbuyitem)
	Local $msendchat = DllStructCreate("ptr;dword")
	Local $msendchatptr = DllStructGetPtr($msendchat)
	Local $mrequestquote = DllStructCreate("ptr;dword")
	Local $mrequestquoteptr = DllStructGetPtr($mrequestquote)
	Local $mrequestquotesell = DllStructCreate("ptr;dword")
	Local $mrequestquotesellptr = DllStructGetPtr($mrequestquotesell)
	Local $mtraderbuy = DllStructCreate("ptr")
	Local $mtraderbuyptr = DllStructGetPtr($mtraderbuy)
	Local $mtradersell = DllStructCreate("ptr")
	Local $mtradersellptr = DllStructGetPtr($mtradersell)
	Local $msalvage = DllStructCreate("ptr;dword;dword;dword")
	Local $msalvageptr = DllStructGetPtr($msalvage)
	Local $mincreaseattribute = DllStructCreate("ptr;dword;dword")
	Local $mincreaseattributeptr = DllStructGetPtr($mincreaseattribute)
	Local $mdecreaseattribute = DllStructCreate("ptr;dword;dword")
	Local $mdecreaseattributeptr = DllStructGetPtr($mdecreaseattribute)
	Local $mmakeagentarray = DllStructCreate("ptr;dword")
	Local $mmakeagentarrayptr = DllStructGetPtr($mmakeagentarray)
#EndRegion CommandStructs
#Region Memory

	Func memoryopen($apid)
		$mkernelhandle = DllOpen("kernel32.dll")
		Local $lopenprocess = DllCall($mkernelhandle, "int", "OpenProcess", "int", 2035711, "int", 1, "int", $apid)
		$mgwprochandle = $lopenprocess[0]
	EndFunc

	Func memoryclose()
		DllCall($mkernelhandle, "int", "CloseHandle", "int", $mgwprochandle)
		DllClose($mkernelhandle)
	EndFunc

	Func writebinary($abinarystring, $aaddress)
		Local $ldata = DllStructCreate("byte[" & 0.5 * StringLen($abinarystring) & "]"), $i
		For $i = 1 To DllStructGetSize($ldata)
			DllStructSetData($ldata, 1, Dec(StringMid($abinarystring, 2 * $i - 1, 2)), $i)
		Next
		DllCall($mkernelhandle, "int", "WriteProcessMemory", "int", $mgwprochandle, "ptr", $aaddress, "ptr", DllStructGetPtr($ldata), "int", DllStructGetSize($ldata), "int", 0)
	EndFunc

	Func memorywrite($aaddress, $adata, $atype = "dword")
		Local $lbuffer = DllStructCreate($atype)
		DllStructSetData($lbuffer, 1, $adata)
		DllCall($mkernelhandle, "int", "WriteProcessMemory", "int", $mgwprochandle, "int", $aaddress, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
	EndFunc

	Func memoryread($aaddress, $atype = "dword")
		Local $lbuffer = DllStructCreate($atype)
		DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $aaddress, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
		Return DllStructGetData($lbuffer, 1)
	EndFunc

	Func memoryreadptr($aaddress, $aoffset, $atype = "dword")
		Local $lpointercount = UBound($aoffset) - 2
		Local $lbuffer = DllStructCreate("dword")
		For $i = 0 To $lpointercount
			$aaddress += $aoffset[$i]
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $aaddress, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
			$aaddress = DllStructGetData($lbuffer, 1)
			If $aaddress == 0 Then
				Local $ldata[2] = [0, 0]
				Return $ldata
			EndIf
		Next
		$aaddress += $aoffset[$lpointercount + 1]
		$lbuffer = DllStructCreate($atype)
		DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $aaddress, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
		Local $ldata[2] = [$aaddress, DllStructGetData($lbuffer, 1)]
		Return $ldata
	EndFunc

	Func swapendian($ahex)
		Return StringMid($ahex, 7, 2) & StringMid($ahex, 5, 2) & StringMid($ahex, 3, 2) & StringMid($ahex, 1, 2)
	EndFunc

#EndRegion Memory
#Region Initialisation

	Func getloggedcharnames()
		Local $array = scangw()
		If $array[0] <= 1 Then Return ""
		Local $ret = $array[1]
		For $i = 2 To $array[0]
			$ret &= "|"
			$ret &= $array[$i]
		Next
		Return $ret
	EndFunc

	Func scangw()
		Local $lwinlist = WinList("Guild Wars")
		Local $lreturnarray[1] = [0]
		Local $lpid
		For $i = 1 To $lwinlist[0][0]
			$mgwhwnd = $lwinlist[$i][1]
			$lpid = WinGetProcess($mgwhwnd)
			If __processgetname($lpid) <> "gw.exe" Then ContinueLoop
			memoryopen(WinGetProcess($mgwhwnd))
			If $mgwprochandle Then
				$lreturnarray[0] += 1
				ReDim $lreturnarray[$lreturnarray[0] + 1]
				$lreturnarray[$lreturnarray[0]] = scanforcharname()
			EndIf
			memoryclose()
			$mgwprochandle = 0
		Next
		Return $lreturnarray
	EndFunc

	Func initialize($agw, $bchangetitle = True, $ausestringlog = False, $auseeventsystem = True)
		Local $lwinlist
		$musestringlog = $ausestringlog
		$museeventsystem = $auseeventsystem
		If IsString($agw) Then
			$lwinlist = WinList("Guild Wars")
			For $i = 1 To $lwinlist[0][0]
				$mgwhwnd = $lwinlist[$i][1]
				memoryopen(WinGetProcess($mgwhwnd))
				If $mgwprochandle Then
					If StringRegExp(scanforcharname(), $agw) = 1 Then ExitLoop
				EndIf
				memoryclose()
				$mgwprochandle = 0
			Next
		Else
			$lwinlist = WinList()
			For $i = 1 To $lwinlist[0][0]
				$mgwhwnd = $lwinlist[$i][1]
				If WinGetProcess($mgwhwnd) = $agw Then
					memoryopen($agw)
					scanforcharname()
					ExitLoop
				EndIf
			Next
		EndIf
		If $mgwprochandle = 0 Then Return 0
		scan()
		$mbasepointer = memoryread(getscannedaddress("ScanBasePointer", -3))
		setvalue("BasePointer", "0x" & Hex($mbasepointer, 8))
		$magentbase = memoryread(getscannedaddress("ScanAgentBase", 13))
		setvalue("AgentBase", "0x" & Hex($magentbase, 8))
		$mmaxagents = $magentbase + 8
		setvalue("MaxAgents", "0x" & Hex($mmaxagents, 8))
		$mmyid = $magentbase - 84
		setvalue("MyID", "0x" & Hex($mmyid, 8))
		$mmaploading = $magentbase - 240
		$mcurrenttarget = $magentbase - 1280
		setvalue("PacketLocation", "0x" & Hex(memoryread(getscannedaddress("ScanBaseOffset", -3)), 8))
		$mping = memoryread(getscannedaddress("ScanPing", -8))
		$mmapid = memoryread(getscannedaddress("ScanMapID", 71))
		$mloggedin = memoryread(getscannedaddress("ScanLoggedIn", -3)) + 4
		$mregion = memoryread(getscannedaddress("ScanRegion", 8))
		$mlanguage = memoryread(getscannedaddress("ScanLanguage", 8)) + 12
		$mskillbase = memoryread(getscannedaddress("ScanSkillBase", 9))
		$mskilltimer = memoryread(getscannedaddress("ScanSkillTimer", -3))
		$mbuildnumber = memoryread(getscannedaddress("ScanBuildNumber", 84))
		$mzoomstill = getscannedaddress("ScanZoomStill", -1)
		$mzoommoving = getscannedaddress("ScanZoomMoving", 5)
		Local $ltemp
		$ltemp = getscannedaddress("ScanEngine", -16)
		setvalue("MainStart", "0x" & Hex($ltemp, 8))
		setvalue("MainReturn", "0x" & Hex($ltemp + 5, 8))
		setvalue("RenderingMod", "0x" & Hex($ltemp + 116, 8))
		setvalue("RenderingModReturn", "0x" & Hex($ltemp + 132 + 6, 8))
		$ltemp = getscannedaddress("ScanTargetLog", 1)
		setvalue("TargetLogStart", "0x" & Hex($ltemp, 8))
		setvalue("TargetLogReturn", "0x" & Hex($ltemp + 5, 8))
		$ltemp = getscannedaddress("ScanSkillLog", 1)
		setvalue("SkillLogStart", "0x" & Hex($ltemp, 8))
		setvalue("SkillLogReturn", "0x" & Hex($ltemp + 5, 8))
		$ltemp = getscannedaddress("ScanSkillCompleteLog", -4)
		setvalue("SkillCompleteLogStart", "0x" & Hex($ltemp, 8))
		setvalue("SkillCompleteLogReturn", "0x" & Hex($ltemp + 5, 8))
		$ltemp = getscannedaddress("ScanSkillCancelLog", 5)
		setvalue("SkillCancelLogStart", "0x" & Hex($ltemp, 8))
		setvalue("SkillCancelLogReturn", "0x" & Hex($ltemp + 6, 8))
		$ltemp = getscannedaddress("ScanChatLog", 18)
		setvalue("ChatLogStart", "0x" & Hex($ltemp, 8))
		setvalue("ChatLogReturn", "0x" & Hex($ltemp + 6, 8))
		$ltemp = getscannedaddress("ScanTraderHook", -7)
		setvalue("TraderHookStart", "0x" & Hex($ltemp, 8))
		setvalue("TraderHookReturn", "0x" & Hex($ltemp + 5, 8))
		$ltemp = getscannedaddress("ScanStringFilter1", -2)
		setvalue("StringFilter1Start", "0x" & Hex($ltemp, 8))
		setvalue("StringFilter1Return", "0x" & Hex($ltemp + 5, 8))
		$ltemp = getscannedaddress("ScanStringFilter2", -2)
		setvalue("StringFilter2Start", "0x" & Hex($ltemp, 8))
		setvalue("StringFilter2Return", "0x" & Hex($ltemp + 5, 8))
		setvalue("StringLogStart", "0x" & Hex(getscannedaddress("ScanStringLog", 35), 8))
		setvalue("LoadFinishedStart", "0x" & Hex(getscannedaddress("ScanLoadFinished", 1), 8))
		setvalue("LoadFinishedReturn", "0x" & Hex(getscannedaddress("ScanLoadFinished", 6), 8))
		setvalue("PostMessage", "0x" & Hex(memoryread(getscannedaddress("ScanPostMessage", 11)), 8))
		setvalue("Sleep", memoryread(memoryread(getvalue("ScanSleep") + 8) + 3))
		setvalue("SalvageFunction", memoryread(getvalue("ScanSalvageFunction") + 8) - 18)
		setvalue("SalvageGlobal", memoryread(memoryread(getvalue("ScanSalvageGlobal") + 8) + 1))
		setvalue("IncreaseAttributeFunction", "0x" & Hex(getscannedaddress("ScanIncreaseAttributeFunction", -96), 8))
		setvalue("DecreaseAttributeFunction", "0x" & Hex(getscannedaddress("ScanIncreaseAttributeFunction", -288), 8))
		setvalue("MoveFunction", "0x" & Hex(getscannedaddress("ScanMoveFunction", 1), 8))
		setvalue("UseSkillFunction", "0x" & Hex(getscannedaddress("ScanUseSkillFunction", 1), 8))
		setvalue("ChangeTargetFunction", "0x" & Hex(getscannedaddress("ScanChangeTargetFunction", -119), 8))
		setvalue("WriteChatFunction", "0x" & Hex(getscannedaddress("ScanWriteChatFunction", 1), 8))
		setvalue("SellItemFunction", "0x" & Hex(getscannedaddress("ScanSellItemFunction", -85), 8))
		setvalue("PacketSendFunction", "0x" & Hex(getscannedaddress("ScanPacketSendFunction", 1), 8))
		setvalue("ActionBase", "0x" & Hex(memoryread(getscannedaddress("ScanActionBase", -9)), 8))
		setvalue("ActionFunction", "0x" & Hex(getscannedaddress("ScanActionFunction", -5), 8))
		setvalue("UseHeroSkillFunction", "0x" & Hex(getscannedaddress("ScanUseHeroSkillFunction", -161), 8))
		setvalue("BuyItemFunction", "0x" & Hex(getscannedaddress("ScanBuyItemFunction", 1), 8))
		setvalue("RequestQuoteFunction", "0x" & Hex(getscannedaddress("ScanRequestQuoteFunction", -2), 8))
		setvalue("TraderFunction", "0x" & Hex(getscannedaddress("ScanTraderFunction", -71), 8))
		setvalue("ClickToMoveFix", "0x" & Hex(getscannedaddress("ScanClickToMoveFix", 1), 8))
		setvalue("QueueSize", "0x00000010")
		setvalue("SkillLogSize", "0x00000010")
		setvalue("ChatLogSize", "0x00000010")
		setvalue("TargetLogSize", "0x00000200")
		setvalue("StringLogSize", "0x00000200")
		setvalue("CallbackEvent", "0x00000501")
		modifymemory()
		$mqueuecounter = memoryread(getvalue("QueueCounter"))
		$mqueuesize = getvalue("QueueSize") - 1
		$mqueuebase = getvalue("QueueBase")
		$mtargetlogbase = getvalue("TargetLogBase")
		$mstringlogbase = getvalue("StringLogBase")
		$mmapisloaded = getvalue("MapIsLoaded")
		$mensureenglish = getvalue("EnsureEnglish")
		$mtraderquoteid = getvalue("TraderQuoteID")
		$mtradercostid = getvalue("TraderCostID")
		$mtradercostvalue = getvalue("TraderCostValue")
		$mdisablerendering = getvalue("DisableRendering")
		$magentcopycount = getvalue("AgentCopyCount")
		$magentcopybase = getvalue("AgentCopyBase")
		If $museeventsystem Then memorywrite(getvalue("CallbackHandle"), $mgui)
		DllStructSetData($museskill, 1, getvalue("CommandUseSkill"))
		DllStructSetData($mmove, 1, getvalue("CommandMove"))
		DllStructSetData($mchangetarget, 1, getvalue("CommandChangeTarget"))
		DllStructSetData($mpacket, 1, getvalue("CommandPacketSend"))
		DllStructSetData($msellitem, 1, getvalue("CommandSellItem"))
		DllStructSetData($maction, 1, getvalue("CommandAction"))
		DllStructSetData($mtogglelanguage, 1, getvalue("CommandToggleLanguage"))
		DllStructSetData($museheroskill, 1, getvalue("CommandUseHeroSkill"))
		DllStructSetData($mbuyitem, 1, getvalue("CommandBuyItem"))
		DllStructSetData($msendchat, 1, getvalue("CommandSendChat"))
		DllStructSetData($msendchat, 2, 94)
		DllStructSetData($mwritechat, 1, getvalue("CommandWriteChat"))
		DllStructSetData($mrequestquote, 1, getvalue("CommandRequestQuote"))
		DllStructSetData($mrequestquotesell, 1, getvalue("CommandRequestQuoteSell"))
		DllStructSetData($mtraderbuy, 1, getvalue("CommandTraderBuy"))
		DllStructSetData($mtradersell, 1, getvalue("CommandTraderSell"))
		DllStructSetData($msalvage, 1, getvalue("CommandSalvage"))
		DllStructSetData($mincreaseattribute, 1, getvalue("CommandIncreaseAttribute"))
		DllStructSetData($mdecreaseattribute, 1, getvalue("CommandDecreaseAttribute"))
		DllStructSetData($mmakeagentarray, 1, getvalue("CommandMakeAgentArray"))
		If $bchangetitle Then WinSetTitle($mgwhwnd, "", "Guild Wars - " & getcharname())
		Return $mgwhwnd
	EndFunc

	Func getvalue($akey)
		For $i = 1 To $mlabels[0][0]
			If $mlabels[$i][0] = $akey Then Return Number($mlabels[$i][1])
		Next
		Return -1
	EndFunc

	Func setvalue($akey, $avalue)
		$mlabels[0][0] += 1
		ReDim $mlabels[$mlabels[0][0] + 1][2]
		$mlabels[$mlabels[0][0]][0] = $akey
		$mlabels[$mlabels[0][0]][1] = $avalue
	EndFunc

	Func scan()
		$masmsize = 0
		$masmcodeoffset = 0
		$masmstring = ""
		_("MainModPtr/4")
		_("ScanBasePointer:")
		addpattern("85C0750F8BCE")
		_("ScanAgentBase:")
		addpattern("568BF13BF07204")
		_("ScanEngine:")
		addpattern("5356DFE0F6C441")
		_("ScanLoadFinished:")
		addpattern("8B561C8BCF52E8")
		_("ScanPostMessage:")
		addpattern("6A00680080000051FF15")
		_("ScanTargetLog:")
		addpattern("5356578BFA894DF4E8")
		_("ScanChangeTargetFunction:")
		addpattern("33C03BDA0F95C033")
		_("ScanMoveFunction:")
		addpattern("558BEC83EC2056578BF98D4DF0")
		_("ScanPing:")
		addpattern("908D41248B49186A30")
		_("ScanMapID:")
		addpattern("B07F8D55")
		_("ScanLoggedIn:")
		addpattern("85C07411B807")
		_("ScanRegion:")
		addpattern("83F9FD7406")
		_("ScanLanguage:")
		addpattern("C38B75FC8B04B5")
		_("ScanUseSkillFunction:")
		addpattern("558BEC83EC1053568BD9578BF2895DF0")
		_("ScanChangeTargetFunction:")
		addpattern("33C03BDA0F95C033")
		_("ScanPacketSendFunction:")
		addpattern("558BEC83EC2C5356578BF985")
		_("ScanBaseOffset:")
		addpattern("5633F63BCE740E5633D2")
		_("ScanWriteChatFunction:")
		addpattern("558BEC5153894DFC8B4D0856578B")
		_("ScanSkillLog:")
		addpattern("408946105E5B5D")
		_("ScanSkillCompleteLog:")
		addpattern("741D6A006A40")
		_("ScanSkillCancelLog:")
		addpattern("85C0741D6A006A42")
		_("ScanChatLog:")
		addpattern("8B45F48B138B4DEC50")
		_("ScanSellItemFunction:")
		addpattern("8B4D2085C90F858E")
		_("ScanStringLog:")
		addpattern("893E8B7D10895E04397E08")
		_("ScanStringFilter1:")
		addpattern("51568B7508578BF9833E00")
		_("ScanStringFilter2:")
		addpattern("515356578BF933D28B4F2C")
		_("ScanActionFunction:")
		addpattern("8B7D0883FF098BF175116876010000")
		_("ScanActionBase:")
		addpattern("8B4208A80175418B4A08")
		_("ScanSkillBase:")
		addpattern("8D04B65EC1E00505")
		_("ScanUseHeroSkillFunction:")
		addpattern("8D0C765F5E8B")
		_("ScanBuyItemFunction:")
		addpattern("558BEC81ECC000000053568B75085783FE108BFA8BD97614")
		_("ScanRequestQuoteFunction:")
		addpattern("81EC9C00000053568B")
		_("ScanTraderFunction:")
		addpattern("8B45188B551085")
		_("ScanTraderHook:")
		addpattern("8955FC6A008D55F8B9BA")
		_("ScanSleep:")
		addpattern("5F5E5B741A6860EA0000")
		_("ScanSalvageFunction:")
		addpattern("8BFA8BD9897DF0895DF4")
		_("ScanSalvageGlobal:")
		addpattern("8B018B4904A3")
		_("ScanIncreaseAttributeFunction:")
		addpattern("8B702C8B3B8B86")
		_("ScanDecreaseAttributeFunction:")
		addpattern("8B4B0C6A00516A016A04")
		_("ScanSkillTimer:")
		addpattern("85c974158bd62bd183fa64")
		_("ScanClickToMoveFix:")
		addpattern("3DD301000074")
		_("ScanZoomStill:")
		addpattern("3B448BCB")
		_("ScanZoomMoving:")
		addpattern("50EB116800803B448BCE")
		_("ScanBuildNumber:")
		addpattern("8D8500FCFFFF8D")
		_("ScanProc:")
		_("pushad")
		_("mov ecx,401000")
		_("mov esi,ScanProc")
		_("ScanLoop:")
		_("inc ecx")
		_("mov al,byte[ecx]")
		_("mov edx,ScanBasePointer")
		_("ScanInnerLoop:")
		_("mov ebx,dword[edx]")
		_("cmp ebx,-1")
		_("jnz ScanContinue")
		_("add edx,50")
		_("cmp edx,esi")
		_("jnz ScanInnerLoop")
		_("cmp ecx,900000")
		_("jnz ScanLoop")
		_("jmp ScanExit")
		_("ScanContinue:")
		_("lea edi,dword[edx+ebx]")
		_("add edi,C")
		_("mov ah,byte[edi]")
		_("cmp al,ah")
		_("jz ScanMatched")
		_("mov dword[edx],0")
		_("add edx,50")
		_("cmp edx,esi")
		_("jnz ScanInnerLoop")
		_("cmp ecx,900000")
		_("jnz ScanLoop")
		_("jmp ScanExit")
		_("ScanMatched:")
		_("inc ebx")
		_("mov edi,dword[edx+4]")
		_("cmp ebx,edi")
		_("jz ScanFound")
		_("mov dword[edx],ebx")
		_("add edx,50")
		_("cmp edx,esi")
		_("jnz ScanInnerLoop")
		_("cmp ecx,900000")
		_("jnz ScanLoop")
		_("jmp ScanExit")
		_("ScanFound:")
		_("lea edi,dword[edx+8]")
		_("mov dword[edi],ecx")
		_("mov dword[edx],-1")
		_("add edx,50")
		_("cmp edx,esi")
		_("jnz ScanInnerLoop")
		_("cmp ecx,900000")
		_("jnz ScanLoop")
		_("ScanExit:")
		_("popad")
		_("retn")
		Local $lscanmemory = memoryread($mbase, "ptr")
		If $lscanmemory = 0 Then
			$mmemory = DllCall($mkernelhandle, "ptr", "VirtualAllocEx", "handle", $mgwprochandle, "ptr", 0, "ulong_ptr", $masmsize, "dword", 4096, "dword", 64)
			$mmemory = $mmemory[0]
			memorywrite($mbase, $mmemory)
		Else
			$mmemory = $lscanmemory
		EndIf
		completeasmcode()
		If $lscanmemory = 0 Then
			writebinary($masmstring, $mmemory + $masmcodeoffset)
			Local $lthread = DllCall($mkernelhandle, "int", "CreateRemoteThread", "int", $mgwprochandle, "ptr", 0, "int", 0, "int", getlabelinfo("ScanProc"), "ptr", 0, "int", 0, "int", 0)
			$lthread = $lthread[0]
			Local $lresult
			Do
				$lresult = DllCall($mkernelhandle, "int", "WaitForSingleObject", "int", $lthread, "int", 50)
			Until $lresult[0] <> 258
			DllCall($mkernelhandle, "int", "CloseHandle", "int", $lthread)
		EndIf
	EndFunc

	Func addpattern($apattern)
		Local $lsize = Int(0.5 * StringLen($apattern))
		$masmstring &= "00000000" & swapendian(Hex($lsize, 8)) & "00000000" & $apattern
		$masmsize += $lsize + 12
		For $i = 1 To 68 - $lsize
			$masmsize += 1
			$masmstring &= "00"
		Next
	EndFunc

	Func getscannedaddress($alabel, $aoffset)
		Return memoryread(getlabelinfo($alabel) + 8) - memoryread(getlabelinfo($alabel) + 4) + $aoffset
	EndFunc

	Func scanforcharname()
		Local $lcharnamecode = BinaryToString("0x90909066C705")
		Local $lcurrentsearchaddress = 4198400
		Local $lmbi[7], $lmbibuffer = DllStructCreate("dword;dword;dword;dword;dword;dword;dword")
		Local $lsearch, $ltmpmemdata, $ltmpaddress, $ltmpbuffer = DllStructCreate("ptr"), $i
		While $lcurrentsearchaddress < 9437184
			Local $lmbi[7]
			DllCall($mkernelhandle, "int", "VirtualQueryEx", "int", $mgwprochandle, "int", $lcurrentsearchaddress, "ptr", DllStructGetPtr($lmbibuffer), "int", DllStructGetSize($lmbibuffer))
			For $i = 0 To 6
				$lmbi[$i] = StringStripWS(DllStructGetData($lmbibuffer, ($i + 1)), 3)
			Next
			If $lmbi[4] = 4096 Then
				Local $lbuffer = DllStructCreate("byte[" & $lmbi[3] & "]")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lcurrentsearchaddress, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
				$ltmpmemdata = DllStructGetData($lbuffer, 1)
				$ltmpmemdata = BinaryToString($ltmpmemdata)
				$lsearch = StringInStr($ltmpmemdata, $lcharnamecode, 2)
				If $lsearch > 0 Then
					$ltmpaddress = $lcurrentsearchaddress + $lsearch - 1
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $ltmpaddress + 6, "ptr", DllStructGetPtr($ltmpbuffer), "int", DllStructGetSize($ltmpbuffer), "int", "")
					$mcharname = DllStructGetData($ltmpbuffer, 1)
					Return getcharname()
				EndIf
				$lcurrentsearchaddress += $lmbi[3]
			EndIf
		WEnd
		Return ""
	EndFunc

#EndRegion Initialisation
#Region Commands
	#Region Item

		Func startsalvage($aitem)
			Local $loffset[4] = [0, 24, 44, 1680]
			Local $lsalvagesessionid = memoryreadptr($mbasepointer, $loffset)
			If IsDllStruct($aitem) = 0 Then
				Local $litemid = $aitem
			Else
				Local $litemid = DllStructGetData($aitem, "ID")
			EndIf
			Local $lsalvagekit = findsalvagekit()
			If $lsalvagekit = 0 Then Return
			DllStructSetData($msalvage, 2, $litemid)
			DllStructSetData($msalvage, 3, findsalvagekit())
			DllStructSetData($msalvage, 4, $lsalvagesessionid[1])
			enqueue($msalvageptr, 16)
		EndFunc

		Func salvagematerials()
			Return sendpacket(4, 115)
		EndFunc

		Func salvagemod($amodindex)
			Return sendpacket(8, 116, $amodindex)
		EndFunc

		Func identifyitem($aitem)
			If getisided($aitem) Then Return
			Local $litemid
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
			Else
				$litemid = DllStructGetData($aitem, "ID")
			EndIf
			Local $lidkit = findidkit()
			If $lidkit == 0 Then Return
			sendpacket(12, 101, $lidkit, $litemid)
			Local $ldeadlock = TimerInit()
			Do
				Sleep(20)
			Until getisided($litemid) OR TimerDiff($ldeadlock) > 5000
			If NOT getisided($litemid) Then identifyitem($aitem)
		EndFunc

		Func identifybag($abag, $awhites = False, $agolds = True)
			Local $litem
			If NOT IsDllStruct($abag) Then $abag = getbag($abag)
			For $i = 1 To DllStructGetData($abag, "Slots")
				$litem = getitembyslot($abag, $i)
				If DllStructGetData($litem, "ID") == 0 Then ContinueLoop
				If getrarity($litem) == 2621 AND $awhites == False Then ContinueLoop
				If getrarity($litem) == 2624 AND $agolds == False Then ContinueLoop
				identifyitem($litem)
				Sleep(getping())
			Next
		EndFunc

		Func equipitem($aitem)
			Local $litemid
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
			Else
				$litemid = DllStructGetData($aitem, "ID")
			EndIf
			Return sendpacket(8, 41, $litemid)
		EndFunc

		Func useitem($aitem)
			Local $litemid
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
			Else
				$litemid = DllStructGetData($aitem, "ID")
			EndIf
			Return sendpacket(8, 119, $litemid)
		EndFunc

		Func pickupitem($aitem)
			Local $lagentid
			If IsDllStruct($aitem) = 0 Then
				$lagentid = $aitem
			ElseIf DllStructGetSize($aitem) < 400 Then
				$lagentid = DllStructGetData($aitem, "AgentID")
			Else
				$lagentid = DllStructGetData($aitem, "ID")
			EndIf
			Return sendpacket(12, 56, $lagentid, 0)
		EndFunc

		Func dropitem($aitem, $aamount = 0)
			Local $litemid, $lamount
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
				If $aamount > 0 Then
					$lamount = $aamount
				Else
					$lamount = DllStructGetData(getitembyitemid($aitem), "Quantity")
				EndIf
			Else
				$litemid = DllStructGetData($aitem, "ID")
				If $aamount > 0 Then
					$lamount = $aamount
				Else
					$lamount = DllStructGetData($aitem, "Quantity")
				EndIf
			EndIf
			Return sendpacket(12, 37, $litemid, $lamount)
		EndFunc

		Func moveitem($aitem, $abag, $aslot)
			Local $litemid, $lbagid
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
			Else
				$litemid = DllStructGetData($aitem, "ID")
			EndIf
			If IsDllStruct($abag) = 0 Then
				$lbagid = DllStructGetData(getbag($abag), "ID")
			Else
				$lbagid = DllStructGetData($abag, "ID")
			EndIf
			Return sendpacket(16, 107, $litemid, $lbagid, $aslot - 1)
		EndFunc

		Func acceptallitems()
			Return sendpacket(8, 108, DllStructGetData(getbag(7), "ID"))
		EndFunc

		Func sellitem($aitem, $aquantity = 0)
			If IsDllStruct($aitem) = 0 Then $aitem = getitembyitemid($aitem)
			If $aquantity = 0 OR $aquantity > DllStructGetData($aitem, "Quantity") Then $aquantity = DllStructGetData($aitem, "Quantity")
			DllStructSetData($msellitem, 2, $aquantity * DllStructGetData($aitem, "Value"))
			DllStructSetData($msellitem, 3, DllStructGetData($aitem, "ID"))
			enqueue($msellitemptr, 12)
		EndFunc

		Func buyitem($aitem, $aquantity, $avalue)
			Local $lmerchantitemsbase = getmerchantitemsbase()
			If NOT $lmerchantitemsbase Then Return
			If $aitem < 1 OR $aitem > getmerchantitemssize() Then Return
			DllStructSetData($mbuyitem, 2, $aquantity)
			DllStructSetData($mbuyitem, 3, memoryread($lmerchantitemsbase + 4 * ($aitem - 1)))
			DllStructSetData($mbuyitem, 4, $aquantity * $avalue)
			enqueue($mbuyitemptr, 16)
		EndFunc

		Func buyidkit()
			buyitem(5, 1, 100)
		EndFunc

		Func buysuperioridkit()
			buyitem(6, 1, 500)
		EndFunc

		Func traderrequest($amodelid, $aextraid = -1)
			Local $litemstruct = DllStructCreate("long id;long agentId;byte unknown1[4];ptr bag;ptr modstruct;long modstructsize;ptr customized;byte unknown2[4];byte type;byte unknown3;short extraId;short value;byte unknown4[2];short interaction;long modelId;ptr modString;byte unknown5[4];ptr NameString;byte unknown6[15];byte quantity;byte equipped;byte unknown7[1];byte slot")
			Local $loffset[4] = [0, 24, 64, 192]
			Local $litemarraysize = memoryreadptr($mbasepointer, $loffset)
			Local $loffset[5] = [0, 24, 64, 184, 0]
			Local $litemptr, $litemid
			Local $lfound = False
			Local $lquoteid = memoryread($mtraderquoteid)
			For $litemid = 1 To $litemarraysize[1]
				$loffset[4] = 4 * $litemid
				$litemptr = memoryreadptr($mbasepointer, $loffset)
				If $litemptr[1] = 0 Then ContinueLoop
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemptr[1], "ptr", DllStructGetPtr($litemstruct), "int", DllStructGetSize($litemstruct), "int", "")
				If DllStructGetData($litemstruct, "ModelID") = $amodelid AND DllStructGetData($litemstruct, "bag") = 0 AND DllStructGetData($litemstruct, "AgentID") == 0 Then
					If $aextraid = -1 OR DllStructGetData($litemstruct, "ExtraID") = $aextraid Then
						$lfound = True
						ExitLoop
					EndIf
				EndIf
			Next
			If NOT $lfound Then Return False
			DllStructSetData($mrequestquote, 2, DllStructGetData($litemstruct, "ID"))
			enqueue($mrequestquoteptr, 8)
			Local $ldeadlock = TimerInit()
			$lfound = False
			Do
				Sleep(20)
				$lfound = memoryread($mtraderquoteid) <> $lquoteid
			Until $lfound OR TimerDiff($ldeadlock) > getping() + 5000
			Return $lfound
		EndFunc

		Func traderbuy()
			If NOT gettradercostid() OR NOT gettradercostvalue() Then Return False
			enqueue($mtraderbuyptr, 4)
			Return True
		EndFunc

		Func traderrequestsell($aitem)
			Local $litemid
			Local $lfound = False
			Local $lquoteid = memoryread($mtraderquoteid)
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
			Else
				$litemid = DllStructGetData($aitem, "ID")
			EndIf
			DllStructSetData($mrequestquotesell, 2, $litemid)
			enqueue($mrequestquotesellptr, 8)
			Local $ldeadlock = TimerInit()
			Do
				Sleep(20)
				$lfound = memoryread($mtraderquoteid) <> $lquoteid
			Until $lfound OR TimerDiff($ldeadlock) > getping() + 5000
			Return $lfound
		EndFunc

		Func tradersell()
			If NOT gettradercostid() OR NOT gettradercostvalue() Then Return False
			enqueue($mtradersellptr, 4)
			Return True
		EndFunc

		Func dropgold($aamount = 0)
			Local $lamount
			If $aamount > 0 Then
				$lamount = $aamount
			Else
				$lamount = getgoldcharacter()
			EndIf
			Return sendpacket(8, 40, $lamount)
		EndFunc

		Func depositgold($aamount = 0)
			Local $lamount
			Local $lstorage = getgoldstorage()
			Local $lcharacter = getgoldcharacter()
			If $aamount > 0 AND $lcharacter >= $aamount Then
				$lamount = $aamount
			Else
				$lamount = $lcharacter
			EndIf
			If $lstorage + $lamount > 1000000 Then $lamount = 1000000 - $lstorage
			changegold($lcharacter - $lamount, $lstorage + $lamount)
		EndFunc

		Func withdrawgold($aamount = 0)
			Local $lamount
			Local $lstorage = getgoldstorage()
			Local $lcharacter = getgoldcharacter()
			If $aamount > 0 AND $lstorage >= $aamount Then
				$lamount = $aamount
			Else
				$lamount = $lstorage
			EndIf
			If $lcharacter + $lamount > 100000 Then $lamount = 100000 - $lcharacter
			changegold($lcharacter + $lamount, $lstorage - $lamount)
		EndFunc

		Func changegold($acharacter, $astorage)
			Return sendpacket(12, 117, $acharacter, $astorage)
		EndFunc

	#EndRegion Item
	#Region H&H

		Func addhero($aheroid)
			Return sendpacket(8, 22, $aheroid)
		EndFunc

		Func kickhero($aheroid)
			Return sendpacket(8, 23, $aheroid)
		EndFunc

		Func kickallheroes()
			Return sendpacket(8, 23, 38)
		EndFunc

		Func addnpc($anpcid)
			Return sendpacket(8, 152, $anpcid)
		EndFunc

		Func kicknpc($anpcid)
			Return sendpacket(8, 161, $anpcid)
		EndFunc

		Func cancelhero($aheronumber)
			Local $lagentid = getheroid($aheronumber)
			Return sendpacket(20, 18, $lagentid, 2139095040, 2139095040, 0)
		EndFunc

		Func cancelall()
			Return sendpacket(16, 19, 2139095040, 2139095040, 0)
		EndFunc

		Func commandhero($aheronumber, $ax, $ay)
			Return sendpacket(20, 18, getheroid($aheronumber), floattoint($ax), floattoint($ay), 0)
		EndFunc

		Func commandall($ax, $ay)
			Return sendpacket(16, 19, floattoint($ax), floattoint($ay), 0)
		EndFunc

		Func lockherotarget($aheronumber, $aagentid = 0)
			Local $lheroid = getheroid($aheronumber)
			Return sendpacket(12, 14, $lheroid, $aagentid)
		EndFunc

		Func setheroaggression($aheronumber, $aaggression)
			Local $lheroid = getheroid($aheronumber)
			Return sendpacket(12, 13, $lheroid, $aaggression)
		EndFunc

		Func disableheroskillslot($aheronumber, $askillslot)
			If NOT getisheroskillslotdisabled($aheronumber, $askillslot) Then changeheroskillslotstate($aheronumber, $askillslot)
		EndFunc

		Func enableheroskillslot($aheronumber, $askillslot)
			If getisheroskillslotdisabled($aheronumber, $askillslot) Then changeheroskillslotstate($aheronumber, $askillslot)
		EndFunc

		Func changeheroskillslotstate($aheronumber, $askillslot)
			Return sendpacket(12, 17, getheroid($aheronumber), $askillslot - 1)
		EndFunc

		Func useheroskill($ahero, $askillslot, $atarget = 0)
			Local $ltargetid
			If IsDllStruct($atarget) = 0 Then
				$ltargetid = convertid($atarget)
			Else
				$ltargetid = DllStructGetData($atarget, "ID")
			EndIf
			DllStructSetData($museheroskill, 2, getheroid($ahero))
			DllStructSetData($museheroskill, 3, $ltargetid)
			DllStructSetData($museheroskill, 4, $askillslot - 1)
			enqueue($museheroskillptr, 16)
		EndFunc

	#EndRegion H&H
	#Region Movement

		Func move($ax, $ay, $arandom = 50)
			If getagentexists(-2) Then
				DllStructSetData($mmove, 2, $ax + Random(-$arandom, $arandom))
				DllStructSetData($mmove, 3, $ay + Random(-$arandom, $arandom))
				enqueue($mmoveptr, 16)
				Return True
			Else
				Return False
			EndIf
		EndFunc

		Func moveto($ax, $ay, $arandom = 50)
			Local $lblocked = 0
			Local $lme
			Local $lmaploading = getmaploading(), $lmaploadingold
			Local $ldestx = $ax + Random(-$arandom, $arandom)
			Local $ldesty = $ay + Random(-$arandom, $arandom)
			If getisdead(-2) Then Return
			move($ldestx, $ldesty, 0)
			Do
				Sleep(100)
				$lme = getagentbyid(-2)
				If DllStructGetData($lme, "HP") <= 0 Then ExitLoop
				$lmaploadingold = $lmaploading
				$lmaploading = getmaploading()
				If $lmaploading <> $lmaploadingold Then ExitLoop
				If DllStructGetData($lme, "MoveX") == 0 AND DllStructGetData($lme, "MoveY") == 0 Then
					$lblocked += 1
					$ldestx = $ax + Random(-$arandom, $arandom)
					$ldesty = $ay + Random(-$arandom, $arandom)
					move($ldestx, $ldesty, 0)
				EndIf
			Until computedistance(DllStructGetData($lme, "X"), DllStructGetData($lme, "Y"), $ldestx, $ldesty) < 100 OR $lblocked > 14 OR getisdead(-2)
		EndFunc

		Func goplayer($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Return sendpacket(8, 44, $lagentid)
		EndFunc

		Func gonpc($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Return sendpacket(12, 50, $lagentid)
		EndFunc

		Func gotonpc($aagent)
			If NOT IsDllStruct($aagent) Then $aagent = getagentbyid($aagent)
			Local $lme
			Local $lblocked = 0
			Local $lmaploading = getmaploading(), $lmaploadingold
			move(DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y"), 100)
			Sleep(100)
			gonpc($aagent)
			Do
				Sleep(100)
				$lme = getagentbyid(-2)
				If DllStructGetData($lme, "HP") <= 0 Then ExitLoop
				$lmaploadingold = $lmaploading
				$lmaploading = getmaploading()
				If $lmaploading <> $lmaploadingold Then ExitLoop
				If DllStructGetData($lme, "MoveX") == 0 AND DllStructGetData($lme, "MoveY") == 0 Then
					$lblocked += 1
					move(DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y"), 100)
					Sleep(100)
					gonpc($aagent)
				EndIf
			Until computedistance(DllStructGetData($lme, "X"), DllStructGetData($lme, "Y"), DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y")) < 250 OR $lblocked > 14
			Sleep(getping() + Random(1500, 2000, 1))
		EndFunc

		Func gosignpost($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Return sendpacket(12, 74, $lagentid, 0)
		EndFunc

		Func gotosignpost($aagent)
			If NOT IsDllStruct($aagent) Then $aagent = getagentbyid($aagent)
			Local $lme
			Local $lblocked = 0
			Local $lmaploading = getmaploading(), $lmaploadingold
			move(DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y"), 100)
			Sleep(100)
			gosignpost($aagent)
			Do
				Sleep(100)
				$lme = getagentbyid(-2)
				If DllStructGetData($lme, "HP") <= 0 Then ExitLoop
				$lmaploadingold = $lmaploading
				$lmaploading = getmaploading()
				If $lmaploading <> $lmaploadingold Then ExitLoop
				If DllStructGetData($lme, "MoveX") == 0 AND DllStructGetData($lme, "MoveY") == 0 Then
					$lblocked += 1
					move(DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y"), 100)
					Sleep(100)
					gosignpost($aagent)
				EndIf
			Until computedistance(DllStructGetData($lme, "X"), DllStructGetData($lme, "Y"), DllStructGetData($aagent, "X"), DllStructGetData($aagent, "Y")) < 250 OR $lblocked > 14
			Sleep(getping() + Random(1500, 2000, 1))
		EndFunc

		Func attack($aagent, $acalltarget = False)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Return sendpacket(12, 31, $lagentid, $acalltarget)
		EndFunc

		Func turnleft($aturn)
			If $aturn Then
				Return performaction(162, 24)
			Else
				Return performaction(162, 26)
			EndIf
		EndFunc

		Func turnright($aturn)
			If $aturn Then
				Return performaction(163, 24)
			Else
				Return performaction(163, 26)
			EndIf
		EndFunc

		Func movebackward($amove)
			If $amove Then
				Return performaction(172, 24)
			Else
				Return performaction(172, 26)
			EndIf
		EndFunc

		Func moveforward($amove)
			If $amove Then
				Return performaction(173, 24)
			Else
				Return performaction(173, 26)
			EndIf
		EndFunc

		Func strafeleft($astrafe)
			If $astrafe Then
				Return performaction(145, 24)
			Else
				Return performaction(145, 26)
			EndIf
		EndFunc

		Func straferight($astrafe)
			If $astrafe Then
				Return performaction(146, 24)
			Else
				Return performaction(146, 26)
			EndIf
		EndFunc

		Func toggleautorun()
			Return performaction(183, 24)
		EndFunc

		Func reversedirection()
			Return performaction(177, 24)
		EndFunc

	#EndRegion Movement
	#Region Travel

		Func travelto($amapid, $adis = 0)
			If getmapid() = $amapid AND $adis = 0 AND getmaploading() = 0 Then Return True
			zonemap($amapid, $adis)
			Return waitmaploading($amapid)
		EndFunc

		Func zonemap($amapid, $adistrict = 0)
			movemap($amapid, getregion(), $adistrict, getlanguage())
		EndFunc

		Func movemap($amapid, $aregion, $adistrict, $alanguage)
			Return sendpacket(24, 170, $amapid, $aregion, $adistrict, $alanguage, False)
		EndFunc

		Func returntooutpost()
			Return sendpacket(4, 160)
		EndFunc

		Func enterchallenge()
			Return sendpacket(8, 158, 1)
		EndFunc

		Func enterchallengeforeign()
			Return sendpacket(8, 158, 0)
		EndFunc

		Func travelgh()
			Local $loffset[3] = [0, 24, 60]
			Local $lgh = memoryreadptr($mbasepointer, $loffset)
			sendpacket(24, 169, memoryread($lgh[1] + 100), memoryread($lgh[1] + 104), memoryread($lgh[1] + 108), memoryread($lgh[1] + 112), 1)
			Return waitmaploading()
		EndFunc

		Func leavegh()
			sendpacket(8, 171, 1)
			Return waitmaploading()
		EndFunc

	#EndRegion Travel
	#Region Quest

		Func acceptquest($aquestid)
			Return sendpacket(8, 52, "0x008" & Hex($aquestid, 3) & "01")
		EndFunc

		Func questreward($aquestid)
			Return sendpacket(8, 52, "0x008" & Hex($aquestid, 3) & "07")
		EndFunc

		Func abandonquest($aquestid)
			Return sendpacket(8, 9, $aquestid)
		EndFunc

	#EndRegion Quest
	#Region Windows

		Func closeallpanels()
			Return performaction(133, 24)
		EndFunc

		Func toggleherowindow()
			Return performaction(138, 24)
		EndFunc

		Func toggleinventory()
			Return performaction(139, 24)
		EndFunc

		Func toggleallbags()
			Return performaction(184, 24)
		EndFunc

		Func toggleworldmap()
			Return performaction(140, 24)
		EndFunc

		Func toggleoptions()
			Return performaction(141, 24)
		EndFunc

		Func togglequestwindow()
			Return performaction(142, 24)
		EndFunc

		Func toggleskillwindow()
			Return performaction(143, 24)
		EndFunc

		Func togglemissionmap()
			Return performaction(182, 24)
		EndFunc

		Func togglefriendlist()
			Return performaction(185, 24)
		EndFunc

		Func toggleguildwindow()
			Return performaction(186, 24)
		EndFunc

		Func togglepartywindow()
			Return performaction(191, 24)
		EndFunc

		Func togglescorechart()
			Return performaction(189, 24)
		EndFunc

		Func togglelayoutwindow()
			Return performaction(193, 24)
		EndFunc

		Func toggleminionlist()
			Return performaction(194, 24)
		EndFunc

		Func toggleheropanel($ahero)
			If $ahero < 4 Then
				Return performaction(219 + $ahero, 24)
			ElseIf $ahero < 8 Then
				Return performaction(254 + $ahero, 24)
			EndIf
		EndFunc

		Func toggleheropetpanel($ahero)
			If $ahero < 4 Then
				Return performaction(223 + $ahero, 24)
			ElseIf $ahero < 8 Then
				Return performaction(250 + $ahero, 24)
			EndIf
		EndFunc

		Func togglepetpanel()
			Return performaction(223, 24)
		EndFunc

		Func togglehelpwindow()
			Return performaction(228, 24)
		EndFunc

	#EndRegion Windows
	#Region Targeting

		Func changetarget($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			DllStructSetData($mchangetarget, 2, $lagentid)
			enqueue($mchangetargetptr, 8)
		EndFunc

		Func calltarget($atarget)
			Local $ltargetid
			If IsDllStruct($atarget) = 0 Then
				$ltargetid = convertid($atarget)
			Else
				$ltargetid = DllStructGetData($atarget, "ID")
			EndIf
			Return sendpacket(12, 27, 10, $ltargetid)
		EndFunc

		Func cleartarget()
			Return performaction(227, 24)
		EndFunc

		Func targetnearestenemy()
			Return performaction(147, 24)
		EndFunc

		Func targetnextenemy()
			Return performaction(149, 24)
		EndFunc

		Func targetpartymember($anumber)
			If $anumber > 0 AND $anumber < 13 Then Return performaction(149 + $anumber, 24)
		EndFunc

		Func targetpreviousenemy()
			Return performaction(158, 24)
		EndFunc

		Func targetcalledtarget()
			Return performaction(159, 24)
		EndFunc

		Func targetself()
			Return performaction(160, 24)
		EndFunc

		Func targetnearestally()
			Return performaction(188, 24)
		EndFunc

		Func targetnearestitem()
			Return performaction(195, 24)
		EndFunc

		Func targetnextitem()
			Return performaction(196, 24)
		EndFunc

		Func targetpreviousitem()
			Return performaction(197, 24)
		EndFunc

		Func targetnextpartymember()
			Return performaction(202, 24)
		EndFunc

		Func targetpreviouspartymember()
			Return performaction(203, 24)
		EndFunc

	#EndRegion Targeting
	#Region Display

		Func enablerendering()
			memorywrite($mdisablerendering, 0)
		EndFunc

		Func disablerendering()
			memorywrite($mdisablerendering, 1)
		EndFunc

		Func displayall($adisplay)
			displayallies($adisplay)
			displayenemies($adisplay)
		EndFunc

		Func displayallies($adisplay)
			If $adisplay Then
				Return performaction(137, 24)
			Else
				Return performaction(137, 26)
			EndIf
		EndFunc

		Func displayenemies($adisplay)
			If $adisplay Then
				Return performaction(148, 24)
			Else
				Return performaction(148, 26)
			EndIf
		EndFunc

	#EndRegion Display
	#Region Chat

		Func writechat($amessage, $asender = "GWA")
			Local $lmessage, $lsender
			Local $laddress = 256 * $mqueuecounter + $mqueuebase
			If $mqueuecounter = $mqueuesize Then
				$mqueuecounter = 0
			Else
				$mqueuecounter = $mqueuecounter + 1
			EndIf
			If StringLen($asender) > 19 Then
				$lsender = StringLeft($asender, 19)
			Else
				$lsender = $asender
			EndIf
			memorywrite($laddress + 4, $lsender, "wchar[20]")
			If StringLen($amessage) > 100 Then
				$lmessage = StringLeft($amessage, 100)
			Else
				$lmessage = $amessage
			EndIf
			memorywrite($laddress + 44, $lmessage, "wchar[101]")
			DllCall($mkernelhandle, "int", "WriteProcessMemory", "int", $mgwprochandle, "int", $laddress, "ptr", $mwritechatptr, "int", 4, "int", "")
			If StringLen($amessage) > 100 Then writechat(StringTrimLeft($amessage, 100), $asender)
		EndFunc

		Func sendwhisper($areceiver, $amessage)
			Local $ltotal = "whisper " & $areceiver & "," & $amessage
			Local $lmessage
			If StringLen($ltotal) > 120 Then
				$lmessage = StringLeft($ltotal, 120)
			Else
				$lmessage = $ltotal
			EndIf
			sendchat($lmessage, "/")
			If StringLen($ltotal) > 120 Then sendwhisper($areceiver, StringTrimLeft($ltotal, 120))
		EndFunc

		Func sendchat($amessage, $achannel = "!")
			Local $lmessage
			Local $laddress = 256 * $mqueuecounter + $mqueuebase
			If $mqueuecounter = $mqueuesize Then
				$mqueuecounter = 0
			Else
				$mqueuecounter = $mqueuecounter + 1
			EndIf
			If StringLen($amessage) > 120 Then
				$lmessage = StringLeft($amessage, 120)
			Else
				$lmessage = $amessage
			EndIf
			memorywrite($laddress + 8, $achannel & $lmessage, "wchar[122]")
			DllCall($mkernelhandle, "int", "WriteProcessMemory", "int", $mgwprochandle, "int", $laddress, "ptr", $msendchatptr, "int", 8, "int", "")
			If StringLen($amessage) > 120 Then sendchat(StringTrimLeft($amessage, 120), $achannel)
		EndFunc

	#EndRegion Chat
	#Region Misc

		Func changeweaponset($aset)
			Return performaction(128 + $aset, 24)
		EndFunc

		Func useskill($askillslot, $atarget, $acalltarget = False)
			Local $ltargetid
			If IsDllStruct($atarget) = 0 Then
				$ltargetid = convertid($atarget)
			Else
				$ltargetid = DllStructGetData($atarget, "ID")
			EndIf
			DllStructSetData($museskill, 2, $askillslot)
			DllStructSetData($museskill, 3, $ltargetid)
			DllStructSetData($museskill, 4, $acalltarget)
			enqueue($museskillptr, 16)
		EndFunc

		Func cancelaction()
			Return sendpacket(4, 33)
		EndFunc

		Func actioninteract()
			Return performaction(128, 24)
		EndFunc

		Func actionfollow()
			Return performaction(204, 24)
		EndFunc

		Func dropbundle()
			Return performaction(205, 24)
		EndFunc

		Func clearpartycommands()
			Return performaction(219, 24)
		EndFunc

		Func suppressaction($asuppress)
			If $asuppress Then
				Return performaction(208, 24)
			Else
				Return performaction(208, 26)
			EndIf
		EndFunc

		Func openchest()
			Return sendpacket(8, 76, 2)
		EndFunc

		Func dropbuff($askillid, $aagentid, $aheronumber = 0)
			Local $lbuffstruct = DllStructCreate("long SkillId;byte unknown1[4];long BuffId;long TargetId")
			Local $lbuffcount = getbuffcount($aheronumber)
			Local $lbuffstructaddress
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1296
			Local $lcount = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[5]
			$loffset[3] = 1288
			Local $lbuffer
			For $i = 0 To $lcount[1] - 1
				$loffset[4] = 36 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == getheroid($aheronumber) Then
					$loffset[4] = 4 + 36 * $i
					ReDim $loffset[6]
					For $j = 0 To $lbuffcount - 1
						$loffset[5] = 0 + 16 * $j
						$lbuffstructaddress = memoryreadptr($mbasepointer, $loffset)
						DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lbuffstructaddress[0], "ptr", DllStructGetPtr($lbuffstruct), "int", DllStructGetSize($lbuffstruct), "int", "")
						If (DllStructGetData($lbuffstruct, "SkillID") == $askillid) AND (DllStructGetData($lbuffstruct, "TargetId") == convertid($aagentid)) Then
							Return sendpacket(8, 34, DllStructGetData($lbuffstruct, "BuffId"))
							ExitLoop 2
						EndIf
					Next
				EndIf
			Next
		EndFunc

		Func makescreenshot()
			Return performaction(174, 24)
		EndFunc

		Func inviteplayer($aplayername)
			sendchat("invite " & $aplayername, "/")
		EndFunc

		Func leavegroup($akickheroes = True)
			If $akickheroes Then kickallheroes()
			Return sendpacket(4, 155)
		EndFunc

		Func switchmode($amode)
			Return sendpacket(8, 148, $amode)
		EndFunc

		Func resign()
			sendchat("resign", "/")
		EndFunc

		Func donatefaction($afaction)
			If StringLeft($afaction, 1) = "k" Then
				Return sendpacket(16, 46, 0, 0, 5000)
			Else
				Return sendpacket(16, 46, 0, 1, 5000)
			EndIf
		EndFunc

		Func dialog($adialogid)
			Return sendpacket(8, 52, $adialogid)
		EndFunc

		Func skipcinematic()
			Return sendpacket(4, 92)
		EndFunc

		Func setskillbarskill($aslot, $askillid, $aheronumber = 0)
			Return sendpacket(20, 84, getheroid($aheronumber), $aslot - 1, $askillid, 0)
		EndFunc

		Func loadskillbar($askill1 = 0, $askill2 = 0, $askill3 = 0, $askill4 = 0, $askill5 = 0, $askill6 = 0, $askill7 = 0, $askill8 = 0, $aheronumber = 0)
			sendpacket(44, 85, getheroid($aheronumber), 8, $askill1, $askill2, $askill3, $askill4, $askill5, $askill6, $askill7, $askill8)
		EndFunc

		Func loadskilltemplate($atemplate, $aheronumber = 0)
			Local $lheroid = getheroid($aheronumber)
			Local $lsplittemplate = StringSplit($atemplate, "")
			Local $ltemplatetype
			Local $lversionnumber
			Local $lprofbits
			Local $lprofprimary
			Local $lprofsecondary
			Local $lattributescount
			Local $lattributesbits
			Local $lattributes[1][2]
			Local $lskillsbits
			Local $lskills[8]
			Local $loptail
			$atemplate = ""
			For $i = 1 To $lsplittemplate[0]
				$atemplate &= base64tobin64($lsplittemplate[$i])
			Next
			$ltemplatetype = bin64todec(StringLeft($atemplate, 4))
			$atemplate = StringTrimLeft($atemplate, 4)
			If $ltemplatetype <> 14 Then Return False
			$lversionnumber = bin64todec(StringLeft($atemplate, 4))
			$atemplate = StringTrimLeft($atemplate, 4)
			$lprofbits = bin64todec(StringLeft($atemplate, 2)) * 2 + 4
			$atemplate = StringTrimLeft($atemplate, 2)
			$lprofprimary = bin64todec(StringLeft($atemplate, $lprofbits))
			$atemplate = StringTrimLeft($atemplate, $lprofbits)
			$lprofsecondary = bin64todec(StringLeft($atemplate, $lprofbits))
			$atemplate = StringTrimLeft($atemplate, $lprofbits)
			$lattributescount = bin64todec(StringLeft($atemplate, 4))
			$atemplate = StringTrimLeft($atemplate, 4)
			$lattributesbits = bin64todec(StringLeft($atemplate, 4)) + 4
			$atemplate = StringTrimLeft($atemplate, 4)
			$lattributes[0][0] = $lattributescount
			For $i = 1 To $lattributescount
				If bin64todec(StringLeft($atemplate, $lattributesbits)) == getprofprimaryattribute($lprofprimary) Then
					$atemplate = StringTrimLeft($atemplate, $lattributesbits)
					$lattributes[0][1] = bin64todec(StringLeft($atemplate, 4))
					$atemplate = StringTrimLeft($atemplate, 4)
					ContinueLoop
				EndIf
				$lattributes[0][0] += 1
				ReDim $lattributes[$lattributes[0][0] + 1][2]
				$lattributes[$i][0] = bin64todec(StringLeft($atemplate, $lattributesbits))
				$atemplate = StringTrimLeft($atemplate, $lattributesbits)
				$lattributes[$i][1] = bin64todec(StringLeft($atemplate, 4))
				$atemplate = StringTrimLeft($atemplate, 4)
			Next
			$lskillsbits = bin64todec(StringLeft($atemplate, 4)) + 8
			$atemplate = StringTrimLeft($atemplate, 4)
			For $i = 0 To 7
				$lskills[$i] = bin64todec(StringLeft($atemplate, $lskillsbits))
				$atemplate = StringTrimLeft($atemplate, $lskillsbits)
			Next
			$loptail = bin64todec($atemplate)
			$lattributes[0][0] = $lprofsecondary
			myloadattributes($lattributes, $aheronumber)
			loadskillbar($lskills[0], $lskills[1], $lskills[2], $lskills[3], $lskills[4], $lskills[5], $lskills[6], $lskills[7], $aheronumber)
		EndFunc

		Func myloadattributes($attributesarray, $heronumber)
			Sleep(500)
			Local $secprof = $attributesarray[0][0]
			Local $primprof = getheroprofession($heronumber)
			changesecondprofession($secprof, $heronumber)
			myclearattributes($primprof, $secprof, $heronumber)
			If $attributesarray[0][1] <> "" Then
				Local $primattr
				Switch $primprof
					Case 1
						$primattr = 17
					Case 2
						$primattr = 23
					Case 3
						$primattr = 16
					Case 4
						$primattr = 6
					Case 5
						$primattr = 0
					Case 6
						$primattr = 12
					Case 7
						$primattr = 35
					Case 8
						$primattr = 36
					Case 9
						$primattr = 38
					Case 10
						$primattr = 44
				EndSwitch
				myincreaseattribute($primattr, $heronumber, $attributesarray[0][1])
			EndIf
			For $i = 1 To UBound($attributesarray, $ubound_rows) - 1
				If $attributesarray[$i][0] <> "" Then
					myincreaseattribute($attributesarray[$i][0], $heronumber, $attributesarray[$i][1])
					Sleep(100)
				EndIf
				Sleep(100)
			Next
		EndFunc

		Func myclearattributes($primprof, $secprof, $heronumber)
			Local $prim1, $prim2, $prim3, $prim4, $sec5, $sec6, $sec7
			Switch $primprof
				Case 1
					$prim1 = 17
					$prim2 = 18
					$prim3 = 19
					$prim4 = 20
				Case 2
					$prim1 = 23
					$prim2 = 22
					$prim3 = 24
					$prim4 = 25
				Case 3
					$prim1 = 16
					$prim2 = 13
					$prim3 = 14
					$prim4 = 15
				Case 4
					$prim1 = 6
					$prim2 = 4
					$prim3 = 5
					$prim4 = 7
				Case 5
					$prim1 = 0
					$prim2 = 1
					$prim3 = 2
					$prim4 = 3
				Case 6
					$prim1 = 12
					$prim2 = 8
					$prim3 = 9
					$prim4 = 10
				Case 7
					$prim1 = 35
					$prim2 = 29
					$prim3 = 30
					$prim4 = 31
				Case 8
					$prim1 = 36
					$prim2 = 32
					$prim3 = 33
					$prim4 = 34
				Case 9
					$prim1 = 38
					$prim2 = 37
					$prim3 = 39
					$prim4 = 40
				Case 10
					$prim1 = 44
					$prim2 = 41
					$prim3 = 42
					$prim4 = 43
			EndSwitch
			Switch $secprof
				Case 1
					$sec5 = 18
					$sec6 = 19
					$sec7 = 20
				Case 2
					$sec5 = 22
					$sec6 = 24
					$sec7 = 25
				Case 3
					$sec5 = 13
					$sec6 = 14
					$sec7 = 15
				Case 4
					$sec5 = 4
					$sec6 = 5
					$sec7 = 7
				Case 5
					$sec5 = 1
					$sec6 = 2
					$sec7 = 3
				Case 6
					$sec5 = 8
					$sec6 = 9
					$sec7 = 10
				Case 7
					$sec5 = 29
					$sec6 = 30
					$sec7 = 31
				Case 8
					$sec5 = 32
					$sec6 = 33
					$sec7 = 34
				Case 9
					$sec5 = 37
					$sec6 = 39
					$sec7 = 40
				Case 10
					$sec5 = 41
					$sec6 = 42
					$sec7 = 43
			EndSwitch
			Local $attributes[7] = [$prim1, $prim2, $prim3, $prim4, $sec5, $sec6, $sec7]
			For $i = 0 To 6
				For $j = 0 To 11
					decreaseattribute($attributes[$i], $heronumber)
					Sleep(50)
				Next
			Next
		EndFunc

		Func loadattributes($aattributesarray, $aheronumber = 0)
			Local $lprimaryattribute
			Local $ldeadlock
			Local $lheroid = getheroid($aheronumber)
			Local $llevel
			$lprimaryattribute = getprofprimaryattribute(getheroprofession($aheronumber))
			If $aattributesarray[0][0] <> 0 AND getheroprofession($aheronumber, True) <> $aattributesarray[0][0] AND getheroprofession($aheronumber) <> $aattributesarray[0][0] Then
				Do
					$ldeadlock = TimerInit()
					changesecondprofession($aattributesarray[0][0], $aheronumber)
					Do
						Sleep(20)
					Until getheroprofession($aheronumber, True) == $aattributesarray[0][0] OR TimerDiff($ldeadlock) > 5000
				Until getheroprofession($aheronumber, True) == $aattributesarray[0][0]
			EndIf
			$aattributesarray[0][0] = $lprimaryattribute
			For $i = 0 To UBound($aattributesarray) - 1
				If $aattributesarray[$i][1] > 12 Then $aattributesarray[$i][1] = 12
				If $aattributesarray[$i][1] < 0 Then $aattributesarray[$i][1] = 0
			Next
			While getattributebyid($lprimaryattribute, False, $aheronumber) > $aattributesarray[0][1]
				$llevel = getattributebyid($lprimaryattribute, False, $aheronumber)
				$ldeadlock = TimerInit()
				decreaseattribute($lprimaryattribute, $aheronumber)
				Do
					Sleep(20)
				Until getattributebyid($lprimaryattribute, False, $aheronumber) < $llevel OR TimerDiff($ldeadlock) > 5000
				tolsleep()
			WEnd
			For $i = 1 To UBound($aattributesarray) - 1
				While getattributebyid($aattributesarray[$i][0], False, $aheronumber) > $aattributesarray[$i][1]
					$llevel = getattributebyid($aattributesarray[$i][0], False, $aheronumber)
					$ldeadlock = TimerInit()
					decreaseattribute($aattributesarray[$i][0], $aheronumber)
					Do
						Sleep(20)
					Until getattributebyid($aattributesarray[$i][0], False, $aheronumber) < $llevel OR TimerDiff($ldeadlock) > 5000
					tolsleep()
				WEnd
			Next
			For $i = 0 To 44
				If getattributebyid($i, False, $aheronumber) > 0 Then
					If $i = $lprimaryattribute Then ContinueLoop
					For $j = 1 To UBound($aattributesarray) - 1
						If $i = $aattributesarray[$j][0] Then ContinueLoop 2
						Local $ldummy
					Next
					While getattributebyid($i, False, $aheronumber) > 0
						$llevel = getattributebyid($i, False, $aheronumber)
						$ldeadlock = TimerInit()
						decreaseattribute($i, $aheronumber)
						Do
							Sleep(20)
						Until getattributebyid($i, False, $aheronumber) < $llevel OR TimerDiff($ldeadlock) > 5000
						tolsleep()
					WEnd
				EndIf
			Next
			While getattributebyid($lprimaryattribute, False, $aheronumber) < $aattributesarray[0][1]
				$llevel = getattributebyid($lprimaryattribute, False, $aheronumber)
				$ldeadlock = TimerInit()
				increaseattribute($lprimaryattribute, $aheronumber)
				Do
					Sleep(20)
				Until getattributebyid($lprimaryattribute, False, $aheronumber) > $llevel OR TimerDiff($ldeadlock) > 5000
				tolsleep()
			WEnd
			For $i = 1 To UBound($aattributesarray) - 1
				While getattributebyid($aattributesarray[$i][0], False, $aheronumber) < $aattributesarray[$i][1]
					$llevel = getattributebyid($aattributesarray[$i][0], False, $aheronumber)
					$ldeadlock = TimerInit()
					increaseattribute($aattributesarray[$i][0], $aheronumber)
					Do
						Sleep(20)
					Until getattributebyid($aattributesarray[$i][0], False, $aheronumber) > $llevel OR TimerDiff($ldeadlock) > 5000
					tolsleep()
				WEnd
			Next
		EndFunc

		Func increaseattribute($aattributeid, $aheronumber = 0)
			DllStructSetData($mincreaseattribute, 2, $aattributeid)
			DllStructSetData($mincreaseattribute, 3, getheroid($aheronumber))
			enqueue($mincreaseattributeptr, 12)
		EndFunc

		Func myincreaseattribute($aattributeid, $aheronumber = 0, $c = 1)
			DllStructSetData($mincreaseattribute, 2, $aattributeid)
			DllStructSetData($mincreaseattribute, 3, getheroid($aheronumber))
			For $i = 1 To $c
				enqueue($mincreaseattributeptr, 12)
				Sleep(100)
			Next
		EndFunc

		Func decreaseattribute($aattributeid, $aheronumber = 0)
			DllStructSetData($mdecreaseattribute, 2, $aattributeid)
			DllStructSetData($mdecreaseattribute, 3, getheroid($aheronumber))
			enqueue($mdecreaseattributeptr, 12)
		EndFunc

		Func clearattributes($aheronumber = 0)
			Local $llevel
			If getmaploading() <> 0 Then Return
			For $i = 0 To 44
				If getattributebyid($i, False, $aheronumber) > 0 Then
					Do
						$llevel = getattributebyid($i, False, $aheronumber)
						$ldeadlock = TimerInit()
						decreaseattribute($i, $aheronumber)
						Do
							Sleep(20)
						Until $llevel > getattributebyid($i, False, $aheronumber) OR TimerDiff($ldeadlock) > 5000
						Sleep(100)
					Until getattributebyid($i, False, $aheronumber) == 0
				EndIf
			Next
		EndFunc

		Func changesecondprofession($aprofession, $aheronumber = 0)
			Return sendpacket(12, 58, getheroid($aheronumber), $aprofession)
		EndFunc

		Func initmapload()
			memorywrite($mmapisloaded, 0)
		EndFunc

		Func ensureenglish($aensure)
			If $aensure Then
				memorywrite($mensureenglish, 1)
			Else
				memorywrite($mensureenglish, 0)
			EndIf
		EndFunc

		Func togglelanguage()
			DllStructSetData($mtogglelanguage, 2, 24)
			enqueue($mtogglelanguageptr, 8)
		EndFunc

		Func changemaxzoom($azoom = 750)
			memorywrite($mzoomstill, $azoom, "float")
			memorywrite($mzoommoving, $azoom, "float")
		EndFunc

		Func clearmemory()
			DllCall($mkernelhandle, "int", "SetProcessWorkingSetSize", "int", $mgwprochandle, "int", -1, "int", -1)
		EndFunc

		Func setmaxmemory($amemory = 157286400)
			DllCall($mkernelhandle, "int", "SetProcessWorkingSetSizeEx", "int", $mgwprochandle, "int", 1, "int", $amemory, "int", 6)
		EndFunc

	#EndRegion Misc

	Func enqueue($aptr, $asize)
		DllCall($mkernelhandle, "int", "WriteProcessMemory", "int", $mgwprochandle, "int", 256 * $mqueuecounter + $mqueuebase, "ptr", $aptr, "int", $asize, "int", "")
		If $mqueuecounter = $mqueuesize Then
			$mqueuecounter = 0
		Else
			$mqueuecounter = $mqueuecounter + 1
		EndIf
	EndFunc

	Func floattoint($nfloat)
		Local $tfloat = DllStructCreate("float")
		Local $tint = DllStructCreate("int", DllStructGetPtr($tfloat))
		DllStructSetData($tfloat, 1, $nfloat)
		Return DllStructGetData($tint, 1)
	EndFunc

#EndRegion Commands
#Region Queries
	#Region Titles

		Func getherotitle()
			Local $loffset[5] = [0, 24, 44, 2076, 4]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getgladiatortitle()
			Local $loffset[5] = [0, 24, 44, 2076, 124]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getkurzicktitle()
			Local $loffset[5] = [0, 24, 44, 2076, 204]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getluxontitle()
			Local $loffset[5] = [0, 24, 44, 2076, 244]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getdrunkardtitle()
			Local $loffset[5] = [0, 24, 44, 2076, 284]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getsurvivortitle()
			Local $loffset[5] = [0, 24, 44, 2076, 364]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaxtitles()
			Local $loffset[5] = [0, 24, 44, 2076, 404]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getluckytitle()
			Local $loffset[5] = [0, 24, 44, 2076, 604]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getunluckytitle()
			Local $loffset[5] = [0, 24, 44, 2076, 644]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getsunspeartitle()
			Local $loffset[5] = [0, 24, 44, 2076, 684]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getlightbringertitle()
			Local $loffset[5] = [0, 24, 44, 2076, 804]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getcommandertitle()
			Local $loffset[5] = [0, 24, 44, 2076, 884]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getgamertitle()
			Local $loffset[5] = [0, 24, 44, 2076, 924]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getlegendaryguardiantitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1244]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getsweettitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1364]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getasuratitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1524]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getdeldrimortitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1564]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getvanguardtitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1604]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getnorntitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1644]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getnorthmasterytitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1684]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getpartytitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1724]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getzaishentitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1764]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func gettreasuretitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1804]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getwisdomtitle()
			Local $loffset[5] = [0, 24, 44, 2076, 1844]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

	#EndRegion Titles
	#Region Faction

		Func getkurzickfaction()
			Local $loffset[4] = [0, 24, 44, 1864]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaxkurzickfaction()
			Local $loffset[4] = [0, 24, 44, 1976]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getluxonfaction()
			Local $loffset[4] = [0, 24, 44, 1880]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaxluxonfaction()
			Local $loffset[4] = [0, 24, 44, 1980]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getbalthazarfaction()
			Local $loffset[4] = [0, 24, 44, 1944]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaxbalthazarfaction()
			Local $loffset[4] = [0, 24, 44, 1984]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getimperialfaction()
			Local $loffset[4] = [0, 24, 44, 1900]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaximperialfaction()
			Local $loffset[4] = [0, 24, 44, 1988]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

	#EndRegion Faction
	#Region Item

		Func getrarity($aitem)
			If NOT IsDllStruct($aitem) Then $aitem = getitembyitemid($aitem)
			Local $lptr = DllStructGetData($aitem, "NameString")
			If $lptr == 0 Then Return
			Return memoryread($lptr, "ushort")
		EndFunc

		Func getisided($aitem)
			If NOT IsDllStruct($aitem) Then $aitem = getitembyitemid($aitem)
			Return BitAND(DllStructGetData($aitem, "interaction"), 1) > 0
		EndFunc

		Func getitemreq($aitem)
			Local $lmod = getmodbyidentifier($aitem, "9827")
			Return $lmod[0]
		EndFunc

		Func getitemattribute($aitem)
			Local $lmod = getmodbyidentifier($aitem, "9827")
			Return $lmod[1]
		EndFunc

		Func getmodbyidentifier($aitem, $aidentifier)
			If NOT IsDllStruct($aitem) Then $aitem = getitembyitemid($aitem)
			Local $lreturn[2]
			Local $lstring = StringTrimLeft(getmodstruct($aitem), 2)
			For $i = 0 To StringLen($lstring) / 8 - 2
				If StringMid($lstring, 8 * $i + 5, 4) == $aidentifier Then
					$lreturn[0] = Int("0x" & StringMid($lstring, 8 * $i + 1, 2))
					$lreturn[1] = Int("0x" & StringMid($lstring, 8 * $i + 3, 2))
					ExitLoop
				EndIf
			Next
			Return $lreturn
		EndFunc

		Func getmodstruct($aitem)
			If NOT IsDllStruct($aitem) Then $aitem = getitembyitemid($aitem)
			If DllStructGetData($aitem, "modstruct") = 0 Then Return
			Return memoryread(DllStructGetData($aitem, "modstruct"), "Byte[" & DllStructGetData($aitem, "modstructsize") * 4 & "]")
		EndFunc

		Func getassignedtome($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return (DllStructGetData($aagent, "Owner") = getmyid())
		EndFunc

		Func getcanpickup($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			If getassignedtome($aagent) OR DllStructGetData($aagent, "Owner") = 0 Then
				Return True
			Else
				Return False
			EndIf
		EndFunc

		Func getbag($abag)
			Local $loffset[5] = [0, 24, 64, 248, 4 * $abag]
			Local $lbagstruct = DllStructCreate("byte unknown1[4];long index;long id;ptr containerItem;long ItemsCount;ptr bagArray;ptr itemArray;long fakeSlots;long slots")
			Local $lbagptr = memoryreadptr($mbasepointer, $loffset)
			If $lbagptr[1] = 0 Then Return
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lbagptr[1], "ptr", DllStructGetPtr($lbagstruct), "int", DllStructGetSize($lbagstruct), "int", "")
			Return $lbagstruct
		EndFunc

		Func getitembyslot($abag, $aslot)
			Local $lbag
			If IsDllStruct($abag) = 0 Then
				$lbag = getbag($abag)
			Else
				$lbag = $abag
			EndIf
			Local $litemptr = DllStructGetData($lbag, "ItemArray")
			Local $lbuffer = DllStructCreate("ptr")
			Local $litemstruct = DllStructCreate("long id;long agentId;byte unknown1[4];ptr bag;ptr modstruct;long modstructsize;ptr customized;byte unknown2[4];byte type;byte unknown3;short extraId;short value;byte unknown4[2];short interaction;long modelId;ptr modString;byte unknown5[4];ptr NameString;byte unknown6[15];byte quantity;byte equipped;byte unknown7[1];byte slot")
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", DllStructGetData($lbag, "ItemArray") + 4 * ($aslot - 1), "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", DllStructGetData($lbuffer, 1), "ptr", DllStructGetPtr($litemstruct), "int", DllStructGetSize($litemstruct), "int", "")
			Return $litemstruct
		EndFunc

		Func getitembyitemid($aitemid)
			Local $litemstruct = DllStructCreate("long id;long agentId;byte unknown1[4];ptr bag;ptr modstruct;long modstructsize;ptr customized;byte unknown2[4];byte type;byte unknown3;short extraId;short value;byte unknown4[2];short interaction;long modelId;ptr modString;byte unknown5[4];ptr NameString;byte unknown6[15];byte quantity;byte equipped;byte unknown7[1];byte slot")
			Local $loffset[5] = [0, 24, 64, 184, 4 * $aitemid]
			Local $litemptr = memoryreadptr($mbasepointer, $loffset)
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemptr[1], "ptr", DllStructGetPtr($litemstruct), "int", DllStructGetSize($litemstruct), "int", "")
			Return $litemstruct
		EndFunc

		Func getitembyagentid($aagentid)
			Local $litemstruct = DllStructCreate("long id;long agentId;byte unknown1[4];ptr bag;ptr modstruct;long modstructsize;ptr customized;byte unknown2[4];byte type;byte unknown3;short extraId;short value;byte unknown4[2];short interaction;long modelId;ptr modString;byte unknown5[4];ptr NameString;byte unknown6[15];byte quantity;byte equipped;byte unknown7[1];byte slot")
			Local $loffset[4] = [0, 24, 64, 192]
			Local $litemarraysize = memoryreadptr($mbasepointer, $loffset)
			Local $loffset[5] = [0, 24, 64, 184, 0]
			Local $litemptr, $litemid
			Local $lagentid = convertid($aagentid)
			For $litemid = 1 To $litemarraysize[1]
				$loffset[4] = 4 * $litemid
				$litemptr = memoryreadptr($mbasepointer, $loffset)
				If $litemptr[1] = 0 Then ContinueLoop
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemptr[1], "ptr", DllStructGetPtr($litemstruct), "int", DllStructGetSize($litemstruct), "int", "")
				If DllStructGetData($litemstruct, "AgentID") = $lagentid Then Return $litemstruct
			Next
		EndFunc

		Func getitembymodelid($amodelid)
			Local $litemstruct = DllStructCreate("long id;long agentId;byte unknown1[4];ptr bag;ptr modstruct;long modstructsize;ptr customized;byte unknown2[4];byte type;byte unknown3;short extraId;short value;byte unknown4[2];short interaction;long modelId;ptr modString;byte unknown5[4];ptr NameString;byte unknown6[15];byte quantity;byte equipped;byte unknown7[1];byte slot")
			Local $loffset[4] = [0, 24, 64, 192]
			Local $litemarraysize = memoryreadptr($mbasepointer, $loffset)
			Local $loffset[5] = [0, 24, 64, 184, 0]
			Local $litemptr, $litemid
			For $litemid = 1 To $litemarraysize[1]
				$loffset[4] = 4 * $litemid
				$litemptr = memoryreadptr($mbasepointer, $loffset)
				If $litemptr[1] = 0 Then ContinueLoop
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemptr[1], "ptr", DllStructGetPtr($litemstruct), "int", DllStructGetSize($litemstruct), "int", "")
				If DllStructGetData($litemstruct, "ModelID") = $amodelid Then Return $litemstruct
			Next
		EndFunc

		Func getgoldstorage()
			Local $loffset[5] = [0, 24, 64, 248, 128]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getgoldcharacter()
			Local $loffset[5] = [0, 24, 64, 248, 124]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func findsalvagekit()
			Local $litem
			Local $lkit = 0
			Local $luses = 101
			For $i = 1 To 16
				For $j = 1 To DllStructGetData(getbag($i), "Slots")
					$litem = getitembyslot($i, $j)
					Switch DllStructGetData($litem, "ModelID")
						Case 2991
							If DllStructGetData($litem, "Value") / 8 < $luses Then
								$lkit = DllStructGetData($litem, "ID")
								$luses = DllStructGetData($litem, "Value") / 8
							EndIf
						Case 5900
							If DllStructGetData($litem, "Value") / 10 < $luses Then
								$lkit = DllStructGetData($litem, "ID")
								$luses = DllStructGetData($litem, "Value") / 10
							EndIf
						Case Else
							ContinueLoop
					EndSwitch
				Next
			Next
			Return $lkit
		EndFunc

		Func findidkit()
			Local $litem
			Local $lkit = 0
			Local $luses = 101
			For $i = 1 To 16
				For $j = 1 To DllStructGetData(getbag($i), "Slots")
					$litem = getitembyslot($i, $j)
					Switch DllStructGetData($litem, "ModelID")
						Case 2989
							If DllStructGetData($litem, "Value") / 2 < $luses Then
								$lkit = DllStructGetData($litem, "ID")
								$luses = DllStructGetData($litem, "Value") / 2
							EndIf
						Case 5899
							If DllStructGetData($litem, "Value") / 2.5 < $luses Then
								$lkit = DllStructGetData($litem, "ID")
								$luses = DllStructGetData($litem, "Value") / 2.5
							EndIf
						Case Else
							ContinueLoop
					EndSwitch
				Next
			Next
			Return $lkit
		EndFunc

		Func gettradercostid()
			Return memoryread($mtradercostid)
		EndFunc

		Func gettradercostvalue()
			Return memoryread($mtradercostvalue)
		EndFunc

		Func getmerchantitemsbase()
			Local $loffset[4] = [0, 24, 44, 36]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmerchantitemssize()
			Local $loffset[4] = [0, 24, 44, 40]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

	#EndRegion Item
	#Region H&H

		Func getherocount()
			Local $loffset[5]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 76
			$loffset[3] = 84
			$loffset[4] = 44
			Local $lherocount = memoryreadptr($mbasepointer, $loffset)
			Return $lherocount[1]
		EndFunc

		Func getheroid($aheronumber)
			If $aheronumber == 0 Then Return getmyid()
			Local $loffset[6]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 76
			$loffset[3] = 84
			$loffset[4] = 36
			$loffset[5] = 24 * ($aheronumber - 1)
			Local $lagentid = memoryreadptr($mbasepointer, $loffset)
			Return $lagentid[1]
		EndFunc

		Func getheronumberbyagentid($aagentid)
			Local $lagentid
			Local $loffset[6]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 76
			$loffset[3] = 84
			$loffset[4] = 36
			For $i = 1 To getherocount()
				$loffset[5] = 24 * ($i - 1)
				$lagentid = memoryreadptr($mbasepointer, $loffset)
				If $lagentid[1] == convertid($aagentid) Then Return $i
			Next
			Return 0
		EndFunc

		Func getheronumberbyheroid($aheroid)
			Local $lagentid
			Local $loffset[6]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 76
			$loffset[3] = 84
			$loffset[4] = 36
			For $i = 1 To getherocount()
				$loffset[5] = 8 + 24 * ($i - 1)
				$lagentid = memoryreadptr($mbasepointer, $loffset)
				If $lagentid[1] == convertid($aheroid) Then Return $i
			Next
			Return 0
		EndFunc

		Func getheroprofession($aheronumber, $asecondary = False)
			Local $loffset[5] = [0, 24, 44, 1724, 0]
			Local $lbuffer
			$aheronumber = getheroid($aheronumber)
			For $i = 0 To getherocount()
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] = $aheronumber Then
					$loffset[4] += 4
					If $asecondary Then $loffset[4] += 4
					$lbuffer = memoryreadptr($mbasepointer, $loffset)
					Return $lbuffer[1]
				EndIf
				$loffset[4] += 20
			Next
		EndFunc

		Func getisheroskillslotdisabled($aheronumber, $askillslot)
			Return BitAND(2 ^ ($askillslot - 1), DllStructGetData(getskillbar($aheronumber), "Disabled")) > 0
		EndFunc

	#EndRegion H&H
	#Region Agent

		Func getagentbyid($aagentid = -2)
			Local $lagentptr = getagentptr($aagentid)
			If $lagentptr = 0 Then Return 0
			Local $lagentstruct = DllStructCreate("ptr vtable;byte unknown1[24];byte unknown2[4];ptr NextAgent;byte unknown3[8];long Id;float Z;byte unknown4[8];float BoxHoverWidth;float BoxHoverHeight;byte unknown5[8];float Rotation;byte unknown6[8];long NameProperties;byte unknown7[24];float X;float Y;byte unknown8[8];float NameTagX;float NameTagY;float NameTagZ;byte unknown9[12];long Type;float MoveX;float MoveY;byte unknown10[28];long Owner;byte unknown30[8];long ExtraType;byte unknown11[24];float AttackSpeed;float AttackSpeedModifier;word PlayerNumber;byte unknown12[6];ptr Equip;byte unknown13[10];byte Primary;byte Secondary;byte Level;byte Team;byte unknown14[6];float EnergyPips;byte unknown[4];float EnergyPercent;long MaxEnergy;byte unknown15[4];float HPPips;byte unknown16[4];float HP;long MaxHP;long Effects;byte unknown17[4];byte Hex;byte unknown18[18];long ModelState;long TypeMap;byte unknown19[16];long InSpiritRange;byte unknown20[16];long LoginNumber;float ModelMode;byte unknown21[4];long ModelAnimation;byte unknown22[32];byte LastStrike;byte Allegiance;word WeaponType;word Skill;byte unknown23[4];word WeaponItemId;word OffhandItemId")
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lagentptr, "ptr", DllStructGetPtr($lagentstruct), "int", DllStructGetSize($lagentstruct), "int", "")
			Return $lagentstruct
		EndFunc

		Func getagentptr($aagentid)
			Local $loffset[3] = [0, 4 * convertid($aagentid), 0]
			Local $lagentstructaddress = memoryreadptr($magentbase, $loffset)
			Return $lagentstructaddress[0]
		EndFunc

		Func getagentexists($aagentid)
			Return (getagentptr($aagentid) > 0 AND $aagentid < getmaxagents())
		EndFunc

		Func gettarget($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Return memoryread(getvalue("TargetLogBase") + 4 * $lagentid)
		EndFunc

		Func getagentbyplayername($aplayername)
			For $i = 1 To getmaxagents()
				If getplayername($i) = $aplayername Then
					Return getagentbyid($i)
				EndIf
			Next
		EndFunc

		Func getagentbyname($aname)
			If $musestringlog = False Then Return
			Local $lname, $laddress
			For $i = 1 To getmaxagents()
				$laddress = $mstringlogbase + 256 * $i
				$lname = memoryread($laddress, "wchar [128]")
				$lname = StringRegExpReplace($lname, "[<]{1}([^>]+)[>]{1}", "")
				If StringInStr($lname, $aname) > 0 Then Return getagentbyid($i)
			Next
			displayall(True)
			Sleep(100)
			displayall(False)
			displayall(True)
			Sleep(100)
			displayall(False)
			For $i = 1 To getmaxagents()
				$laddress = $mstringlogbase + 256 * $i
				$lname = memoryread($laddress, "wchar [128]")
				$lname = StringRegExpReplace($lname, "[<]{1}([^>]+)[>]{1}", "")
				If StringInStr($lname, $aname) > 0 Then Return getagentbyid($i)
			Next
		EndFunc

		Func getnearestagenttoagent($aagent = -2)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray()
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Local $lid = DllStructGetData($aagent, "ID")
			For $i = 1 To $lagentarray[0]
				$ldistance = (DllStructGetData($aagent, "X") - DllStructGetData($lagentarray[$i], "X")) ^ 2 + (DllStructGetData($aagent, "Y") - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					If DllStructGetData($lagentarray[$i], "ID") == $lid Then ContinueLoop
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestenemytoagent($aagent = -2)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(219)
			If NOT IsDllStruct($aagent) Then $aagent = getagentbyid($aagent)
			Local $lid = DllStructGetData($aagent, "ID")
			For $i = 1 To $lagentarray[0]
				$ldistance = (DllStructGetData($aagent, "X") - DllStructGetData($lagentarray[$i], "X")) ^ 2 + (DllStructGetData($aagent, "Y") - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If DllStructGetData($lagentarray[$i], "Allegiance") <> 3 Then ContinueLoop
				If DllStructGetData($lagentarray[$i], "HP") <= 0 Then ContinueLoop
				If BitAND(DllStructGetData($lagentarray[$i], "Effects"), 16) > 0 Then ContinueLoop
				$ldistance = (DllStructGetData($aagent, "X") - DllStructGetData($lagentarray[$i], "X")) ^ 2 + (DllStructGetData($aagent, "Y") - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					If DllStructGetData($lagentarray[$i], "ID") == $lid Then ContinueLoop
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestagenttocoords($ax, $ay)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray()
			For $i = 1 To $lagentarray[0]
				$ldistance = ($ax - DllStructGetData($lagentarray[$i], "X")) ^ 2 + ($ay - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestsignposttoagent($aagent = -2)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(512)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Local $lid = DllStructGetData($aagent, "ID")
			For $i = 1 To $lagentarray[0]
				$ldistance = (DllStructGetData($lagentarray[$i], "Y") - DllStructGetData($aagent, "Y")) ^ 2 + (DllStructGetData($lagentarray[$i], "X") - DllStructGetData($aagent, "X")) ^ 2
				If $ldistance < $lnearestdistance Then
					If DllStructGetData($lagentarray[$i], "ID") == $lid Then ContinueLoop
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestsignposttocoords($ax, $ay)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(512)
			For $i = 1 To $lagentarray[0]
				$ldistance = ($ax - DllStructGetData($lagentarray[$i], "X")) ^ 2 + ($ay - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestnpctoagent($aagent)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(219)
			If NOT IsDllStruct($aagent) Then $aagent = getagentbyid($aagent)
			Local $lid = DllStructGetData($aagent, "ID")
			For $i = 1 To $lagentarray[0]
				If DllStructGetData($lagentarray[$i], "Allegiance") <> 6 Then ContinueLoop
				If DllStructGetData($lagentarray[$i], "HP") <= 0 Then ContinueLoop
				If BitAND(DllStructGetData($lagentarray[$i], "Effects"), 16) > 0 Then ContinueLoop
				$ldistance = (DllStructGetData($aagent, "X") - DllStructGetData($lagentarray[$i], "X")) ^ 2 + (DllStructGetData($aagent, "Y") - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					If DllStructGetData($lagentarray[$i], "ID") == $lid Then ContinueLoop
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestnpctocoords($ax, $ay)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(219)
			For $i = 1 To $lagentarray[0]
				If DllStructGetData($lagentarray[$i], "Allegiance") <> 6 Then ContinueLoop
				If DllStructGetData($lagentarray[$i], "HP") <= 0 Then ContinueLoop
				If BitAND(DllStructGetData($lagentarray[$i], "Effects"), 16) > 0 Then ContinueLoop
				$ldistance = ($ax - DllStructGetData($lagentarray[$i], "X")) ^ 2 + ($ay - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getnearestitemtoagent($aagent = -2, $acanpickup = True)
			Local $lnearestagent, $lnearestdistance = 100000000
			Local $ldistance
			Local $lagentarray = getagentarray(1024)
			If NOT IsDllStruct($aagent) Then $aagent = getagentbyid($aagent)
			Local $lid = DllStructGetData($aagent, "ID")
			For $i = 1 To $lagentarray[0]
				If $acanpickup AND NOT getcanpickup($lagentarray[$i]) Then ContinueLoop
				$ldistance = (DllStructGetData($aagent, "X") - DllStructGetData($lagentarray[$i], "X")) ^ 2 + (DllStructGetData($aagent, "Y") - DllStructGetData($lagentarray[$i], "Y")) ^ 2
				If $ldistance < $lnearestdistance Then
					If DllStructGetData($lagentarray[$i], "ID") == $lid Then ContinueLoop
					$lnearestagent = $lagentarray[$i]
					$lnearestdistance = $ldistance
				EndIf
			Next
			SetExtended(Sqrt($lnearestdistance))
			Return $lnearestagent
		EndFunc

		Func getparty($aagentarray = 0)
			Local $lreturnarray[1] = [0]
			If $aagentarray == 0 Then $aagentarray = getagentarray(219)
			For $i = 1 To $aagentarray[0]
				If DllStructGetData($aagentarray[$i], "Allegiance") == 1 Then
					If BitAND(DllStructGetData($aagentarray[$i], "TypeMap"), 131072) Then
						$lreturnarray[0] += 1
						ReDim $lreturnarray[$lreturnarray[0] + 1]
						$lreturnarray[$lreturnarray[0]] = $aagentarray[$i]
					EndIf
				EndIf
			Next
			Return $lreturnarray
		EndFunc

		Func getagentarray($atype = 0)
			Local $lstruct
			Local $lcount
			Local $lbuffer = ""
			DllStructSetData($mmakeagentarray, 2, $atype)
			memorywrite($magentcopycount, -1, "long")
			enqueue($mmakeagentarrayptr, 8)
			Local $ldeadlock = TimerInit()
			Do
				Sleep(1)
				$lcount = memoryread($magentcopycount, "long")
			Until $lcount >= 0 OR TimerDiff($ldeadlock) > 5000
			If $lcount < 0 Then $lcount = 0
			For $i = 1 To $lcount
				$lbuffer &= "Byte[448];"
			Next
			$lbuffer = DllStructCreate($lbuffer)
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $magentcopybase, "ptr", DllStructGetPtr($lbuffer), "int", DllStructGetSize($lbuffer), "int", "")
			Local $lreturnarray[$lcount + 1] = [$lcount]
			For $i = 1 To $lcount
				$lreturnarray[$i] = DllStructCreate("ptr vtable;byte unknown1[24];byte unknown2[4];ptr NextAgent;byte unknown3[8];long Id;float Z;byte unknown4[8];float BoxHoverWidth;float BoxHoverHeight;byte unknown5[8];float Rotation;byte unknown6[8];long NameProperties;byte unknown7[24];float X;float Y;byte unknown8[8];float NameTagX;float NameTagY;float NameTagZ;byte unknown9[12];long Type;float MoveX;float MoveY;byte unknown10[28];long Owner;byte unknown30[8];long ExtraType;byte unknown11[24];float AttackSpeed;float AttackSpeedModifier;word PlayerNumber;byte unknown12[6];ptr Equip;byte unknown13[10];byte Primary;byte Secondary;byte Level;byte Team;byte unknown14[6];float EnergyPips;byte unknown[4];float EnergyPercent;long MaxEnergy;byte unknown15[4];float HPPips;byte unknown16[4];float HP;long MaxHP;long Effects;byte unknown17[4];byte Hex;byte unknown18[18];long ModelState;long TypeMap;byte unknown19[16];long InSpiritRange;byte unknown20[16];long LoginNumber;float ModelMode;byte unknown21[4];long ModelAnimation;byte unknown22[32];byte LastStrike;byte Allegiance;word WeaponType;word Skill;byte unknown23[4];word WeaponItemId;word OffhandItemId")
				$lstruct = DllStructCreate("byte[448]", DllStructGetPtr($lreturnarray[$i]))
				DllStructSetData($lstruct, 1, DllStructGetData($lbuffer, $i))
			Next
			Return $lreturnarray
		EndFunc

		Func getpartydanger($aagentarray = 0, $aparty = 0)
			If $aagentarray == 0 Then $aagentarray = getagentarray(219)
			If $aparty == 0 Then $aparty = getparty($aagentarray)
			Local $lreturnarray[$aparty[0] + 1]
			$lreturnarray[0] = $aparty[0]
			For $i = 1 To $lreturnarray[0]
				$lreturnarray[$i] = 0
			Next
			For $i = 1 To $aagentarray[0]
				If BitAND(DllStructGetData($aagentarray[$i], "Effects"), 16) > 0 Then ContinueLoop
				If DllStructGetData($aagentarray[$i], "HP") <= 0 Then ContinueLoop
				If NOT getisliving($aagentarray[$i]) Then ContinueLoop
				If DllStructGetData($aagentarray[$i], "Allegiance") > 3 Then ContinueLoop
				For $j = 1 To $aparty[0]
					If gettarget(DllStructGetData($aagentarray[$i], "ID")) == DllStructGetData($aparty[$j], "ID") Then
						If getdistance($aagentarray[$i], $aparty[$j]) < 5000 Then
							If DllStructGetData($aagentarray[$i], "Team") <> 0 Then
								If DllStructGetData($aagentarray[$i], "Team") <> DllStructGetData($aparty[$j], "Team") Then
									$lreturnarray[$j] += 1
								EndIf
							ElseIf DllStructGetData($aagentarray[$i], "Allegiance") <> DllStructGetData($aparty[$j], "Allegiance") Then
								$lreturnarray[$j] += 1
							EndIf
						EndIf
					EndIf
				Next
			Next
			Return $lreturnarray
		EndFunc

		Func getagentdanger($aagent, $aagentarray = 0)
			If IsDllStruct($aagent) = 0 Then
				$aagent = getagentbyid($aagent)
			EndIf
			Local $lcount = 0
			If $aagentarray == 0 Then $aagentarray = getagentarray(219)
			For $i = 1 To $aagentarray[0]
				If BitAND(DllStructGetData($aagentarray[$i], "Effects"), 16) > 0 Then ContinueLoop
				If DllStructGetData($aagentarray[$i], "HP") <= 0 Then ContinueLoop
				If NOT getisliving($aagentarray[$i]) Then ContinueLoop
				If DllStructGetData($aagentarray[$i], "Allegiance") > 3 Then ContinueLoop
				If gettarget(DllStructGetData($aagentarray[$i], "ID")) == DllStructGetData($aagent, "ID") Then
					If getdistance($aagentarray[$i], $aagent) < 5000 Then
						If DllStructGetData($aagentarray[$i], "Team") <> 0 Then
							If DllStructGetData($aagentarray[$i], "Team") <> DllStructGetData($aagent, "Team") Then
								$lcount += 1
							EndIf
						ElseIf DllStructGetData($aagentarray[$i], "Allegiance") <> DllStructGetData($aagent, "Allegiance") Then
							$lcount += 1
						EndIf
					EndIf
				EndIf
			Next
			Return $lcount
		EndFunc

	#EndRegion Agent
	#Region AgentInfo

		Func getisliving($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "Type") = 219
		EndFunc

		Func getisstatic($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "Type") = 512
		EndFunc

		Func getismovable($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "Type") = 1024
		EndFunc

		Func getenergy($aagent = -2)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "EnergyPercent") * DllStructGetData($aagent, "MaxEnergy")
		EndFunc

		Func gethealth($aagent = -2)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "HP") * DllStructGetData($aagent, "MaxHP")
		EndFunc

		Func getismoving($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			If DllStructGetData($aagent, "MoveX") <> 0 OR DllStructGetData($aagent, "MoveY") <> 0 Then Return True
			Return False
		EndFunc

		Func getisknocked($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "ModelState") = 1104
		EndFunc

		Func getisattacking($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Switch DllStructGetData($aagent, "ModelState")
				Case 96
					Return True
				Case 1088
					Return True
				Case 1120
					Return True
				Case Else
					Return False
			EndSwitch
		EndFunc

		Func getiscasting($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return DllStructGetData($aagent, "Skill") <> 0
		EndFunc

		Func getisbleeding($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 1) > 0
		EndFunc

		Func gethascondition($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 2) > 0
		EndFunc

		Func getisdead($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 16) > 0
		EndFunc

		Func gethasdeepwound($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 32) > 0
		EndFunc

		Func getispoisoned($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 64) > 0
		EndFunc

		Func getisenchanted($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 128) > 0
		EndFunc

		Func gethasdegenhex($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 1024) > 0
		EndFunc

		Func gethashex($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 2048) > 0
		EndFunc

		Func gethasweaponspell($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "Effects"), 32768) > 0
		EndFunc

		Func getisboss($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Return BitAND(DllStructGetData($aagent, "TypeMap"), 1024) > 0
		EndFunc

		Func getplayername($aagent)
			If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
			Local $llogin = DllStructGetData($aagent, "LoginNumber")
			Local $loffset[6] = [0, 24, 44, 2060, 76 * $llogin + 40, 0]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset, "wchar[30]")
			Return $lreturn[1]
		EndFunc

		Func getagentname($aagent)
			If $musestringlog = False Then Return
			If IsDllStruct($aagent) = 0 Then
				Local $lagentid = convertid($aagent)
				If $lagentid = 0 Then Return ""
			Else
				Local $lagentid = DllStructGetData($aagent, "ID")
			EndIf
			Local $laddress = $mstringlogbase + 256 * $lagentid
			Local $lname = memoryread($laddress, "wchar [128]")
			If $lname = "" Then
				displayall(True)
				Sleep(100)
				displayall(False)
			EndIf
			Local $lname = memoryread($laddress, "wchar [128]")
			$lname = StringRegExpReplace($lname, "[<]{1}([^>]+)[>]{1}", "")
			Return $lname
		EndFunc

	#EndRegion AgentInfo
	#Region Buff

		Func getbuffcount($aheronumber = 0)
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1296
			Local $lcount = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[5]
			$loffset[3] = 1288
			Local $lbuffer
			For $i = 0 To $lcount[1] - 1
				$loffset[4] = 36 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == getheroid($aheronumber) Then
					Return memoryread($lbuffer[0] + 12)
				EndIf
			Next
			Return 0
		EndFunc

		Func getistargetbuffed($askillid, $aagentid, $aheronumber = 0)
			Local $lbuffstruct = DllStructCreate("long SkillId;byte unknown1[4];long BuffId;long TargetId")
			Local $lbuffcount = getbuffcount($aheronumber)
			Local $lbuffstructaddress
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1296
			Local $lcount = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[5]
			$loffset[3] = 1288
			Local $lbuffer
			For $i = 0 To $lcount[1] - 1
				$loffset[4] = 36 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == getheroid($aheronumber) Then
					$loffset[4] = 4 + 36 * $i
					ReDim $loffset[6]
					For $j = 0 To $lbuffcount - 1
						$loffset[5] = 0 + 16 * $j
						$lbuffstructaddress = memoryreadptr($mbasepointer, $loffset)
						DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lbuffstructaddress[0], "ptr", DllStructGetPtr($lbuffstruct), "int", DllStructGetSize($lbuffstruct), "int", "")
						If (DllStructGetData($lbuffstruct, "SkillID") == $askillid) AND (DllStructGetData($lbuffstruct, "TargetId") == convertid($aagentid)) Then
							Return $j + 1
						EndIf
					Next
				EndIf
			Next
			Return 0
		EndFunc

		Func getbuffbyindex($abuffnumber, $aheronumber = 0)
			Local $lbuffstruct = DllStructCreate("long SkillId;byte unknown1[4];long BuffId;long TargetId")
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1296
			Local $lcount = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[5]
			$loffset[3] = 1288
			Local $lbuffer
			For $i = 0 To $lcount[1] - 1
				$loffset[4] = 36 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == getheroid($aheronumber) Then
					$loffset[4] = 4 + 36 * $i
					ReDim $loffset[6]
					$loffset[5] = 0 + 16 * ($abuffnumber - 1)
					$lbuffstructaddress = memoryreadptr($mbasepointer, $loffset)
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lbuffstructaddress[0], "ptr", DllStructGetPtr($lbuffstruct), "int", DllStructGetSize($lbuffstruct), "int", "")
					Return $lbuffstruct
				EndIf
			Next
			Return 0
		EndFunc

	#EndRegion Buff
	#Region Misc

		Func getskillbar($aheronumber = 0)
			Local $lskillbarstruct = DllStructCreate("long AgentId;long AdrenalineA1;long AdrenalineB1;dword Recharge1;dword Id1;dword Event1;long AdrenalineA2;long AdrenalineB2;dword Recharge2;dword Id2;dword Event2;long AdrenalineA3;long AdrenalineB3;dword Recharge3;dword Id3;dword Event3;long AdrenalineA4;long AdrenalineB4;dword Recharge4;dword Id4;dword Event4;long AdrenalineA5;long AdrenalineB5;dword Recharge5;dword Id5;dword Event5;long AdrenalineA6;long AdrenalineB6;dword Recharge6;dword Id6;dword Event6;long AdrenalineA7;long AdrenalineB7;dword Recharge7;dword Id7;dword Event7;long AdrenalineA8;long AdrenalineB8;dword Recharge8;dword Id8;dword Event8;dword disabled;byte unknown[8];dword Casting")
			Local $loffset[5]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1776
			For $i = 0 To getherocount()
				$loffset[4] = $i * 188
				Local $lskillbarstructaddress = memoryreadptr($mbasepointer, $loffset)
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lskillbarstructaddress[0], "ptr", DllStructGetPtr($lskillbarstruct), "int", DllStructGetSize($lskillbarstruct), "int", "")
				If DllStructGetData($lskillbarstruct, "AgentId") == getheroid($aheronumber) Then Return $lskillbarstruct
			Next
		EndFunc

		Func getskillbarskillid($askillslot, $aheronumber = 0)
			Return DllStructGetData(getskillbar($aheronumber), "ID" & $askillslot)
		EndFunc

		Func getskillbarskilladrenaline($askillslot, $aheronumber = 0)
			Return DllStructGetData(getskillbar($aheronumber), "AdrenalineA" & $askillslot)
		EndFunc

		Func getskillbarskillrecharge($askillslot, $aheronumber = 0)
			Local $ltimestamp = DllStructGetData(getskillbar($aheronumber), "Recharge" & $askillslot)
			If $ltimestamp == 0 Then Return 0
			Return $ltimestamp - getskilltimer()
		EndFunc

		Func getskillbyid($askillid)
			Local $lskillstruct = DllStructCreate("long ID;byte Unknown1[4];long campaign;long Type;long Special;long ComboReq;long Effect1;long Condition;long Effect2;long WeaponReq;byte Profession;byte Attribute;byte Unknown2[2];long PvPID;byte Combo;byte Target;byte unknown3;byte EquipType;byte Unknown4[4];dword Adrenaline;float Activation;float Aftercast;long Duration0;long Duration15;long Recharge;byte Unknown5[12];long Scale0;long Scale15;long BonusScale0;long BonusScale15;float AoERange;float ConstEffect;byte unknown6[44]")
			Local $lskillstructaddress = $mskillbase + 160 * $askillid
			DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lskillstructaddress, "ptr", DllStructGetPtr($lskillstruct), "int", DllStructGetSize($lskillstruct), "int", "")
			Return $lskillstruct
		EndFunc

		Func getmorale($aheronumber = 0)
			Local $lagentid = getheroid($aheronumber)
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1592
			Local $lindex = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[6]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1580
			$loffset[4] = 8 + 12 * BitAND($lagentid, $lindex[1])
			$loffset[5] = 24
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1] - 100
		EndFunc

		Func geteffect($askillid = 0, $aheronumber = 0)
			Local $leffectcount, $leffectstructaddress
			Local $lreturnarray[1] = [0]
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 1296
			Local $lcount = memoryreadptr($mbasepointer, $loffset)
			ReDim $loffset[5]
			$loffset[3] = 1288
			Local $lbuffer
			For $i = 0 To $lcount[1] - 1
				$loffset[4] = 36 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == getheroid($aheronumber) Then
					$loffset[4] = 28 + 36 * $i
					$leffectcount = memoryreadptr($mbasepointer, $loffset)
					ReDim $loffset[6]
					$loffset[4] = 20 + 36 * $i
					$loffset[5] = 0
					$leffectstructaddress = memoryreadptr($mbasepointer, $loffset)
					If $askillid = 0 Then
						ReDim $lreturnarray[$leffectcount[1] + 1]
						$lreturnarray[0] = $leffectcount[1]
						For $i = 0 To $leffectcount[1] - 1
							$lreturnarray[$i + 1] = DllStructCreate("long SkillId;long EffectType;long EffectId;long AgentId;float Duration;long TimeStamp")
							$leffectstructaddress[1] = $leffectstructaddress[0] + 24 * $i
							DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $leffectstructaddress[1], "ptr", DllStructGetPtr($lreturnarray[$i + 1]), "int", 24, "int", "")
						Next
						ExitLoop
					Else
						Local $lreturn = DllStructCreate("long SkillId;long EffectType;long EffectId;long AgentId;float Duration;long TimeStamp")
						For $i = 0 To $leffectcount[1] - 1
							DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $leffectstructaddress[0] + 24 * $i, "ptr", DllStructGetPtr($lreturn), "int", 24, "int", "")
							If DllStructGetData($lreturn, "SkillID") = $askillid Then Return $lreturn
						Next
					EndIf
				EndIf
			Next
			Return $lreturnarray
		EndFunc

		Func geteffecttimeremaining($aeffect)
			If NOT IsDllStruct($aeffect) Then $aeffect = geteffect($aeffect)
			If IsArray($aeffect) Then Return 0
			Return DllStructGetData($aeffect, "Duration") * 1000 - (getskilltimer() - DllStructGetData($aeffect, "TimeStamp"))
		EndFunc

		Func getskilltimer()
			Return memoryread($mskilltimer, "long")
		EndFunc

		Func getattributebyid($aattributeid, $awithrunes = False, $aheronumber = 0)
			Local $lagentid = getheroid($aheronumber)
			Local $lbuffer
			Local $loffset[5]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 44
			$loffset[3] = 172
			For $i = 0 To getherocount()
				$loffset[4] = 984 * $i
				$lbuffer = memoryreadptr($mbasepointer, $loffset)
				If $lbuffer[1] == $lagentid Then
					If $awithrunes Then
						$loffset[4] = 984 * $i + 20 * $aattributeid + 12
					Else
						$loffset[4] = 984 * $i + 20 * $aattributeid + 8
					EndIf
					$lbuffer = memoryreadptr($mbasepointer, $loffset)
					Return $lbuffer[1]
				EndIf
			Next
		EndFunc

		Func getexperience()
			Local $loffset[4] = [0, 24, 44, 1856]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getareavanquished()
			If getfoestokill() = 0 Then
				Return True
			Else
				Return False
			EndIf
		EndFunc

		Func getfoeskilled()
			Local $loffset[4] = [0, 24, 44, 2124]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getfoestokill()
			Local $loffset[4] = [0, 24, 44, 2128]
			Local $lreturn = memoryreadptr($mbasepointer, $loffset)
			Return $lreturn[1]
		EndFunc

		Func getmaxagents()
			Return memoryread($mmaxagents)
		EndFunc

		Func getmyid()
			Return memoryread($mmyid)
		EndFunc

		Func getcurrenttarget()
			Return getagentbyid(getcurrenttargetid())
		EndFunc

		Func getcurrenttargetid()
			Return memoryread($mcurrenttarget)
		EndFunc

		Func getping()
			Return memoryread($mping)
		EndFunc

		Func getmapid()
			Return memoryread($mmapid)
		EndFunc

		Func getmaploading()
			Return memoryread($mmaploading)
		EndFunc

		Func getmapisloaded()
			Return memoryread($mmapisloaded) AND getagentexists(-2)
		EndFunc

		Func getdistrict()
			Local $loffset[4] = [0, 24, 68, 436]
			Local $lresult = memoryreadptr($mbasepointer, $loffset)
			Return $lresult[1]
		EndFunc

		Func getregion()
			Return memoryread($mregion)
		EndFunc

		Func getlanguage()
			Return memoryread($mlanguage)
		EndFunc

		Func waitmaploading($amapid = 0, $adeadlock = 15000)
			Local $lmaploading
			Local $ldeadlock = TimerInit()
			initmapload()
			Do
				Sleep(200)
				$lmaploading = getmaploading()
				If $lmaploading == 2 Then $ldeadlock = TimerInit()
				If TimerDiff($ldeadlock) > $adeadlock AND $adeadlock > 0 Then Return False
			Until $lmaploading <> 2 AND getmapisloaded() AND (getmapid() = $amapid OR $amapid = 0)
			rndsleep(5000)
			Return True
		EndFunc

		Func getquestbyid($aquestid = 0)
			Local $lqueststruct = DllStructCreate("long id;long LogState;byte unknown1[12];long MapFrom;float X;float Y;byte unknown2[8];long MapTo")
			Local $lquestptr, $lquestlogsize, $lquestid
			Local $loffset[4] = [0, 24, 44, 1332]
			$lquestlogsize = memoryreadptr($mbasepointer, $loffset)
			If $aquestid = 0 Then
				$loffset[1] = 24
				$loffset[2] = 44
				$loffset[3] = 1320
				$lquestid = memoryreadptr($mbasepointer, $loffset)
				$lquestid = $lquestid[1]
			Else
				$lquestid = $aquestid
			EndIf
			Local $loffset[5] = [0, 24, 44, 1324, 0]
			For $i = 0 To $lquestlogsize[1]
				$loffset[4] = 52 * $i
				$lquestptr = memoryreadptr($mbasepointer, $loffset)
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $lquestptr[0], "ptr", DllStructGetPtr($lqueststruct), "int", DllStructGetSize($lqueststruct), "int", "")
				If DllStructGetData($lqueststruct, "ID") = $lquestid Then Return $lqueststruct
			Next
		EndFunc

		Func getcharname()
			Return memoryread($mcharname, "wchar[30]")
		EndFunc

		Func getloggedin()
			Return memoryread($mloggedin)
		EndFunc

		Func getdisplaylanguage()
			Local $loffset[6] = [0, 24, 24, 404, 76, 64]
			Local $lresult = memoryreadptr($mbasepointer, $loffset)
			Return $lresult[1]
		EndFunc

		Func getinstanceuptime()
			Local $loffset[4]
			$loffset[0] = 0
			$loffset[1] = 24
			$loffset[2] = 8
			$loffset[3] = 428
			Local $ltimer = memoryreadptr($mbasepointer, $loffset)
			Return $ltimer[1]
		EndFunc

		Func getbuildnumber()
			Return $mbuildnumber
		EndFunc

		Func getprofprimaryattribute($aprofession)
			Switch $aprofession
				Case 1
					Return 17
				Case 2
					Return 23
				Case 3
					Return 16
				Case 4
					Return 6
				Case 5
					Return 0
				Case 6
					Return 12
				Case 7
					Return 35
				Case 8
					Return 36
				Case 9
					Return 40
				Case 10
					Return 44
			EndSwitch
		EndFunc

	#EndRegion Misc
#EndRegion Queries
#Region Other Functions
	#Region Misc

		Func rndsleep($aamount, $arandom = 0.05)
			Local $lrandom = $aamount * $arandom
			Sleep(Random($aamount - $lrandom, $aamount + $lrandom))
		EndFunc

		Func tolsleep($aamount = 150, $atolerance = 50)
			Sleep(Random($aamount - $atolerance, $aamount + $atolerance))
		EndFunc

		Func getwindowhandle()
			Return $mgwhwnd
		EndFunc

		Func computedistance($ax1, $ay1, $ax2, $ay2)
			Return Sqrt(($ax1 - $ax2) ^ 2 + ($ay1 - $ay2) ^ 2)
		EndFunc

		Func getdistance($aagent1 = -1, $aagent2 = -2)
			If IsDllStruct($aagent1) = 0 Then $aagent1 = getagentbyid($aagent1)
			If IsDllStruct($aagent2) = 0 Then $aagent2 = getagentbyid($aagent2)
			Return Sqrt((DllStructGetData($aagent1, "X") - DllStructGetData($aagent2, "X")) ^ 2 + (DllStructGetData($aagent1, "Y") - DllStructGetData($aagent2, "Y")) ^ 2)
		EndFunc

		Func getpseudodistance($aagent1, $aagent2)
			Return (DllStructGetData($aagent1, "X") - DllStructGetData($aagent2, "X")) ^ 2 + (DllStructGetData($aagent1, "Y") - DllStructGetData($aagent2, "Y")) ^ 2
		EndFunc

		Func getispointinpolygon($aareacoords, $aposx = 0, $aposy = 0)
			Local $lposition
			Local $ledges = UBound($aareacoords)
			Local $loddnodes = False
			If $ledges < 3 Then Return False
			If $aposx = 0 Then
				Local $lagent = getagentbyid(-2)
				$aposx = DllStructGetData($lagent, "X")
				$aposy = DllStructGetData($lagent, "Y")
			EndIf
			$j = $ledges - 1
			For $i = 0 To $ledges - 1
				If (($aareacoords[$i][1] < $aposy AND $aareacoords[$j][1] >= $aposy) OR ($aareacoords[$j][1] < $aposy AND $aareacoords[$i][1] >= $aposy)) AND ($aareacoords[$i][0] <= $aposx OR $aareacoords[$j][0] <= $aposx) Then
					If ($aareacoords[$i][0] + ($aposy - $aareacoords[$i][1]) / ($aareacoords[$j][1] - $aareacoords[$i][1]) * ($aareacoords[$j][0] - $aareacoords[$i][0]) < $aposx) Then
						$loddnodes = NOT $loddnodes
					EndIf
				EndIf
				$j = $i
			Next
			Return $loddnodes
		EndFunc

		Func convertid($aid)
			If $aid = -2 Then
				Return getmyid()
			ElseIf $aid = -1 Then
				Return getcurrenttargetid()
			Else
				Return $aid
			EndIf
		EndFunc

		Func sendpacket($asize, $aheader, $aparam1 = 0, $aparam2 = 0, $aparam3 = 0, $aparam4 = 0, $aparam5 = 0, $aparam6 = 0, $aparam7 = 0, $aparam8 = 0, $aparam9 = 0, $aparam10 = 0)
			If getagentexists(-2) Then
				DllStructSetData($mpacket, 2, $asize)
				DllStructSetData($mpacket, 3, $aheader + 1)
				DllStructSetData($mpacket, 4, $aparam1)
				DllStructSetData($mpacket, 5, $aparam2)
				DllStructSetData($mpacket, 6, $aparam3)
				DllStructSetData($mpacket, 7, $aparam4)
				DllStructSetData($mpacket, 8, $aparam5)
				DllStructSetData($mpacket, 9, $aparam6)
				DllStructSetData($mpacket, 10, $aparam7)
				DllStructSetData($mpacket, 11, $aparam8)
				DllStructSetData($mpacket, 12, $aparam9)
				DllStructSetData($mpacket, 13, $aparam10)
				enqueue($mpacketptr, 52)
				Return True
			Else
				Return False
			EndIf
		EndFunc

		Func performaction($aaction, $aflag)
			If getagentexists(-2) Then
				DllStructSetData($maction, 2, $aaction)
				DllStructSetData($maction, 3, $aflag)
				enqueue($mactionptr, 12)
				Return True
			Else
				Return False
			EndIf
		EndFunc

		Func bin64todec($abinary)
			Local $lreturn = 0
			For $i = 1 To StringLen($abinary)
				If StringMid($abinary, $i, 1) == 1 Then $lreturn += 2 ^ ($i - 1)
			Next
			Return $lreturn
		EndFunc

		Func base64tobin64($acharacter)
			Select
				Case $acharacter == "A"
					Return "000000"
				Case $acharacter == "B"
					Return "100000"
				Case $acharacter == "C"
					Return "010000"
				Case $acharacter == "D"
					Return "110000"
				Case $acharacter == "E"
					Return "001000"
				Case $acharacter == "F"
					Return "101000"
				Case $acharacter == "G"
					Return "011000"
				Case $acharacter == "H"
					Return "111000"
				Case $acharacter == "I"
					Return "000100"
				Case $acharacter == "J"
					Return "100100"
				Case $acharacter == "K"
					Return "010100"
				Case $acharacter == "L"
					Return "110100"
				Case $acharacter == "M"
					Return "001100"
				Case $acharacter == "N"
					Return "101100"
				Case $acharacter == "O"
					Return "011100"
				Case $acharacter == "P"
					Return "111100"
				Case $acharacter == "Q"
					Return "000010"
				Case $acharacter == "R"
					Return "100010"
				Case $acharacter == "S"
					Return "010010"
				Case $acharacter == "T"
					Return "110010"
				Case $acharacter == "U"
					Return "001010"
				Case $acharacter == "V"
					Return "101010"
				Case $acharacter == "W"
					Return "011010"
				Case $acharacter == "X"
					Return "111010"
				Case $acharacter == "Y"
					Return "000110"
				Case $acharacter == "Z"
					Return "100110"
				Case $acharacter == "a"
					Return "010110"
				Case $acharacter == "b"
					Return "110110"
				Case $acharacter == "c"
					Return "001110"
				Case $acharacter == "d"
					Return "101110"
				Case $acharacter == "e"
					Return "011110"
				Case $acharacter == "f"
					Return "111110"
				Case $acharacter == "g"
					Return "000001"
				Case $acharacter == "h"
					Return "100001"
				Case $acharacter == "i"
					Return "010001"
				Case $acharacter == "j"
					Return "110001"
				Case $acharacter == "k"
					Return "001001"
				Case $acharacter == "l"
					Return "101001"
				Case $acharacter == "m"
					Return "011001"
				Case $acharacter == "n"
					Return "111001"
				Case $acharacter == "o"
					Return "000101"
				Case $acharacter == "p"
					Return "100101"
				Case $acharacter == "q"
					Return "010101"
				Case $acharacter == "r"
					Return "110101"
				Case $acharacter == "s"
					Return "001101"
				Case $acharacter == "t"
					Return "101101"
				Case $acharacter == "u"
					Return "011101"
				Case $acharacter == "v"
					Return "111101"
				Case $acharacter == "w"
					Return "000011"
				Case $acharacter == "x"
					Return "100011"
				Case $acharacter == "y"
					Return "010011"
				Case $acharacter == "z"
					Return "110011"
				Case $acharacter == "0"
					Return "001011"
				Case $acharacter == "1"
					Return "101011"
				Case $acharacter == "2"
					Return "011011"
				Case $acharacter == "3"
					Return "111011"
				Case $acharacter == "4"
					Return "000111"
				Case $acharacter == "5"
					Return "100111"
				Case $acharacter == "6"
					Return "010111"
				Case $acharacter == "7"
					Return "110111"
				Case $acharacter == "8"
					Return "001111"
				Case $acharacter == "9"
					Return "101111"
				Case $acharacter == "+"
					Return "011111"
				Case $acharacter == "/"
					Return "111111"
			EndSelect
		EndFunc

	#EndRegion Misc
	#Region Callback

		Func setevent($askillactivate = "", $askillcancel = "", $askillcomplete = "", $achatreceive = "", $aloadfinished = "")
			If NOT $museeventsystem Then Return
			If $askillactivate <> "" Then
				writedetour("SkillLogStart", "SkillLogProc")
			Else
				$masmstring = ""
				_("inc eax")
				_("mov dword[esi+10],eax")
				_("pop esi")
				writebinary($masmstring, getvalue("SkillLogStart"))
			EndIf
			If $askillcancel <> "" Then
				writedetour("SkillCancelLogStart", "SkillCancelLogProc")
			Else
				$masmstring = ""
				_("push 0")
				_("push 42")
				_("mov ecx,esi")
				writebinary($masmstring, getvalue("SkillCancelLogStart"))
			EndIf
			If $askillcomplete <> "" Then
				writedetour("SkillCompleteLogStart", "SkillCompleteLogProc")
			Else
				$masmstring = ""
				_("mov eax,dword[edi+4]")
				_("test eax,eax")
				writebinary($masmstring, getvalue("SkillCompleteLogStart"))
			EndIf
			If $achatreceive <> "" Then
				writedetour("ChatLogStart", "ChatLogProc")
			Else
				$masmstring = ""
				_("add edi,E")
				_("cmp eax,B")
				writebinary($masmstring, getvalue("ChatLogStart"))
			EndIf
			$mskillactivate = $askillactivate
			$mskillcancel = $askillcancel
			$mskillcomplete = $askillcomplete
			$mchatreceive = $achatreceive
			$mloadfinished = $aloadfinished
		EndFunc

		Func event($hwnd, $msg, $wparam, $lparam)
			Switch $lparam
				Case 1
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $wparam, "ptr", $mskilllogstructptr, "int", 16, "int", "")
					Call($mskillactivate, DllStructGetData($mskilllogstruct, 1), DllStructGetData($mskilllogstruct, 2), DllStructGetData($mskilllogstruct, 3), DllStructGetData($mskilllogstruct, 4))
				Case 2
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $wparam, "ptr", $mskilllogstructptr, "int", 16, "int", "")
					Call($mskillcancel, DllStructGetData($mskilllogstruct, 1), DllStructGetData($mskilllogstruct, 2), DllStructGetData($mskilllogstruct, 3))
				Case 3
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $wparam, "ptr", $mskilllogstructptr, "int", 16, "int", "")
					Call($mskillcomplete, DllStructGetData($mskilllogstruct, 1), DllStructGetData($mskilllogstruct, 2), DllStructGetData($mskilllogstruct, 3))
				Case 4
					DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $wparam, "ptr", $mchatlogstructptr, "int", 512, "int", "")
					Local $lmessage = DllStructGetData($mchatlogstruct, 2)
					Local $lchannel
					Local $lsender
					Switch DllStructGetData($mchatlogstruct, 1)
						Case 0
							$lchannel = "Alliance"
							$lsender = StringMid($lmessage, 6, StringInStr($lmessage, "</a>") - 6)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 3
							$lchannel = "All"
							$lsender = StringMid($lmessage, 6, StringInStr($lmessage, "</a>") - 6)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 9
							$lchannel = "Guild"
							$lsender = StringMid($lmessage, 6, StringInStr($lmessage, "</a>") - 6)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 11
							$lchannel = "Team"
							$lsender = StringMid($lmessage, 6, StringInStr($lmessage, "</a>") - 6)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 12
							$lchannel = "Trade"
							$lsender = StringMid($lmessage, 6, StringInStr($lmessage, "</a>") - 6)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 10
							If StringLeft($lmessage, 3) == "-> " Then
								$lchannel = "Sent"
								$lsender = StringMid($lmessage, 10, StringInStr($lmessage, "</a>") - 10)
								$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
							Else
								$lchannel = "Global"
								$lsender = "Guild Wars"
							EndIf
						Case 13
							$lchannel = "Advisory"
							$lsender = "Guild Wars"
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case 14
							$lchannel = "Whisper"
							$lsender = StringMid($lmessage, 7, StringInStr($lmessage, "</a>") - 7)
							$lmessage = StringTrimLeft($lmessage, StringInStr($lmessage, "<quote>") + 6)
						Case Else
							$lchannel = "Other"
							$lsender = "Other"
					EndSwitch
					Call($mchatreceive, $lchannel, $lsender, $lmessage)
				Case 5
					Call($mloadfinished)
			EndSwitch
		EndFunc

	#EndRegion Callback
	#Region Modification

		Func modifymemory()
			$masmsize = 0
			$masmcodeoffset = 0
			$masmstring = ""
			createdata()
			createmain()
			createtargetlog()
			createskilllog()
			createskillcancellog()
			createskillcompletelog()
			createchatlog()
			createtraderhook()
			createloadfinished()
			createstringlog()
			createstringfilter1()
			createstringfilter2()
			createrenderingmod()
			createcommands()
			Local $lmodmemory = memoryread(memoryread($mbase), "ptr")
			If $lmodmemory = 0 Then
				$mmemory = DllCall($mkernelhandle, "ptr", "VirtualAllocEx", "handle", $mgwprochandle, "ptr", 0, "ulong_ptr", $masmsize, "dword", 4096, "dword", 64)
				$mmemory = $mmemory[0]
				memorywrite(memoryread($mbase), $mmemory)
			Else
				$mmemory = $lmodmemory
			EndIf
			completeasmcode()
			If $lmodmemory = 0 Then
				writebinary($masmstring, $mmemory + $masmcodeoffset)
				writebinary("83F8009090", getvalue("ClickToMoveFix"))
				memorywrite(getvalue("QueuePtr"), getvalue("QueueBase"))
				memorywrite(getvalue("SkillLogPtr"), getvalue("SkillLogBase"))
				memorywrite(getvalue("ChatLogPtr"), getvalue("ChatLogBase"))
				memorywrite(getvalue("StringLogPtr"), getvalue("StringLogBase"))
			EndIf
			writedetour("MainStart", "MainProc")
			writedetour("TargetLogStart", "TargetLogProc")
			writedetour("TraderHookStart", "TraderHookProc")
			writedetour("LoadFinishedStart", "LoadFinishedProc")
			writedetour("RenderingMod", "RenderingModProc")
			If $musestringlog Then
				writedetour("StringLogStart", "StringLogProc")
				writedetour("StringFilter1Start", "StringFilter1Proc")
				writedetour("StringFilter2Start", "StringFilter2Proc")
			EndIf
		EndFunc

		Func writedetour($afrom, $ato)
			writebinary("E9" & swapendian(Hex(getlabelinfo($ato) - getlabelinfo($afrom) - 5)), getlabelinfo($afrom))
		EndFunc

		Func createdata()
			_("CallbackHandle/4")
			_("QueueCounter/4")
			_("SkillLogCounter/4")
			_("ChatLogCounter/4")
			_("ChatLogLastMsg/4")
			_("MapIsLoaded/4")
			_("NextStringType/4")
			_("EnsureEnglish/4")
			_("TraderQuoteID/4")
			_("TraderCostID/4")
			_("TraderCostValue/4")
			_("DisableRendering/4")
			_("QueueBase/" & 256 * getvalue("QueueSize"))
			_("TargetLogBase/" & 4 * getvalue("TargetLogSize"))
			_("SkillLogBase/" & 16 * getvalue("SkillLogSize"))
			_("StringLogBase/" & 256 * getvalue("StringLogSize"))
			_("ChatLogBase/" & 512 * getvalue("ChatLogSize"))
			_("AgentCopyCount/4")
			_("AgentCopyBase/" & 448 * 256)
		EndFunc

		Func createmain()
			_("MainProc:")
			_("pushad")
			_("mov eax,dword[EnsureEnglish]")
			_("test eax,eax")
			_("jz MainMain")
			_("mov ecx,dword[BasePointer]")
			_("mov ecx,dword[ecx+18]")
			_("mov ecx,dword[ecx+18]")
			_("mov ecx,dword[ecx+194]")
			_("mov al,byte[ecx+4f]")
			_("cmp al,f")
			_("ja MainMain")
			_("mov ecx,dword[ecx+4c]")
			_("mov al,byte[ecx+3f]")
			_("cmp al,f")
			_("ja MainMain")
			_("mov eax,dword[ecx+40]")
			_("test eax,eax")
			_("jz MainMain")
			_("mov ecx,dword[ActionBase]")
			_("mov ecx,dword[ecx+170]")
			_("mov ecx,dword[ecx+20]")
			_("mov ecx,dword[ecx]")
			_("push 0")
			_("push 0")
			_("push bb")
			_("mov edx,esp")
			_("push 0")
			_("push edx")
			_("push 18")
			_("call ActionFunction")
			_("pop eax")
			_("pop ebx")
			_("pop ecx")
			_("MainMain:")
			_("mov eax,dword[QueueCounter]")
			_("mov ecx,eax")
			_("shl eax,8")
			_("add eax,QueueBase")
			_("mov ebx,dword[eax]")
			_("test ebx,ebx")
			_("jz MainExit")
			_("push ecx")
			_("mov dword[eax],0")
			_("jmp ebx")
			_("CommandReturn:")
			_("pop eax")
			_("inc eax")
			_("cmp eax,QueueSize")
			_("jnz MainSkipReset")
			_("xor eax,eax")
			_("MainSkipReset:")
			_("mov dword[QueueCounter],eax")
			_("MainExit:")
			_("popad")
			_("mov ebp,esp")
			_("sub esp,14")
			_("ljmp MainReturn")
		EndFunc

		Func createtargetlog()
			_("TargetLogProc:")
			_("cmp ecx,4")
			_("jz TargetLogMain")
			_("cmp ecx,32")
			_("jz TargetLogMain")
			_("cmp ecx,3C")
			_("jz TargetLogMain")
			_("jmp TargetLogExit")
			_("TargetLogMain:")
			_("pushad")
			_("mov ecx,dword[ebp+8]")
			_("test ecx,ecx")
			_("jnz TargetLogStore")
			_("mov ecx,edx")
			_("TargetLogStore:")
			_("lea eax,dword[edx*4+TargetLogBase]")
			_("mov dword[eax],ecx")
			_("popad")
			_("TargetLogExit:")
			_("push ebx")
			_("push esi")
			_("push edi")
			_("mov edi,edx")
			_("ljmp TargetLogReturn")
		EndFunc

		Func createskilllog()
			_("SkillLogProc:")
			_("pushad")
			_("mov eax,dword[SkillLogCounter]")
			_("push eax")
			_("shl eax,4")
			_("add eax,SkillLogBase")
			_("mov ecx,dword[edi]")
			_("mov dword[eax],ecx")
			_("mov ecx,dword[ecx*4+TargetLogBase]")
			_("mov dword[eax+4],ecx")
			_("mov ecx,dword[edi+4]")
			_("mov dword[eax+8],ecx")
			_("mov ecx,dword[edi+8]")
			_("mov dword[eax+c],ecx")
			_("push 1")
			_("push eax")
			_("push CallbackEvent")
			_("push dword[CallbackHandle]")
			_("call dword[PostMessage]")
			_("pop eax")
			_("inc eax")
			_("cmp eax,SkillLogSize")
			_("jnz SkillLogSkipReset")
			_("xor eax,eax")
			_("SkillLogSkipReset:")
			_("mov dword[SkillLogCounter],eax")
			_("popad")
			_("inc eax")
			_("mov dword[esi+10],eax")
			_("pop esi")
			_("ljmp SkillLogReturn")
		EndFunc

		Func createskillcancellog()
			_("SkillCancelLogProc:")
			_("pushad")
			_("mov eax,dword[SkillLogCounter]")
			_("push eax")
			_("shl eax,4")
			_("add eax,SkillLogBase")
			_("mov ecx,dword[edi]")
			_("mov dword[eax],ecx")
			_("mov ecx,dword[ecx*4+TargetLogBase]")
			_("mov dword[eax+4],ecx")
			_("mov ecx,dword[edi+4]")
			_("mov dword[eax+8],ecx")
			_("push 2")
			_("push eax")
			_("push CallbackEvent")
			_("push dword[CallbackHandle]")
			_("call dword[PostMessage]")
			_("pop eax")
			_("inc eax")
			_("cmp eax,SkillLogSize")
			_("jnz SkillCancelLogSkipReset")
			_("xor eax,eax")
			_("SkillCancelLogSkipReset:")
			_("mov dword[SkillLogCounter],eax")
			_("popad")
			_("push 0")
			_("push 42")
			_("mov ecx,esi")
			_("ljmp SkillCancelLogReturn")
		EndFunc

		Func createskillcompletelog()
			_("SkillCompleteLogProc:")
			_("pushad")
			_("mov eax,dword[SkillLogCounter]")
			_("push eax")
			_("shl eax,4")
			_("add eax,SkillLogBase")
			_("mov ecx,dword[edi]")
			_("mov dword[eax],ecx")
			_("mov ecx,dword[ecx*4+TargetLogBase]")
			_("mov dword[eax+4],ecx")
			_("mov ecx,dword[edi+4]")
			_("mov dword[eax+8],ecx")
			_("push 3")
			_("push eax")
			_("push CallbackEvent")
			_("push dword[CallbackHandle]")
			_("call dword[PostMessage]")
			_("pop eax")
			_("inc eax")
			_("cmp eax,SkillLogSize")
			_("jnz SkillCompleteLogSkipReset")
			_("xor eax,eax")
			_("SkillCompleteLogSkipReset:")
			_("mov dword[SkillLogCounter],eax")
			_("popad")
			_("mov eax,dword[edi+4]")
			_("test eax,eax")
			_("ljmp SkillCompleteLogReturn")
		EndFunc

		Func createchatlog()
			_("ChatLogProc:")
			_("pushad")
			_("mov ecx,dword[esp+1F4]")
			_("mov ebx,eax")
			_("mov eax,dword[ChatLogCounter]")
			_("push eax")
			_("shl eax,9")
			_("add eax,ChatLogBase")
			_("mov dword[eax],ebx")
			_("mov edi,eax")
			_("add eax,4")
			_("xor ebx,ebx")
			_("ChatLogCopyLoop:")
			_("mov dx,word[ecx]")
			_("mov word[eax],dx")
			_("add ecx,2")
			_("add eax,2")
			_("inc ebx")
			_("cmp ebx,FF")
			_("jz ChatLogCopyExit")
			_("test dx,dx")
			_("jnz ChatLogCopyLoop")
			_("ChatLogCopyExit:")
			_("push 4")
			_("push edi")
			_("push CallbackEvent")
			_("push dword[CallbackHandle]")
			_("call dword[PostMessage]")
			_("pop eax")
			_("inc eax")
			_("cmp eax,ChatLogSize")
			_("jnz ChatLogSkipReset")
			_("xor eax,eax")
			_("ChatLogSkipReset:")
			_("mov dword[ChatLogCounter],eax")
			_("popad")
			_("ChatLogExit:")
			_("add edi,E")
			_("cmp eax,B")
			_("ljmp ChatLogReturn")
		EndFunc

		Func createtraderhook()
			_("TraderHookProc:")
			_("mov dword[TraderCostID],ecx")
			_("mov dword[TraderCostValue],edx")
			_("push eax")
			_("mov eax,dword[TraderQuoteID]")
			_("inc eax")
			_("cmp eax,200")
			_("jnz TraderSkipReset")
			_("xor eax,eax")
			_("TraderSkipReset:")
			_("mov dword[TraderQuoteID],eax")
			_("pop eax")
			_("mov ebp,esp")
			_("sub esp,8")
			_("ljmp TraderHookReturn")
		EndFunc

		Func createloadfinished()
			_("LoadFinishedProc:")
			_("pushad")
			_("mov eax,1")
			_("mov dword[MapIsLoaded],eax")
			_("xor ebx,ebx")
			_("mov eax,StringLogBase")
			_("LoadClearStringsLoop:")
			_("mov dword[eax],0")
			_("inc ebx")
			_("add eax,100")
			_("cmp ebx,StringLogSize")
			_("jnz LoadClearStringsLoop")
			_("xor ebx,ebx")
			_("mov eax,TargetLogBase")
			_("LoadClearTargetsLoop:")
			_("mov dword[eax],0")
			_("inc ebx")
			_("add eax,4")
			_("cmp ebx,TargetLogSize")
			_("jnz LoadClearTargetsLoop")
			_("push 5")
			_("push 0")
			_("push CallbackEvent")
			_("push dword[CallbackHandle]")
			_("call dword[PostMessage]")
			_("popad")
			_("mov edx,dword[esi+1C]")
			_("mov ecx,edi")
			_("ljmp LoadFinishedReturn")
		EndFunc

		Func createstringlog()
			_("StringLogProc:")
			_("pushad")
			_("mov eax,dword[NextStringType]")
			_("test eax,eax")
			_("jz StringLogExit")
			_("cmp eax,1")
			_("jnz StringLogFilter2")
			_("mov eax,dword[ebp+37c]")
			_("jmp StringLogRangeCheck")
			_("StringLogFilter2:")
			_("cmp eax,2")
			_("jnz StringLogExit")
			_("mov eax,dword[ebp+338]")
			_("StringLogRangeCheck:")
			_("mov dword[NextStringType],0")
			_("cmp eax,0")
			_("jbe StringLogExit")
			_("cmp eax,StringLogSize")
			_("jae StringLogExit")
			_("shl eax,8")
			_("add eax,StringLogBase")
			_("xor ebx,ebx")
			_("StringLogCopyLoop:")
			_("mov dx,word[ecx]")
			_("mov word[eax],dx")
			_("add ecx,2")
			_("add eax,2")
			_("inc ebx")
			_("cmp ebx,80")
			_("jz StringLogExit")
			_("test dx,dx")
			_("jnz StringLogCopyLoop")
			_("StringLogExit:")
			_("popad")
			_("mov esp,ebp")
			_("pop ebp")
			_("retn 10")
		EndFunc

		Func createstringfilter1()
			_("StringFilter1Proc:")
			_("mov dword[NextStringType],1")
			_("push ebp")
			_("mov ebp,esp")
			_("push ecx")
			_("push esi")
			_("ljmp StringFilter1Return")
		EndFunc

		Func createstringfilter2()
			_("StringFilter2Proc:")
			_("mov dword[NextStringType],2")
			_("push ebp")
			_("mov ebp,esp")
			_("push ecx")
			_("push esi")
			_("ljmp StringFilter2Return")
		EndFunc

		Func createrenderingmod()
			_("RenderingModProc:")
			_("cmp dword[DisableRendering],1")
			_("jz RenderingModSkipCompare")
			_("cmp eax,ebx")
			_("ljne RenderingModReturn")
			_("RenderingModSkipCompare:")
			$masmsize += 17
			$masmstring &= StringTrimLeft(memoryread(getvalue("RenderingMod") + 4, "byte[17]"), 2)
			_("cmp dword[DisableRendering],1")
			_("jz DisableRenderingProc")
			_("retn")
			_("DisableRenderingProc:")
			_("push 1")
			_("call dword[Sleep]")
			_("retn")
		EndFunc

		Func createcommands()
			_("CommandUseSkill:")
			_("mov ecx,dword[MyID]")
			_("mov edx,dword[eax+C]")
			_("push edx")
			_("mov edx,dword[eax+4]")
			_("dec edx")
			_("push dword[eax+8]")
			_("call UseSkillFunction")
			_("ljmp CommandReturn")
			_("CommandMove:")
			_("lea ecx,dword[eax+4]")
			_("call MoveFunction")
			_("ljmp CommandReturn")
			_("CommandChangeTarget:")
			_("mov ecx,dword[eax+4]")
			_("xor edx,edx")
			_("call ChangeTargetFunction")
			_("ljmp CommandReturn")
			_("CommandPacketSend:")
			_("mov ecx,dword[PacketLocation]")
			_("lea edx,dword[eax+8]")
			_("push edx")
			_("mov edx,dword[eax+4]")
			_("mov eax,ecx")
			_("call PacketSendFunction")
			_("ljmp CommandReturn")
			_("CommandWriteChat:")
			_("add eax,4")
			_("mov edx,eax")
			_("xor ecx,ecx")
			_("add eax,28")
			_("push eax")
			_("call WriteChatFunction")
			_("ljmp CommandReturn")
			_("CommandSellItem:")
			_("push 0")
			_("push 0")
			_("push 0")
			_("push dword[eax+4]")
			_("push 0")
			_("add eax,8")
			_("push eax")
			_("push 1")
			_("mov ecx,b")
			_("xor edx,edx")
			_("call SellItemFunction")
			_("ljmp CommandReturn")
			_("CommandBuyItem:")
			_("add eax,4")
			_("push eax")
			_("add eax,4")
			_("push eax")
			_("push 1")
			_("push 0")
			_("push 0")
			_("push 0")
			_("push 0")
			_("mov ecx,1")
			_("mov edx,dword[eax+4]")
			_("call BuyItemFunction")
			_("ljmp CommandReturn")
			_("CommandAction:")
			_("mov ecx,dword[ActionBase]")
			_("mov ecx,dword[ecx+250]")
			_("mov ecx,dword[ecx+10]")
			_("mov ecx,dword[ecx]")
			_("push 0")
			_("push 0")
			_("push dword[eax+4]")
			_("mov edx,esp")
			_("push 0")
			_("push edx")
			_("push dword[eax+8]")
			_("call ActionFunction")
			_("pop eax")
			_("pop ebx")
			_("pop ecx")
			_("ljmp CommandReturn")
			_("CommandToggleLanguage:")
			_("mov ecx,dword[ActionBase]")
			_("mov ecx,dword[ecx+170]")
			_("mov ecx,dword[ecx+20]")
			_("mov ecx,dword[ecx]")
			_("push 0")
			_("push 0")
			_("push bb")
			_("mov edx,esp")
			_("push 0")
			_("push edx")
			_("push dword[eax+4]")
			_("call ActionFunction")
			_("pop eax")
			_("pop ebx")
			_("pop ecx")
			_("ljmp CommandReturn")
			_("CommandUseHeroSkill:")
			_("mov ecx,dword[eax+4]")
			_("mov edx,dword[eax+c]")
			_("mov eax,dword[eax+8]")
			_("push eax")
			_("call UseHeroSkillFunction")
			_("ljmp CommandReturn")
			_("CommandSendChat:")
			_("mov ecx,dword[PacketLocation]")
			_("add eax,4")
			_("push eax")
			_("mov edx,11c")
			_("mov eax,ecx")
			_("call PacketSendFunction")
			_("ljmp CommandReturn")
			_("CommandRequestQuote:")
			_("mov dword[TraderCostID],0")
			_("mov dword[TraderCostValue],0")
			_("add eax,4")
			_("push eax")
			_("push 1")
			_("push 0")
			_("push 0")
			_("push 0")
			_("push 0")
			_("mov ecx,c")
			_("xor edx,edx")
			_("call RequestQuoteFunction")
			_("ljmp CommandReturn")
			_("CommandRequestQuoteSell:")
			_("mov dword[TraderCostID],0")
			_("mov dword[TraderCostValue],0")
			_("push 0")
			_("push 0")
			_("push 0")
			_("add eax,4")
			_("push eax")
			_("push 1")
			_("push 0")
			_("mov ecx,d")
			_("xor edx,edx")
			_("call RequestQuoteFunction")
			_("ljmp CommandReturn")
			_("CommandTraderBuy:")
			_("push 0")
			_("push TraderCostID")
			_("push 1")
			_("push 0")
			_("push 0")
			_("push 0")
			_("push 0")
			_("mov ecx,c")
			_("mov edx,dword[TraderCostValue]")
			_("call TraderFunction")
			_("mov dword[TraderCostID],0")
			_("mov dword[TraderCostValue],0")
			_("ljmp CommandReturn")
			_("CommandTraderSell:")
			_("push 0")
			_("push 0")
			_("push 0")
			_("push dword[TraderCostValue]")
			_("push 0")
			_("push TraderCostID")
			_("push 1")
			_("mov ecx,d")
			_("xor edx,edx")
			_("call TraderFunction")
			_("mov dword[TraderCostID],0")
			_("mov dword[TraderCostValue],0")
			_("ljmp CommandReturn")
			_("CommandSalvage:")
			_("mov ebx,SalvageGlobal")
			_("mov ecx,dword[eax+4]")
			_("mov dword[ebx],ecx")
			_("push ecx")
			_("mov ecx,dword[eax+8]")
			_("add ebx,4")
			_("mov dword[ebx],ecx")
			_("mov edx,dword[eax+c]")
			_("mov dword[ebx],ecx")
			_("call SalvageFunction")
			_("ljmp CommandReturn")
			_("CommandIncreaseAttribute:")
			_("mov edx,dword[eax+4]")
			_("mov ecx,dword[eax+8]")
			_("call IncreaseAttributeFunction")
			_("ljmp CommandReturn")
			_("CommandDecreaseAttribute:")
			_("mov edx,dword[eax+4]")
			_("mov ecx,dword[eax+8]")
			_("call DecreaseAttributeFunction")
			_("ljmp CommandReturn")
			_("CommandMakeAgentArray:")
			_("mov eax,dword[eax+4]")
			_("xor ebx,ebx")
			_("xor edx,edx")
			_("mov edi,AgentCopyBase")
			_("AgentCopyLoopStart:")
			_("inc ebx")
			_("cmp ebx,dword[MaxAgents]")
			_("jge AgentCopyLoopExit")
			_("mov esi,dword[AgentBase]")
			_("lea esi,dword[esi+ebx*4]")
			_("mov esi,dword[esi]")
			_("test esi,esi")
			_("jz AgentCopyLoopStart")
			_("cmp eax,0")
			_("jz CopyAgent")
			_("cmp eax,dword[esi+9C]")
			_("jnz AgentCopyLoopStart")
			_("CopyAgent:")
			_("mov ecx,1C0")
			_("clc")
			_("repe movsb")
			_("inc edx")
			_("jmp AgentCopyLoopStart")
			_("AgentCopyLoopExit:")
			_("mov dword[AgentCopyCount],edx")
			_("ljmp CommandReturn")
		EndFunc

	#EndRegion Modification
	#Region Assembler

		Func _($aasm)
			Local $lbuffer
			Select
				Case StringRight($aasm, 1) = ":"
					setvalue("Label_" & StringLeft($aasm, StringLen($aasm) - 1), $masmsize)
				Case StringInStr($aasm, "/") > 0
					setvalue("Label_" & StringLeft($aasm, StringInStr($aasm, "/") - 1), $masmsize)
					Local $loffset = StringRight($aasm, StringLen($aasm) - StringInStr($aasm, "/"))
					$masmsize += $loffset
					$masmcodeoffset += $loffset
				Case StringLeft($aasm, 5) = "nop x"
					$lbuffer = Int(Number(StringTrimLeft($aasm, 5)))
					$masmsize += $lbuffer
					For $i = 1 To $lbuffer
						$masmstring &= "90"
					Next
				Case StringLeft($aasm, 5) = "ljmp "
					$masmsize += 5
					$masmstring &= "E9{" & StringRight($aasm, StringLen($aasm) - 5) & "}"
				Case StringLeft($aasm, 5) = "ljne "
					$masmsize += 6
					$masmstring &= "0F85{" & StringRight($aasm, StringLen($aasm) - 5) & "}"
				Case StringLeft($aasm, 4) = "jmp " AND StringLen($aasm) > 7
					$masmsize += 2
					$masmstring &= "EB(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringLeft($aasm, 4) = "jae "
					$masmsize += 2
					$masmstring &= "73(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringLeft($aasm, 3) = "jz "
					$masmsize += 2
					$masmstring &= "74(" & StringRight($aasm, StringLen($aasm) - 3) & ")"
				Case StringLeft($aasm, 4) = "jnz "
					$masmsize += 2
					$masmstring &= "75(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringLeft($aasm, 4) = "jbe "
					$masmsize += 2
					$masmstring &= "76(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringLeft($aasm, 3) = "ja "
					$masmsize += 2
					$masmstring &= "77(" & StringRight($aasm, StringLen($aasm) - 3) & ")"
				Case StringLeft($aasm, 3) = "jl "
					$masmsize += 2
					$masmstring &= "7C(" & StringRight($aasm, StringLen($aasm) - 3) & ")"
				Case StringLeft($aasm, 4) = "jge "
					$masmsize += 2
					$masmstring &= "7D(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringLeft($aasm, 4) = "jle "
					$masmsize += 2
					$masmstring &= "7E(" & StringRight($aasm, StringLen($aasm) - 4) & ")"
				Case StringRegExp($aasm, "mov eax,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 5
					$masmstring &= "A1[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov ebx,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "8B1D[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov ecx,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "8B0D[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov edx,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "8B15[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov esi,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "8B35[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov edi,dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "8B3D[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "cmp ebx,dword\[[a-z,A-Z]{4,}\]")
					$masmsize += 6
					$masmstring &= "3B1D[" & StringMid($aasm, 15, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "lea eax,dword[[]ecx[*]8[+][a-z,A-Z]{4,}[]]")
					$masmsize += 7
					$masmstring &= "8D04CD[" & StringMid($aasm, 21, StringLen($aasm) - 21) & "]"
				Case StringRegExp($aasm, "lea edi,dword\[edx\+[a-z,A-Z]{4,}\]")
					$masmsize += 7
					$masmstring &= "8D3C15[" & StringMid($aasm, 19, StringLen($aasm) - 19) & "]"
				Case StringRegExp($aasm, "cmp dword[[][a-z,A-Z]{4,}[]],[-[:xdigit:]]")
					$lbuffer = StringInStr($aasm, ",")
					$lbuffer = asmnumber(StringMid($aasm, $lbuffer + 1), True)
					If @extended Then
						$masmsize += 7
						$masmstring &= "833D[" & StringMid($aasm, 11, StringInStr($aasm, ",") - 12) & "]" & $lbuffer
					Else
						$masmsize += 10
						$masmstring &= "813D[" & StringMid($aasm, 11, StringInStr($aasm, ",") - 12) & "]" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "cmp ecx,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 6
					$masmstring &= "81F9[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "cmp ebx,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 6
					$masmstring &= "81FB[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "cmp eax,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "3D[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "add eax,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "05[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov eax,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "B8[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov ebx,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "BB[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov esi,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "BE[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov edi,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "BF[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov edx,[a-z,A-Z]{4,}") AND StringInStr($aasm, ",dword") = 0
					$masmsize += 5
					$masmstring &= "BA[" & StringRight($aasm, StringLen($aasm) - 8) & "]"
				Case StringRegExp($aasm, "mov dword[[][a-z,A-Z]{4,}[]],ecx")
					$masmsize += 6
					$masmstring &= "890D[" & StringMid($aasm, 11, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "fstp dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "D91D[" & StringMid($aasm, 12, StringLen($aasm) - 12) & "]"
				Case StringRegExp($aasm, "mov dword[[][a-z,A-Z]{4,}[]],edx")
					$masmsize += 6
					$masmstring &= "8915[" & StringMid($aasm, 11, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "mov dword[[][a-z,A-Z]{4,}[]],eax")
					$masmsize += 5
					$masmstring &= "A3[" & StringMid($aasm, 11, StringLen($aasm) - 15) & "]"
				Case StringRegExp($aasm, "lea eax,dword[[]edx[*]4[+][a-z,A-Z]{4,}[]]")
					$masmsize += 7
					$masmstring &= "8D0495[" & StringMid($aasm, 21, StringLen($aasm) - 21) & "]"
				Case StringRegExp($aasm, "mov eax,dword[[]ecx[*]4[+][a-z,A-Z]{4,}[]]")
					$masmsize += 7
					$masmstring &= "8B048D[" & StringMid($aasm, 21, StringLen($aasm) - 21) & "]"
				Case StringRegExp($aasm, "mov ecx,dword[[]ecx[*]4[+][a-z,A-Z]{4,}[]]")
					$masmsize += 7
					$masmstring &= "8B0C8D[" & StringMid($aasm, 21, StringLen($aasm) - 21) & "]"
				Case StringRegExp($aasm, "push dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "FF35[" & StringMid($aasm, 12, StringLen($aasm) - 12) & "]"
				Case StringRegExp($aasm, "push [a-z,A-Z]{4,}\z")
					$masmsize += 5
					$masmstring &= "68[" & StringMid($aasm, 6, StringLen($aasm) - 5) & "]"
				Case StringRegExp($aasm, "call dword[[][a-z,A-Z]{4,}[]]")
					$masmsize += 6
					$masmstring &= "FF15[" & StringMid($aasm, 12, StringLen($aasm) - 12) & "]"
				Case StringLeft($aasm, 5) = "call " AND StringLen($aasm) > 8
					$masmsize += 5
					$masmstring &= "E8{" & StringMid($aasm, 6, StringLen($aasm) - 5) & "}"
				Case StringRegExp($aasm, "mov dword\[[a-z,A-Z]{4,}\],[-[:xdigit:]]{1,8}\z")
					$lbuffer = StringInStr($aasm, ",")
					$masmsize += 10
					$masmstring &= "C705[" & StringMid($aasm, 11, $lbuffer - 12) & "]" & asmnumber(StringMid($aasm, $lbuffer + 1))
				Case StringRegExp($aasm, "push [-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 6), True)
					If @extended Then
						$masmsize += 2
						$masmstring &= "6A" & $lbuffer
					Else
						$masmsize += 5
						$masmstring &= "68" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "mov eax,[-[:xdigit:]]{1,8}\z")
					$masmsize += 5
					$masmstring &= "B8" & asmnumber(StringMid($aasm, 9))
				Case StringRegExp($aasm, "mov ebx,[-[:xdigit:]]{1,8}\z")
					$masmsize += 5
					$masmstring &= "BB" & asmnumber(StringMid($aasm, 9))
				Case StringRegExp($aasm, "mov ecx,[-[:xdigit:]]{1,8}\z")
					$masmsize += 5
					$masmstring &= "B9" & asmnumber(StringMid($aasm, 9))
				Case StringRegExp($aasm, "mov edx,[-[:xdigit:]]{1,8}\z")
					$masmsize += 5
					$masmstring &= "BA" & asmnumber(StringMid($aasm, 9))
				Case StringRegExp($aasm, "add eax,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83C0" & $lbuffer
					Else
						$masmsize += 5
						$masmstring &= "05" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "add ebx,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83C3" & $lbuffer
					Else
						$masmsize += 6
						$masmstring &= "81C3" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "add ecx,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83C1" & $lbuffer
					Else
						$masmsize += 6
						$masmstring &= "81C1" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "add edx,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83C2" & $lbuffer
					Else
						$masmsize += 6
						$masmstring &= "81C2" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "add edi,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83C7" & $lbuffer
					Else
						$masmsize += 6
						$masmstring &= "81C7" & $lbuffer
					EndIf
				Case StringRegExp($aasm, "cmp ebx,[-[:xdigit:]]{1,8}\z")
					$lbuffer = asmnumber(StringMid($aasm, 9), True)
					If @extended Then
						$masmsize += 3
						$masmstring &= "83FB" & $lbuffer
					Else
						$masmsize += 6
						$masmstring &= "81FB" & $lbuffer
					EndIf
				Case Else
					Local $lopcode
					Switch $aasm
						Case "nop"
							$lopcode = "90"
						Case "pushad"
							$lopcode = "60"
						Case "popad"
							$lopcode = "61"
						Case "mov ebx,dword[eax]"
							$lopcode = "8B18"
						Case "test eax,eax"
							$lopcode = "85C0"
						Case "test ebx,ebx"
							$lopcode = "85DB"
						Case "test ecx,ecx"
							$lopcode = "85C9"
						Case "mov dword[eax],0"
							$lopcode = "C70000000000"
						Case "push eax"
							$lopcode = "50"
						Case "push ebx"
							$lopcode = "53"
						Case "push ecx"
							$lopcode = "51"
						Case "push edx"
							$lopcode = "52"
						Case "push ebp"
							$lopcode = "55"
						Case "push esi"
							$lopcode = "56"
						Case "push edi"
							$lopcode = "57"
						Case "jmp ebx"
							$lopcode = "FFE3"
						Case "pop eax"
							$lopcode = "58"
						Case "pop ebx"
							$lopcode = "5B"
						Case "pop edx"
							$lopcode = "5A"
						Case "pop ecx"
							$lopcode = "59"
						Case "pop esi"
							$lopcode = "5E"
						Case "inc eax"
							$lopcode = "40"
						Case "inc ecx"
							$lopcode = "41"
						Case "inc ebx"
							$lopcode = "43"
						Case "dec edx"
							$lopcode = "4A"
						Case "mov edi,edx"
							$lopcode = "8BFA"
						Case "mov ecx,esi"
							$lopcode = "8BCE"
						Case "mov ecx,edi"
							$lopcode = "8BCF"
						Case "xor eax,eax"
							$lopcode = "33C0"
						Case "xor ecx,ecx"
							$lopcode = "33C9"
						Case "xor edx,edx"
							$lopcode = "33D2"
						Case "xor ebx,ebx"
							$lopcode = "33DB"
						Case "mov edx,eax"
							$lopcode = "8BD0"
						Case "mov ebp,esp"
							$lopcode = "8BEC"
						Case "sub esp,8"
							$lopcode = "83EC08"
						Case "sub esp,14"
							$lopcode = "83EC14"
						Case "cmp ecx,4"
							$lopcode = "83F904"
						Case "cmp ecx,32"
							$lopcode = "83F932"
						Case "cmp ecx,3C"
							$lopcode = "83F93C"
						Case "mov ecx,edx"
							$lopcode = "8BCA"
						Case "mov eax,ecx"
							$lopcode = "8BC1"
						Case "mov ecx,dword[ebp+8]"
							$lopcode = "8B4D08"
						Case "mov ecx,dword[esp+1F4]"
							$lopcode = "8B8C24F4010000"
						Case "mov ecx,dword[edi+4]"
							$lopcode = "8B4F04"
						Case "mov ecx,dword[edi+8]"
							$lopcode = "8B4F08"
						Case "mov eax,dword[edi+4]"
							$lopcode = "8B4704"
						Case "mov dword[eax+4],ecx"
							$lopcode = "894804"
						Case "mov dword[eax+8],ecx"
							$lopcode = "894808"
						Case "mov dword[eax+C],ecx"
							$lopcode = "89480C"
						Case "mov dword[esi+10],eax"
							$lopcode = "894610"
						Case "mov ecx,dword[edi]"
							$lopcode = "8B0F"
						Case "mov dword[eax],ecx"
							$lopcode = "8908"
						Case "mov dword[eax],ebx"
							$lopcode = "8918"
						Case "mov edx,dword[eax+4]"
							$lopcode = "8B5004"
						Case "mov edx,dword[eax+c]"
							$lopcode = "8B500C"
						Case "mov edx,dword[esi+1c]"
							$lopcode = "8B561C"
						Case "push dword[eax+8]"
							$lopcode = "FF7008"
						Case "lea eax,dword[eax+18]"
							$lopcode = "8D4018"
						Case "lea ecx,dword[eax+4]"
							$lopcode = "8D4804"
						Case "lea edx,dword[eax+4]"
							$lopcode = "8D5004"
						Case "lea edx,dword[eax+8]"
							$lopcode = "8D5008"
						Case "mov ecx,dword[eax+4]"
							$lopcode = "8B4804"
						Case "mov ecx,dword[eax+8]"
							$lopcode = "8B4808"
						Case "mov eax,dword[eax+8]"
							$lopcode = "8B4008"
						Case "mov eax,dword[eax+4]"
							$lopcode = "8B4004"
						Case "push dword[eax+4]"
							$lopcode = "FF7004"
						Case "push dword[eax+c]"
							$lopcode = "FF700C"
						Case "mov esp,ebp"
							$lopcode = "8BE5"
						Case "mov esp,ebp"
							$lopcode = "8BE5"
						Case "pop ebp"
							$lopcode = "5D"
						Case "retn 10"
							$lopcode = "C21000"
						Case "cmp eax,2"
							$lopcode = "83F802"
						Case "cmp eax,0"
							$lopcode = "83F800"
						Case "cmp eax,B"
							$lopcode = "83F80B"
						Case "cmp eax,200"
							$lopcode = "3D00020000"
						Case "shl eax,4"
							$lopcode = "C1E004"
						Case "shl eax,8"
							$lopcode = "C1E008"
						Case "shl eax,6"
							$lopcode = "C1E006"
						Case "shl eax,7"
							$lopcode = "C1E007"
						Case "shl eax,8"
							$lopcode = "C1E008"
						Case "shl eax,9"
							$lopcode = "C1E009"
						Case "mov edi,eax"
							$lopcode = "8BF8"
						Case "mov dx,word[ecx]"
							$lopcode = "668B11"
						Case "mov dx,word[edx]"
							$lopcode = "668B12"
						Case "mov word[eax],dx"
							$lopcode = "668910"
						Case "test dx,dx"
							$lopcode = "6685D2"
						Case "cmp word[edx],0"
							$lopcode = "66833A00"
						Case "cmp eax,ebx"
							$lopcode = "3BC3"
						Case "cmp eax,ecx"
							$lopcode = "3BC1"
						Case "mov eax,dword[esi+8]"
							$lopcode = "8B4608"
						Case "mov ecx,dword[eax]"
							$lopcode = "8B08"
						Case "mov ebx,edi"
							$lopcode = "8BDF"
						Case "mov ebx,eax"
							$lopcode = "8BD8"
						Case "mov eax,edi"
							$lopcode = "8BC7"
						Case "mov al,byte[ebx]"
							$lopcode = "8A03"
						Case "test al,al"
							$lopcode = "84C0"
						Case "mov eax,dword[ecx]"
							$lopcode = "8B01"
						Case "lea ecx,dword[eax+180]"
							$lopcode = "8D8880010000"
						Case "mov ebx,dword[ecx+14]"
							$lopcode = "8B5914"
						Case "mov eax,dword[ebx+c]"
							$lopcode = "8B430C"
						Case "mov ecx,eax"
							$lopcode = "8BC8"
						Case "cmp eax,-1"
							$lopcode = "83F8FF"
						Case "mov al,byte[ecx]"
							$lopcode = "8A01"
						Case "mov ebx,dword[edx]"
							$lopcode = "8B1A"
						Case "lea edi,dword[edx+ebx]"
							$lopcode = "8D3C1A"
						Case "mov ah,byte[edi]"
							$lopcode = "8A27"
						Case "cmp al,ah"
							$lopcode = "3AC4"
						Case "mov dword[edx],0"
							$lopcode = "C70200000000"
						Case "mov dword[ebx],ecx"
							$lopcode = "890B"
						Case "cmp edx,esi"
							$lopcode = "3BD6"
						Case "cmp ecx,900000"
							$lopcode = "81F900009000"
						Case "mov edi,dword[edx+4]"
							$lopcode = "8B7A04"
						Case "cmp ebx,edi"
							$lopcode = "3BDF"
						Case "mov dword[edx],ebx"
							$lopcode = "891A"
						Case "lea edi,dword[edx+8]"
							$lopcode = "8D7A08"
						Case "mov dword[edi],ecx"
							$lopcode = "890F"
						Case "retn"
							$lopcode = "C3"
						Case "mov dword[edx],-1"
							$lopcode = "C702FFFFFFFF"
						Case "cmp eax,1"
							$lopcode = "83F801"
						Case "mov eax,dword[ebp+37c]"
							$lopcode = "8B857C030000"
						Case "mov eax,dword[ebp+338]"
							$lopcode = "8B8538030000"
						Case "mov ecx,dword[ebx+250]"
							$lopcode = "8B8B50020000"
						Case "mov ecx,dword[ebx+194]"
							$lopcode = "8B8B94010000"
						Case "mov ecx,dword[ebx+18]"
							$lopcode = "8B5918"
						Case "mov ecx,dword[ebx+40]"
							$lopcode = "8B5940"
						Case "mov ebx,dword[ecx+10]"
							$lopcode = "8B5910"
						Case "mov ebx,dword[ecx+18]"
							$lopcode = "8B5918"
						Case "mov ebx,dword[ecx+4c]"
							$lopcode = "8B594C"
						Case "mov ecx,dword[ebx]"
							$lopcode = "8B0B"
						Case "mov edx,esp"
							$lopcode = "8BD4"
						Case "mov ecx,dword[ebx+170]"
							$lopcode = "8B8B70010000"
						Case "cmp eax,dword[esi+9C]"
							$lopcode = "3B869C000000"
						Case "mov ebx,dword[ecx+20]"
							$lopcode = "8B5920"
						Case "mov ecx,dword[ecx]"
							$lopcode = "8B09"
						Case "mov eax,dword[ecx+40]"
							$lopcode = "8B4140"
						Case "mov ecx,dword[ecx+10]"
							$lopcode = "8B4910"
						Case "mov ecx,dword[ecx+18]"
							$lopcode = "8B4918"
						Case "mov ecx,dword[ecx+20]"
							$lopcode = "8B4920"
						Case "mov ecx,dword[ecx+4c]"
							$lopcode = "8B494C"
						Case "mov ecx,dword[ecx+170]"
							$lopcode = "8B8970010000"
						Case "mov ecx,dword[ecx+194]"
							$lopcode = "8B8994010000"
						Case "mov ecx,dword[ecx+250]"
							$lopcode = "8B8950020000"
						Case "mov al,byte[ecx+4f]"
							$lopcode = "8A414F"
						Case "mov al,byte[ecx+3f]"
							$lopcode = "8A413F"
						Case "cmp al,f"
							$lopcode = "3C0F"
						Case "lea esi,dword[esi+ebx*4]"
							$lopcode = "8D349E"
						Case "mov esi,dword[esi]"
							$lopcode = "8B36"
						Case "test esi,esi"
							$lopcode = "85F6"
						Case "clc"
							$lopcode = "F8"
						Case "repe movsb"
							$lopcode = "F3A4"
						Case "inc edx"
							$lopcode = "42"
						Case Else
							MsgBox(0, "ASM", "Could not assemble: " & $aasm)
							Exit
					EndSwitch
					$masmsize += 0.5 * StringLen($lopcode)
					$masmstring &= $lopcode
			EndSelect
		EndFunc

		Func completeasmcode()
			Local $linexpression = False
			Local $lexpression
			Local $ltempasm = $masmstring
			Local $lcurrentoffset = Dec(Hex($mmemory)) + $masmcodeoffset
			Local $ltoken
			For $i = 1 To $mlabels[0][0]
				If StringLeft($mlabels[$i][0], 6) = "Label_" Then
					$mlabels[$i][0] = StringTrimLeft($mlabels[$i][0], 6)
					$mlabels[$i][1] = $mmemory + $mlabels[$i][1]
				EndIf
			Next
			$masmstring = ""
			For $i = 1 To StringLen($ltempasm)
				$ltoken = StringMid($ltempasm, $i, 1)
				Switch $ltoken
					Case "(", "[", "{"
						$linexpression = True
					Case ")"
						$masmstring &= Hex(getlabelinfo($lexpression) - Int($lcurrentoffset) - 1, 2)
						$lcurrentoffset += 1
						$linexpression = False
						$lexpression = ""
					Case "]"
						$masmstring &= swapendian(Hex(getlabelinfo($lexpression), 8))
						$lcurrentoffset += 4
						$linexpression = False
						$lexpression = ""
					Case "}"
						$masmstring &= swapendian(Hex(getlabelinfo($lexpression) - Int($lcurrentoffset) - 4, 8))
						$lcurrentoffset += 4
						$linexpression = False
						$lexpression = ""
					Case Else
						If $linexpression Then
							$lexpression &= $ltoken
						Else
							$masmstring &= $ltoken
							$lcurrentoffset += 0.5
						EndIf
				EndSwitch
			Next
		EndFunc

		Func getlabelinfo($alabel)
			Local $lvalue = getvalue($alabel)
			If $lvalue = -1 Then Exit MsgBox(0, "Label", "Label: " & $alabel & " not provided")
			Return $lvalue
		EndFunc

		Func asmnumber($anumber, $asmall = False)
			If $anumber >= 0 Then
				$anumber = Dec($anumber)
			EndIf
			If $asmall AND $anumber <= 127 AND $anumber >= -128 Then
				Return SetExtended(1, Hex($anumber, 2))
			Else
				Return SetExtended(0, swapendian(Hex($anumber, 8)))
			EndIf
		EndFunc

	#EndRegion Assembler
#EndRegion Other Functions

Func __processgetname($i_pid)
	If NOT ProcessExists($i_pid) Then Return SetError(1, 0, "")
	If NOT @error Then
		Local $a_processes = ProcessList()
		For $i = 1 To $a_processes[0][0]
			If $a_processes[$i][1] = $i_pid Then Return $a_processes[$i][0]
		Next
	EndIf
	Return SetError(1, 0, "")
EndFunc

#RequireAdmin
Global Enum $rarity_white = 61, $rarity_blue = 63, $rarity_purple = 66, $rarity_gold = 64, $rarity_green = 67
Global Enum $bag_backpack = 1, $bag_beltpouch, $bag_bag1, $bag_bag2, $bag_equipmentpack, $bag_unclaimeditems = 7, $bag_storage1, $bag_storage2, $bag_storage3, $bag_storage4, $bag_storageanniversary, $bag_storage5, $bag_storage6, $bag_storage7, $bag_storage8
Global Enum $hero_norgu = 1, $hero_goren, $hero_tahlkora, $hero_masterofwhispers, $hero_acolytejin, $hero_koss, $hero_dunkoro, $hero_acolytesousuke, $hero_melonni, $hero_zhedshadowhoof, $hero_generalmorgahn, $hero_margridthesly, $hero_olias = 14, $hero_razah, $hero_mox, $hero_jora = 18, $hero_pyrefierceshot, $hero_livia = 21, $hero_hayda, $hero_kahmu, $hero_gwen, $hero_xandra, $hero_vekk, $hero_ogden
Global Enum $heromode_fight, $heromode_guard, $heromode_avoid
Global Enum $dye_blue = 2, $dye_green, $dye_purple, $dye_red, $dye_yellow, $dye_brown, $dye_orange, $dye_silver, $dye_black, $dye_gray, $dye_white
Global Enum $attrib_fastcasting, $attrib_illusionmagic, $attrib_dominationmagic, $attrib_inspirationmagic, $attrib_bloodmagic, $attrib_deathmagic, $attrib_soulreaping, $attrib_curses, $attrib_airmagic, $attrib_earthmagic, $attrib_firemagic, $attrib_watermagic, $attrib_energystorage, $attrib_healingprayers, $attrib_smitingprayers, $attrib_protectionprayers, $attrib_divinefavor, $attrib_strength, $attrib_axemastery, $attrib_hammermastery, $attrib_swordsmanship, $attrib_tactics, $attrib_beastmastery, $attrib_expertise, $attrib_wildernesssurvival, $attrib_marksmanship, $attrib_daggermastery, $attrib_deadlyarts, $attrib_shadowarts, $attrib_communing, $attrib_restorationmagic, $attrib_channelingmagic, $attrib_criticalstrikes, $attrib_spawningpower, $attrib_spearmastery, $attrib_command, $attrib_motivation, $attrib_leadership, $attrib_scythemastery, $attrib_windprayers, $attrib_earthprayers, $attrib_mysticism
Global Enum $equip_weapon, $equip_offhand, $equip_chest, $equip_legs, $equip_head, $equip_feet, $equip_hands
Global Enum $skilltype_stance = 3, $skilltype_hex, $skilltype_spell, $skilltype_enchantment, $skilltype_signet, $skilltype_well = 9, $skilltype_skill, $skilltype_ward, $skilltype_glyph, $skilltype_attack = 14, $skilltype_shout, $skilltype_preparation = 19, $skilltype_trap = 21, $skilltype_ritual, $skilltype_itemspell = 24, $skilltype_weaponspell, $skilltype_chant = 27, $skilltype_echorefrain
Global Enum $region_international = -2, $region_america = 0, $region_korea, $region_europe, $region_china, $region_japan
Global Enum $language_english = 0, $language_french = 2, $language_german, $language_italian, $language_spanish, $language_polish = 9, $language_russian
Global Const $flag_reset = 2139095040
Global $intskillenergy[8] = [16, 16, 16, 100, 100, 100, 20, 100]
Global $intskillcasttime[8] = [0, 0, 0, 0, 0, 0, 250, 0]
Global $intskilladrenaline[8] = [0, 0, 0, 0, 0, 0, 0, 0]
Global $totalskills = 7
Global $iitems_picked = 0
Global $deadontherun = 0
Global $litemextrastruct = DllStructCreate("byte rarity;" & "byte unknown1[3];" & "byte modifier;" & "byte unknown2[13];" & "byte lastModifier")
Global $litemextrastructptr = DllStructGetPtr($litemextrastruct)
Global $litemextrastructsize = DllStructGetSize($litemextrastruct)
Global $litemextrareqstruct = DllStructCreate("byte requirement;" & "byte attribute")
Global $litemextrareqstructptr = DllStructGetPtr($litemextrareqstruct)
Global $litemextrareqstructsize = DllStructGetSize($litemextrareqstruct)
Global $litemmodstruct = DllStructCreate("byte unknown1[28];" & "byte armor")
Global $litemmodstructptr = DllStructGetPtr($litemmodstruct)
Global $litemmodstructsize = DllStructGetSize($litemmodstruct)
#Region H&H

	Func movehero($ax, $ay, $heroid, $random = 75)
		Switch $heroid
			Case "All"
				commandall(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 1
				commandhero1(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 2
				commandhero2(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 3
				commandhero3(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 4
				commandhero4(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 5
				commandhero5(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 6
				commandhero6(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
			Case 7
				commandhero7(_floattoint($ax) + Random(-$random, $random), _floattoint($ay) + Random(-$random, $random))
		EndSwitch
	EndFunc

	Func commandhero1($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 4), $ax, $ay, 0)
	EndFunc

	Func commandhero2($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 40), $ax, $ay, 0)
	EndFunc

	Func commandhero3($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 76), $ax, $ay, 0)
	EndFunc

	Func commandhero4($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 112), $ax, $ay, 0)
	EndFunc

	Func commandhero5($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 148), $ax, $ay, 0)
	EndFunc

	Func commandhero6($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 184), $ax, $ay, 0)
	EndFunc

	Func commandhero7($ax = 2139095040, $ay = 2139095040)
		Local $loffset[4] = [0, 24, 44, 1312]
		Local $lherostruct = memoryreadptr($mbasepointer, $loffset)
		sendpacket(20, 18, memoryread($lherostruct[1] + 220), $ax, $ay, 0)
	EndFunc

	#Region Trade with Players

		Func tradeplayer($aagent)
			Local $lagentid
			If IsDllStruct($aagent) = 0 Then
				$lagentid = convertid($aagent)
			Else
				$lagentid = DllStructGetData($aagent, "ID")
			EndIf
			sendpacket(8, 66, $lagentid)
		EndFunc

		Func fight($x, $s = "enemies")
			changeweaponset(2)
			If $deadontherun = 0 Then
				Local $timertogetout = TimerInit()
				Do
					If $deadontherun = 0 Then $useskill = -1
					If $deadontherun = 0 Then $target = getnearestenemytoagent(-2)
					$distance = getdistance($target, -2)
					If DllStructGetData($target, "ID") <> 0 AND $distance < $x AND $deadontherun = 0 Then
						If $deadontherun = 0 Then changetarget($target)
						If $deadontherun = 0 Then rndslp(150)
						If getagentname($target) = "Khabuus" AND $deadontherun = 0 Then
							If $deadontherun = 0 Then targetnextenemy()
							If $deadontherun = 0 Then rndslp(150)
							If $deadontherun = 0 Then $target = getcurrenttarget()
							If $deadontherun = 0 Then changetarget($target)
							If $deadontherun = 0 Then rndslp(150)
						EndIf
						If $deadontherun = 0 Then calltarget($target)
						If $deadontherun = 0 Then rndslp(150)
						If $deadontherun = 0 Then attack($target)
						If $deadontherun = 0 Then rndslp(150)
					ElseIf DllStructGetData($target, "ID") = 0 OR $distance > $x OR $deadontherun = 1 Then
						ExitLoop
					EndIf
					If $deadontherun = 0 Then
						For $i = 0 To $totalskills
							$targethp = DllStructGetData(getcurrenttarget(), "HP")
							If $targethp = 0 Then ExitLoop
							$distance = getdistance($target, -2)
							If $distance > $x Then ExitLoop
							$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
							If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
							$targetisdead = DllStructGetData(getcurrenttarget(), "Effects")
							If $targetisdead = 16 Then ExitLoop
							$targetitem = DllStructGetData(getcurrenttarget(), "Type")
							If $targetitem = 1024 Then ExitLoop
							$energy = getenergy(-2)
							$recharge = DllStructGetData(getskillbar(), "Recharge" & $i + 1)
							$adrenaline = DllStructGetData(getskillbar(), "Adrenaline" & $i + 1)
							If $recharge = 0 AND $energy >= $intskillenergy[$i] AND $adrenaline >= ($intskilladrenaline[$i] * 25 - 25) Then
								$useskill = $i + 1
								$variabletosort = 0
								If $i = 0 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 1 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge1") > 0
								ElseIf $i = 1 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 2 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge2") > 0
								ElseIf $i = 2 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 3 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge3") > 0
								Else
									If $i > 5 Then
										useskill($useskill, $target)
										rndslp($intskillcasttime[$i + 1] + 500)
									EndIf
								EndIf
							EndIf
							If $i = $totalskills Then $i = -1
							If $deadontherun = 1 Then ExitLoop
						Next
					EndIf
					$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
					$targetisdead = DllStructGetData(getcurrenttarget(), "Effects")
					$targethp = DllStructGetData(getcurrenttarget(), "HP")
					$targetitem = DllStructGetData(getcurrenttarget(), "Type")
				Until DllStructGetData($target, "ID") = 0 OR $distance > $x OR $deadontherun = 1 OR $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 OR $targetisdead = 16 OR $targethp = 0 OR $targetitem = 1024 OR TimerDiff($timertogetout) > 240000
			EndIf
		EndFunc

		Func fightbug($x, $s = "enemies")
			changeweaponset(2)
			If $deadontherun = 0 Then
				Local $timertogetout = TimerInit()
				Do
					If $deadontherun = 0 Then $useskill = -1
					If $deadontherun = 0 Then $target = getnearestenemytoagent(-2)
					$distance = getdistance($target, -2)
					If DllStructGetData($target, "ID") <> 0 AND $distance < $x AND $deadontherun = 0 Then
						If $deadontherun = 0 Then changetarget($target)
						If $deadontherun = 0 Then rndslp(150)
						If getagentname($target) = "Khabuus" AND $deadontherun = 0 Then
							If $deadontherun = 0 Then targetnextenemy()
							If $deadontherun = 0 Then rndslp(150)
							If $deadontherun = 0 Then $target = getcurrenttarget()
							If $deadontherun = 0 Then changetarget($target)
							If $deadontherun = 0 Then rndslp(150)
						EndIf
						If $deadontherun = 0 Then calltarget($target)
						If $deadontherun = 0 Then rndslp(150)
						If $deadontherun = 0 Then attack($target)
						If $deadontherun = 0 Then rndslp(150)
					ElseIf DllStructGetData($target, "ID") = 0 OR $distance > $x OR $deadontherun = 1 Then
						ExitLoop
					EndIf
					If $deadontherun = 0 Then
						For $i = 0 To $totalskills
							$targethp = DllStructGetData(getcurrenttarget(), "HP")
							If $targethp = 0 Then ExitLoop
							$distance = getdistance($target, -2)
							If $distance > $x Then ExitLoop
							$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
							If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
							$targetisdead = DllStructGetData(getcurrenttarget(), "Effects")
							If $targetisdead = 16 Then ExitLoop
							$targetitem = DllStructGetData(getcurrenttarget(), "Type")
							If $targetitem = 1024 Then ExitLoop
							$energy = getenergy(-2)
							$recharge = DllStructGetData(getskillbar(), "Recharge" & $i + 1)
							$adrenaline = DllStructGetData(getskillbar(), "Adrenaline" & $i + 1)
							If $recharge = 0 AND $energy >= $intskillenergy[$i] AND $adrenaline >= ($intskilladrenaline[$i] * 25 - 25) Then
								$useskill = $i + 1
								$variabletosort = 0
								If $i = 0 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 1 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge1") > 0
								ElseIf $i = 1 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 2 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge2") > 0
								ElseIf $i = 2 Then
									Do
										$energy = getenergy(-2)
										If $energy >= $intskillenergy[$i] Then
											useskill($useskill, $target)
											rndslp(600)
										EndIf
										rndslp(200)
										$variabletosort = $variabletosort + 1
										If DllStructGetData(getcurrenttarget(), "HP") = 0 Then ExitLoop
										If getdistance($target, -2) > $x Then ExitLoop
										$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
										If $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Effects") = 16 Then ExitLoop
										If DllStructGetData(getcurrenttarget(), "Type") = 1024 Then ExitLoop
									Until (DllStructGetData(getagentbyid(-1), "LastStrike") = 3 OR $variabletosort = 3) OR DllStructGetData(getskillbar(), "Recharge3") > 0
								Else
									If $i > 5 Then
										useskill($useskill, $target)
										rndslp($intskillcasttime[$i + 1] + 500)
									EndIf
								EndIf
							EndIf
							If $i = $totalskills Then $i = -1
							If $deadontherun = 1 Then ExitLoop
						Next
					EndIf
					$targetallegiance = DllStructGetData(getcurrenttarget(), "Allegiance")
					$targetisdead = DllStructGetData(getcurrenttarget(), "Effects")
					$targethp = DllStructGetData(getcurrenttarget(), "HP")
					$targetitem = DllStructGetData(getcurrenttarget(), "Type")
				Until DllStructGetData($target, "ID") = 0 OR $distance > $x OR $deadontherun = 1 OR $targetallegiance = 1 OR $targetallegiance = 4 OR $targetallegiance = 5 OR $targetallegiance = 6 OR $targetisdead = 16 OR $targethp = 0 OR $targetitem = 1024 OR TimerDiff($timertogetout) > 30000
			EndIf
			If TimerDiff($timertogetout) > 30000 Then
				Return 1
			Else
				Return 0
			EndIf
		EndFunc

		Func submitoffer($aamount)
			sendpacket(8, 175, $aamount)
		EndFunc

		Func changeoffer()
			sendpacket(4, 178)
		EndFunc

		Func offeritem($aitem, $aamount = 0)
			Local $litemid, $lamount
			If IsDllStruct($aitem) = 0 Then
				$litemid = $aitem
				If $aamount > 0 Then
					$lamount = $aamount
				Else
					$lamount = DllStructGetData(getitembyitemid($aitem), "Quantity")
				EndIf
			Else
				$litemid = DllStructGetData($aitem, "ID")
				If $aamount > 0 Then
					$lamount = $aamount
				Else
					$lamount = DllStructGetData($aitem, "Quantity")
				EndIf
			EndIf
			sendpacket(12, 174, $litemid, $lamount)
		EndFunc

		Func canceltrade()
			sendpacket(4, 173)
		EndFunc

		Func accepttrade()
			sendpacket(4, 179)
		EndFunc

	#EndRegion Trade with Players
	#Region Action-related commands
		#Region Item related commands

			Func pickupitems($iitems = -1, $fmaxdistance = 1012)
				Local $aitemid, $lnearestdistance, $ldistance
				$tdeadlock = TimerInit()
				Do
					$aitem = getnearestitemtoagent(-2)
					$ldistance = @extended
					$aitemid = DllStructGetData($aitem, "ID")
					If $aitemid = 0 OR $ldistance > $fmaxdistance OR TimerDiff($tdeadlock) > 30000 Then ExitLoop
					pickupitem($aitem)
					$tdeadlock2 = TimerInit()
					Do
						Sleep(500)
						If TimerDiff($tdeadlock2) > 5000 Then ContinueLoop 2
					Until DllStructGetData(getagentbyid($aitemid), "ID") == 0
					$iitems_picked += 1
				Until $iitems_picked = $iitems
				Return $iitems_picked
			EndFunc

			Func getnearestitemtoagent2($aagent)
				Local $lnearestagent, $lnearestdistance = 100000000
				Local $ldistance, $lagenttocompare
				If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If DllStructGetData($lagenttocompare, "Type") <> 1024 Then ContinueLoop
					$ldistance = (DllStructGetData($lagenttocompare, "Y") - DllStructGetData($aagent, "Y")) ^ 2 + (DllStructGetData($lagenttocompare, "X") - DllStructGetData($aagent, "X")) ^ 2
					If $ldistance < $lnearestdistance Then
						$lnearestagent = $lagenttocompare
						$lnearestdistance = $ldistance
					EndIf
				Next
				SetExtended(Sqrt($lnearestdistance))
				Return $lnearestagent
			EndFunc

			Func getnearestitembymodelid($modelid, $aagent = -2)
				Local $lnearestagent, $lnearestdistance = 100000000
				Local $ldistance, $lagenttocompare
				If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If DllStructGetData($lagenttocompare, "Type") <> 1024 Then ContinueLoop
					If DllStructGetData(getitembyagentid($i), "ModelID") <> $modelid Then ContinueLoop
					$ldistance = (DllStructGetData($lagenttocompare, "Y") - DllStructGetData($aagent, "Y")) ^ 2 + (DllStructGetData($lagenttocompare, "X") - DllStructGetData($aagent, "X")) ^ 2
					If $ldistance < $lnearestdistance Then
						$lnearestagent = $lagenttocompare
						$lnearestdistance = $ldistance
					EndIf
				Next
				Return $lnearestagent
			EndFunc

			Func getnumberoffoesinrangeofagent($aagent = -2, $fmaxdistance = 1012)
				Local $ldistance, $lcount = 0
				If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If getisdead($lagenttocompare) <> 0 Then ContinueLoop
					If DllStructGetData($lagenttocompare, "Allegiance") = 3 Then
						$ldistance = getdistance($lagenttocompare, $aagent)
						If $ldistance < $fmaxdistance Then
							$lcount += 1
						EndIf
					EndIf
				Next
				Return $lcount
			EndFunc

			Func getnumberofalliesinrangeofagent($aagent = -2, $fmaxdistance = 1012)
				Local $ldistance, $lcount = 0
				If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If getisdead($lagenttocompare) <> 0 Then ContinueLoop
					If DllStructGetData($lagenttocompare, "Allegiance") = 1 Then
						$ldistance = getdistance($lagenttocompare, $aagent)
						If $ldistance < $fmaxdistance Then
							$lcount += 1
						EndIf
					EndIf
				Next
				Return $lcount
			EndFunc

			Func getnumberofitemsinrangeofagent($aagent = -2, $fmaxdistance = 1012)
				Local $ldistance, $lcount = 0
				If IsDllStruct($aagent) = 0 Then $aagent = getagentbyid($aagent)
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If DllStructGetData($lagenttocompare, "Type") = 1024 Then
						$ldistance = getdistance($lagenttocompare, $aagent)
						If $ldistance < $fmaxdistance Then
							$lcount += 1
						EndIf
					EndIf
				Next
				Return $lcount
			EndFunc

			Func getnearestenemytocoords($ax, $ay)
				Local $lnearestagent, $lnearestdistance = 100000000
				Local $ldistance, $lagenttocompare
				For $i = 1 To getmaxagents()
					$lagenttocompare = getagentbyid($i)
					If DllStructGetData($lagenttocompare, "HP") < 0.005 OR DllStructGetData($lagenttocompare, "Allegiance") <> 3 Then ContinueLoop
					$ldistance = ($ax - DllStructGetData($lagenttocompare, "X")) ^ 2 + ($ay - DllStructGetData($lagenttocompare, "Y")) ^ 2
					If $ldistance < $lnearestdistance Then
						$lnearestagent = $lagenttocompare
						$lnearestdistance = $ldistance
					EndIf
				Next
				Return $lnearestagent
			EndFunc

			Func ident($bagindex, $numofslots)
				If findidkit() = False Then
					buyidkit()
					Sleep(Random(240, 260))
				EndIf
				For $i = 1 To $numofslots
					$aitem = getitembyslot($bagindex, $i)
					If DllStructGetData($aitem, "ID") = 0 Then ContinueLoop
					identifyitem($aitem)
					Sleep(Random(500, 750))
				Next
			EndFunc

			Func cansell($aitem)
				$m = DllStructGetData($aitem, "ModelID")
				$q = DllStructGetData($aitem, "Quantity")
				$r = DllStructGetData(getetraiteminfobyitemid($aitem), "Rarity")
				If $m = 0 OR $q > 1 OR $r = $rarity_gold OR $r = $rarity_green Then
					Return False
				ElseIf $m > 21785 AND $m < 21806 Then
					Return False
				ElseIf $m = 146 OR $m = 22751 Then
					Return False
				ElseIf $m = 5899 OR $m = 5900 Then
					Return False
				ElseIf $m = 5594 OR $m = 5595 OR $m = 5611 OR $m = 5853 OR $m = 5975 OR $m = 5976 OR $m = 21233 Then
					Return False
				ElseIf $m = 923 OR $m = 931 OR $m = 6533 Then
					Return False
				ElseIf ($m = 1175 OR $m = 1176 OR $m = 1152 OR $m = 1153 OR $m = 920 OR $m = 0) AND $r <> $rarity_white Then
					Return False
				ElseIf $m = 27033 Then
					Return False
				Else
					Return True
				EndIf
			EndFunc

			Func sell($bagindex, $numofslots)
				Sleep(Random(150, 250))
				For $i = 1 To $numofslots
					$aitem = getitembyslot($bagindex, $i)
					If cansell($aitem) Then sellitem($aitem)
					Sleep(Random(500, 550))
				Next
			EndFunc

			Func getetraiteminfobyitemid($aitem)
				$item = getitembyitemid($aitem)
				$litemextraptr = DllStructGetData($item, "ModPtr")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextraptr, "ptr", $litemextrastructptr, "int", $litemextrastructsize, "int", "")
				Return $litemextrastruct
			EndFunc

			Func getetraiteminfobyagentid($aitem)
				$item = getitembyagentid($aitem)
				$litemextraptr = DllStructGetData($item, "ModPtr")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextraptr, "ptr", $litemextrastructptr, "int", $litemextrastructsize, "int", "")
				Return $litemextrastruct
			EndFunc

			Func getetraiteminfobymodelid($aitem)
				$item = getitembymodelid($aitem)
				$litemextraptr = DllStructGetData($item, "ModPtr")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextraptr, "ptr", $litemextrastructptr, "int", $litemextrastructsize, "int", "")
				Return $litemextrastruct
			EndFunc

			Func getextraitemreqbyslot($abag, $aslot)
				$item = getitembyslot($abag, $aslot)
				$litemextrareqptr = DllStructGetData($item, "extraItemReq")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextrareqptr, "ptr", $litemextrareqstructptr, "int", $litemextrareqstructsize, "int", "")
				Return $litemextrareqstruct
			EndFunc

			Func getextraitemreqbyitemid($aitem)
				$item = getitembyitemid($aitem)
				$litemextrareqptr = DllStructGetData($item, "extraItemReq")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextrareqptr, "ptr", $litemextrareqstructptr, "int", $litemextrareqstructsize, "int", "")
				Return $litemextrareqstruct
			EndFunc

			Func getextraitemreqbyagentid($aitem)
				$item = getitembyagentid($aitem)
				$litemextrareqptr = DllStructGetData($item, "extraItemReq")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextrareqptr, "ptr", $litemextrareqstructptr, "int", $litemextrareqstructsize, "int", "")
				Return $litemextrareqstruct
			EndFunc

			Func getextraitemreqbymodelid($aitem)
				$item = getitembymodelid($aitem)
				$litemextrareqptr = DllStructGetData($item, "extraItemReq")
				DllCall($mkernelhandle, "int", "ReadProcessMemory", "int", $mgwprochandle, "int", $litemextrareqptr, "ptr", $litemextrareqstructptr, "int", $litemextrareqstructsize, "int", "")
				Return $litemextrareqstruct
			EndFunc

			Func findemptyslot($bagindex)
				Local $liteminfo, $aslot
				For $aslot = 0 To DllStructGetData(getbag($bagindex), "Slots") - 1
					Sleep(40)
					ConsoleWrite("Checking: " & $bagindex & ", " & $aslot & @CRLF)
					$liteminfo = getitembyslot($bagindex, $aslot)
					If DllStructGetData($liteminfo, "ID") = 0 Then
						ConsoleWrite($bagindex & ", " & $aslot & "  <-Empty! " & @CRLF)
						SetExtended($aslot + 1)
						ExitLoop
					EndIf
				Next
				Return 0
			EndFunc

			#Region Misc

				Func gethppips($aagent = -2)
					If IsDllStruct($aagent) == 0 Then $aagent = getagentbyid($aagent)
					Return Round(DllStructGetData($aagent, "hppips") * DllStructGetData($aagent, "maxhp") / 2, 0)
				EndFunc

				Func getteam($ateam)
					Local $lteamnumber
					Local $lteam[1][2]
					Local $lteamsmall[1] = [0]
					Local $lagent
					If IsString($ateam) Then
						Switch $ateam
							Case "Blue"
								$lteamnumber = 1
							Case "Red"
								$lteamnumber = 2
							Case "Yellow"
								$lteamnumber = 3
							Case "Purple"
								$lteamnumber = 4
							Case "Cyan"
								$lteamnumber = 5
							Case Else
								$lteamnumber = 0
						EndSwitch
					Else
						$lteamnumber = $ateam
					EndIf
					$lteam[0][0] = 0
					$lteam[0][1] = $lteamnumber
					If $lteamnumber == 0 Then Return $lteamsmall
					For $i = 1 To getmaxagents()
						$lagent = getagentbyid($i)
						If DllStructGetData($lagent, "ID") == 0 Then ContinueLoop
						If getisliving($lagent) AND DllStructGetData($lagent, "Team") == $lteamnumber AND (DllStructGetData($lagent, "LoginNumber") <> 0 OR StringRight(getagentname($lagent), 9) == "Henchman]") Then
							$lteam[0][0] += 1
							ReDim $lteam[$lteam[0][0] + 1][2]
							$lteam[$lteam[0][0]][0] = DllStructGetData($lagent, "id")
							$lteam[$lteam[0][0]][1] = DllStructGetData($lagent, "PlayerNumber")
						EndIf
					Next
					_arraysort($lteam, 0, 1, 0, 1)
					ReDim $lteamsmall[$lteam[0][0] + 1]
					For $i = 0 To $lteam[0][0]
						$lteamsmall[$i] = $lteam[$i][0]
					Next
					Return $lteamsmall
				EndFunc

				Func formatname($aagent)
					If IsDllStruct($aagent) == 0 Then $aagent = getagentbyid($aagent)
					Local $lstring
					Switch DllStructGetData($aagent, "Primary")
						Case 1
							$lstring &= "W"
						Case 2
							$lstring &= "R"
						Case 3
							$lstring &= "Mo"
						Case 4
							$lstring &= "N"
						Case 5
							$lstring &= "Me"
						Case 6
							$lstring &= "E"
						Case 7
							$lstring &= "A"
						Case 8
							$lstring &= "Rt"
						Case 9
							$lstring &= "P"
						Case 10
							$lstring &= "D"
					EndSwitch
					Switch DllStructGetData($aagent, "Secondary")
						Case 1
							$lstring &= "/W"
						Case 2
							$lstring &= "/R"
						Case 3
							$lstring &= "/Mo"
						Case 4
							$lstring &= "/N"
						Case 5
							$lstring &= "/Me"
						Case 6
							$lstring &= "/E"
						Case 7
							$lstring &= "/A"
						Case 8
							$lstring &= "/Rt"
						Case 9
							$lstring &= "/P"
						Case 10
							$lstring &= "/D"
					EndSwitch
					$lstring &= " - "
					If DllStructGetData($aagent, "LoginNumber") > 0 Then
						$lstring &= getplayername($aagent)
					Else
						$lstring &= StringReplace(getagentname($aagent), "Corpse of ", "")
					EndIf
					Return $lstring
				EndFunc

				Func death()
					If DllStructGetData(getagentbyid(-2), "Effects") = 16 Then
						Return 1
					Else
						Return 0
					EndIf
				EndFunc

				Func rndslp($val)
					$wert = Random($val * 0.95, $val * 1.05, 1)
					If $wert > 45000 Then
						For $i = 0 To 6
							Sleep($wert / 6)
							death()
						Next
					ElseIf $wert > 36000 Then
						For $i = 0 To 5
							Sleep($wert / 5)
							death()
						Next
					ElseIf $wert > 27000 Then
						For $i = 0 To 4
							Sleep($wert / 4)
							death()
						Next
					ElseIf $wert > 18000 Then
						For $i = 0 To 3
							Sleep($wert / 3)
							death()
						Next
					ElseIf $wert >= 9000 Then
						For $i = 0 To 2
							Sleep($wert / 2)
							death()
						Next
					Else
						Sleep($wert)
						death()
					EndIf
				EndFunc

				Func slp($val)
					If $val > 45000 Then
						For $i = 0 To 6
							Sleep($val / 6)
							death()
						Next
					ElseIf $val > 36000 Then
						For $i = 0 To 5
							Sleep($val / 5)
							death()
						Next
					ElseIf $val > 27000 Then
						For $i = 0 To 4
							Sleep($val / 4)
							death()
						Next
					ElseIf $val > 18000 Then
						For $i = 0 To 3
							Sleep($val / 3)
							death()
						Next
					ElseIf $val >= 9000 Then
						For $i = 0 To 2
							Sleep($val / 2)
							death()
						Next
					Else
						Sleep($val)
						death()
					EndIf
				EndFunc

				Func _floattoint($ffloat)
					Local $tfloat, $tint
					$tfloat = DllStructCreate("float")
					$tint = DllStructCreate("int", DllStructGetPtr($tfloat))
					DllStructSetData($tfloat, 1, $ffloat)
					Return DllStructGetData($tint, 1)
				EndFunc

				Func _inttofloat($fint)
					Local $tfloat, $tint
					$tint = DllStructCreate("int")
					$tfloat = DllStructCreate("float", DllStructGetPtr($tint))
					DllStructSetData($tint, 1, $fint)
					Return DllStructGetData($tfloat, 1)
				EndFunc

				Func pingsleep($msextra = 0)
					$ping = getping()
					Sleep($ping + $msextra)
				EndFunc

				Func computedistanceex($x1, $y1, $x2, $y2)
					Return Sqrt(($y2 - $y1) ^ 2 + ($x2 - $x1) ^ 2)
					$dist = Sqrt(($y2 - $y1) ^ 2 + ($x2 - $x1) ^ 2)
					ConsoleWrite("Distance: " & $dist & @CRLF)
				EndFunc

				Func gonearestnpctocoords($ax, $ay)
					Local $npc
					moveto($ax, $ay)
					$npc = getnearestnpctocoords($ax, $ay)
					Do
						rndsleep(250)
						gonpc($npc)
					Until getdistance($npc, -2) < 250
					rndsleep(500)
				EndFunc

				Func checkarea($ax, $ay, $n = 200)
					$ret = False
					$px = DllStructGetData(getagentbyid(-2), "X")
					$py = DllStructGetData(getagentbyid(-2), "Y")
					If ($px < $ax + $n) AND ($px > $ax - $n) AND ($py < $ay + $n) AND ($py > $ay - $n) Then
						$ret = True
					EndIf
					Return $ret
				EndFunc

			#EndRegion Misc
			Global $running = False
			Opt("GUIOnEventMode", 1)
			#Region ### START Koda GUI section ### Form=
				$form1 = GUICreate("Rollerbeetle Bot", 266, 136, 192, 124)
				$button1 = GUICtrlCreateButton("Start/Stop", 56, 40, 153, 49)
				$label1 = GUICtrlCreateLabel("Hi, I'm a rollerbeetle bot.", 0, 12, 265, 20, $ss_center)
				$label2 = GUICtrlCreateLabel("Coded by n0futur3", 0, 100, 265, 20, $ss_center)
				GUICtrlSetColor(-1, $color_red)
				GUISetState(@SW_SHOW)
			#EndRegion ### END Koda GUI section ###
			GUISetOnEvent($gui_event_close, "EventHandler")
			GUICtrlSetOnEvent($button1, "EventHandler")
			Global $stucky1 = 0
			Global $stuckx2 = 0
			Global $stucky2 = 0

			Func eventhandler()
				Select
					Case @GUI_CtrlId = $gui_event_close
						Exit
					Case @GUI_CtrlId = $button1
						$running = NOT $running
						If $running Then
							GUICtrlSetData($button1, "Running, press here to stop")
						Else
							GUICtrlSetData($button1, "Stopped, press here to run")
						EndIf
				EndSelect
			EndFunc

			If initialize(WinGetProcess("Guild Wars"), False, False) = False Then MsgBox(0, "Initialize failed", "Initialize failed!")
			While 1
				Sleep(100)
				If $running Then
					checkoutpost()
					Local $rnd = Random(0, 1)
					race()
				EndIf
			WEnd

			Func stuck()
				$stuckx1 = $stuckx2
				$stucky1 = $stucky2
				$stuckx2 = DllStructGetData(getagentbyid(-2), "X")
				$stucky2 = DllStructGetData(getagentbyid(-2), "Y")
				If $stuckx1 = $stuckx2 AND $stucky1 = $stucky2 Then
					strafeleft(1)
					Sleep(200)
					strafeleft(0)
					$stuckx2 = DllStructGetData(getagentbyid(-2), "X")
					$stucky2 = DllStructGetData(getagentbyid(-2), "Y")
					If $stuckx1 = $stuckx2 AND $stucky1 = $stucky2 Then
						straferight(1)
						Sleep(200)
						straferight(0)
					EndIf
				EndIf
			EndFunc

			Func checkoutpost()
				If getmapid() <> 467 Then travelto(467)
				If checkarea(-6416, -6901, 500) Then
					enterchallenge()
					While checkarea(-6416, -6901, 600) AND getmapisloaded()
						Sleep(500)
					WEnd
				EndIf
			EndFunc

			Func race()
				AdlibRegister("Stuck", 3000)
				Do
					moveto(-5668, -2804)
				Until checkarea(-5668, -2804)
				AdlibRegister("RunningBasic", 5000)
				AdlibRegister("RunningSpecial", 10000)
				moveto(-5673.14697265625, -2757.06396484375)
				moveto(-5516.36865234375, -2280.19775390625)
				moveto(-5315.2265625, -1811.34558105469)
				moveto(-5053.7841796875, -1385.13623046875)
				moveto(-4746.45263671875, -1011.87158203125)
				moveto(-4426.11474609375, -630.346313476563)
				moveto(-4107.61376953125, -239.090286254883)
				moveto(-3797.1259765625, 155.935455322266)
				moveto(-3623.666015625, 617.51708984375)
				moveto(-3938.09008789063, 972.233703613281)
				moveto(-4362.712890625, 1157.03698730469)
				moveto(-4792.51611328125, 1387.658203125)
				moveto(-4792.51611328125, 1387.658203125)
				moveto(-4703.05419921875, 1461.80029296875)
				moveto(-4957.03076171875, 1949.94714355469)
				moveto(-5028.56591796875, 2493.89086914063)
				moveto(-5074.130859375, 3193.3857421875)
				moveto(-5100.2490234375, 3907.9853515625)
				moveto(-5081.55078125, 4468.67724609375)
				moveto(-4931.1396484375, 5006.0146484375)
				moveto(-4713.84814453125, 5660.2705078125)
				moveto(-4411.1474609375, 6273.56201171875)
				moveto(-4041.77758789063, 6826.154296875)
				moveto(-3687.86572265625, 7241.787109375)
				moveto(-3467.33154296875, 7914.00537109375)
				moveto(-3271.09228515625, 8520.173828125)
				moveto(-3041.04736328125, 9109.2421875)
				moveto(-2806.72119140625, 9698.7666015625)
				moveto(-2512.41870117188, 10239.7744140625)
				moveto(-2008.49182128906, 10579.34375)
				moveto(-1433.19860839844, 10770.3134765625)
				moveto(-1053.494140625, 11165.935546875)
				moveto(-1470.44604492188, 11705.5439453125)
				moveto(-1589.79382324219, 12318.7919921875)
				moveto(-1099.47473144531, 12828.2373046875)
				moveto(-574.090026855469, 13288.037109375)
				moveto(12.7980651855469, 13645.5)
				moveto(622.149658203125, 13944.8857421875)
				moveto(1273.63208007813, 14157.546875)
				moveto(1637, 14268)
				moveto(1705.54870605469, 14483.990234375)
				moveto(1989.046875, 14277.0087890625)
				moveto(2160.22436523438, 13895.1630859375)
				moveto(2479.13720703125, 13265.7138671875)
				moveto(2908.02612304688, 12702.3828125)
				moveto(3216.54150390625, 12354.8037109375)
				moveto(3325.77197265625, 11907.18359375)
				moveto(3279.9375, 11416.166015625)
				moveto(3254.17700195313, 10945.5390625)
				moveto(3262.81958007813, 10496.3984375)
				moveto(3340.27587890625, 10084.498046875)
				moveto(3481.24291992188, 9717.154296875)
				moveto(3599.20336914063, 9359.0888671875)
				moveto(3700.94482421875, 9012.0380859375)
				moveto(3820.63989257813, 8633.9560546875)
				moveto(3938.33251953125, 8262.7802734375)
				moveto(4068.75830078125, 7855.28125)
				moveto(3967.892578125, 7408.26171875)
				moveto(3515.6474609375, 7218.08056640625)
				moveto(3088.00341796875, 7051.79541015625)
				moveto(2703.75146484375, 6872.7724609375)
				moveto(2345.61547851563, 6677.353515625)
				moveto(2027.92504882813, 6458.07373046875)
				moveto(1762.56274414063, 6179.1826171875)
				moveto(1710.5869140625, 5811.59521484375)
				moveto(1749.478515625, 5463.83984375)
				moveto(1771.69030761719, 5123.66748046875)
				moveto(1741.11645507813, 4739.955078125)
				moveto(1620.78466796875, 4388.32275390625)
				moveto(1417.06030273438, 4131.71533203125)
				moveto(1048.96875, 3978.89990234375)
				moveto(650.851623535156, 3869.30615234375)
				moveto(537.939758300781, 3580.56713867188)
				moveto(40.1657562255859, 3542.20825195313)
				moveto(-489.093566894531, 3752.56884765625)
				moveto(-640.225402832031, 3753.71264648438)
				moveto(-640.225402832031, 3753.71264648438)
				moveto(-834.969970703125, 3657.21362304688)
				moveto(-1097.12084960938, 2996.63793945313)
				moveto(-1275.85302734375, 2364.57202148438)
				moveto(-1290.58264160156, 1875.74755859375)
				moveto(-975.38720703125, 1503.01208496094)
				moveto(-587.302307128906, 1185.67102050781)
				moveto(-182.674926757813, 878.83740234375)
				moveto(235.845916748047, 604.425842285156)
				moveto(670.890747070313, 353.088073730469)
				moveto(1051.85131835938, 127.378479003906)
				moveto(1344.68774414063, -59.3420181274414)
				moveto(1609.39416503906, -231.560195922852)
				moveto(1856.71325683594, -95.5749816894531)
				moveto(2161.50170898438, -36.033821105957)
				moveto(2509.00463867188, -63.0022621154785)
				moveto(2840.01611328125, -129.865844726563)
				moveto(3261.39697265625, -266.361480712891)
				moveto(3764.32885742188, -430.865112304688)
				moveto(4257.23388671875, -591.448547363281)
				moveto(4752.890625, -752.457336425781)
				moveto(5309.21240234375, -911.053466796875)
				moveto(5858.654296875, -1047.5234375)
				moveto(6402.5146484375, -1153.16271972656)
				moveto(6941.32177734375, -1244.51318359375)
				moveto(7404.80517578125, -1433.50842285156)
				moveto(7350.69140625, -1839.09643554688)
				moveto(7030.20654296875, -2108.61376953125)
				moveto(6815.83544921875, -2278.35668945313)
				moveto(6815.83544921875, -2278.35668945313)
				moveto(6748.55908203125, -2366.61157226563)
				moveto(6328.45166015625, -2501.04150390625)
				moveto(5823.482421875, -2552.1845703125)
				moveto(5634.97900390625, -2939.51928710938)
				moveto(5675.6728515625, -3427.07592773438)
				moveto(5758.1494140625, -3998.13598632813)
				moveto(5889.72314453125, -4707.5224609375)
				moveto(6218.08544921875, -5233.54541015625)
				moveto(6681.427734375, -5339.77734375)
				moveto(7126.94921875, -5343.45263671875)
				moveto(7556.546875, -5337.80224609375)
				moveto(7947.3408203125, -5270.9609375)
				moveto(8229.6171875, -5054.5703125)
				moveto(8075.7177734375, -4664.0263671875)
				moveto(7506.99072265625, -4303.58251953125)
				moveto(7052.81005859375, -4108.4365234375)
				moveto(6704.859375, -4139.23486328125)
				moveto(6742.68017578125, -4537.0244140625)
				moveto(7219.60888671875, -4569.6806640625)
				moveto(7667.59228515625, -4350.32666015625)
				moveto(8096.8359375, -4130.49658203125)
				moveto(8572.78125, -4267.55224609375)
				moveto(8991.6162109375, -4550.9208984375)
				moveto(9394.1025390625, -4965.14892578125)
				moveto(9236.4501953125, -5562.302734375)
				moveto(8937.546875, -6123.43798828125)
				moveto(8630.1748046875, -6673.458984375)
				moveto(8337.0634765625, -7218.55859375)
				moveto(8070.58984375, -7768.03076171875)
				moveto(8169.9169921875, -8358.048828125)
				moveto(8295.5263671875, -8925.74609375)
				moveto(8415.921875, -9465.9931640625)
				moveto(8301.6826171875, -9960.962890625)
				moveto(7797.17822265625, -10331.787109375)
				moveto(7148.45166015625, -10270.1240234375)
				moveto(6575.65625, -9985.0068359375)
				moveto(6034.8837890625, -9642.0908203125)
				moveto(5485.896484375, -9305.203125)
				moveto(4930.62841796875, -9044.8154296875)
				moveto(4398.11572265625, -8803.1474609375)
				moveto(3887.52758789063, -8565.05078125)
				moveto(3523.76538085938, -8147.43310546875)
				moveto(3161.13720703125, -7756.13671875)
				moveto(2733.26098632813, -7507.34326171875)
				moveto(2188.072265625, -7264.17529296875)
				moveto(1565.94262695313, -6926.10498046875)
				moveto(1091.18505859375, -6571.94482421875)
				moveto(707.318420410156, -6391.583984375)
				moveto(223.656188964844, -6205.5625)
				moveto(-188.808471679688, -5739.4345703125)
				moveto(-613.730407714844, -5276.01025390625)
				moveto(-994.133422851563, -4868.31494140625)
				move(-1508.54699707031, -4410.2421875)
				AdlibUnRegister("RunningBasic")
				AdlibUnRegister("RunningSpecial")
				AdlibUnRegister("Stuck")
				While getmaploading() = 1
					Sleep(100)
				WEnd
				Sleep(5000)
			EndFunc

			Func race2()
				Do
					moveto(-5668, -2804)
				Until checkarea(-5668, -2804)
				AdlibRegister("RunningBasic", 5000)
				AdlibRegister("RunningSpecial", 10000)
				moveto(-5470.37109375, -2203.48364257813)
				moveto(-5176.72705078125, -1707.71899414063)
				moveto(-4818.078125, -1178.47241210938)
				moveto(-4446.85791015625, -666.470336914063)
				moveto(-4069.03247070313, -166.326263427734)
				moveto(-3696.08374023438, 338.075225830078)
				moveto(-3820.29907226563, 858.65380859375)
				moveto(-4340.5625, 1162.28247070313)
				moveto(-4837.845703125, 1610.74304199219)
				moveto(-5067.40673828125, 2278.16015625)
				moveto(-5092.75634765625, 2914.9091796875)
				moveto(-5096.3603515625, 3485.36645507813)
				moveto(-5081.21044921875, 4048.96435546875)
				moveto(-5047.30126953125, 4614.58837890625)
				moveto(-4895.08447265625, 5141.81884765625)
				moveto(-4695.9052734375, 5740.751953125)
				moveto(-4360.25341796875, 6345.56396484375)
				moveto(-3993.60302734375, 6904.83740234375)
				moveto(-3674.77514648438, 7353.14013671875)
				moveto(-3548.51684570313, 7859.35693359375)
				moveto(-3331.2451171875, 8518.8203125)
				moveto(-3069.6337890625, 9199.556640625)
				moveto(-2813.75561523438, 9778.984375)
				moveto(-2467.8310546875, 10274.92578125)
				moveto(-1952.71826171875, 10624.6083984375)
				moveto(-1386.36669921875, 10858.3388671875)
				moveto(-1038.74230957031, 11302.5478515625)
				moveto(-1466.27111816406, 11651.98046875)
				moveto(-1658.82275390625, 12174.9541015625)
				moveto(-1272.26611328125, 12696.359375)
				moveto(-718.338256835938, 13131.1123046875)
				moveto(-116.14372253418, 13503.1279296875)
				moveto(500.882873535156, 13818.8271484375)
				moveto(1105.06884765625, 14125.4033203125)
				moveto(1644.18286132813, 14214.7138671875)
				moveto(2103.45751953125, 13961.4599609375)
				moveto(2342.95434570313, 13570.37109375)
				moveto(2557.65502929688, 13212.5556640625)
				moveto(2791.25756835938, 12898.517578125)
				moveto(3027.75341796875, 12577.5986328125)
				moveto(3248.720703125, 12186.369140625)
				moveto(3285.66772460938, 11731.9052734375)
				moveto(3269.1875, 11301.904296875)
				moveto(3255.67602539063, 10893.837890625)
				moveto(3257.68701171875, 10514.8212890625)
				moveto(3318.15844726563, 10159.8974609375)
				moveto(3425.66186523438, 9787.6318359375)
				moveto(3531.34741210938, 9432.75390625)
				moveto(3633.03173828125, 9123.716796875)
				moveto(3744.40356445313, 8793.2919921875)
				moveto(3870.95629882813, 8424.2724609375)
				moveto(4038.53173828125, 7880.4794921875)
				moveto(3688.79296875, 7290.626953125)
				moveto(3255.9111328125, 7060.05810546875)
				moveto(2907.0263671875, 6894.6494140625)
				moveto(2558.32055664063, 6729.3251953125)
				moveto(2218.19995117188, 6549.25927734375)
				moveto(1952.49645996094, 6266.04150390625)
				moveto(1852.86083984375, 5853.29248046875)
				moveto(1778.19348144531, 5339.9365234375)
				moveto(1683.49975585938, 4848.998046875)
				moveto(1592.69006347656, 4361.70654296875)
				moveto(1318.4169921875, 3983.24438476563)
				moveto(953.866638183594, 3725.40966796875)
				moveto(601.05517578125, 3515.27758789063)
				moveto(132.659881591797, 3464.74169921875)
				moveto(-301.055053710938, 3716.85595703125)
				moveto(-730.945678710938, 3570.34838867188)
				moveto(-773.619262695313, 3472.71337890625)
				moveto(-773.619262695313, 3472.71337890625)
				moveto(-927.872924804688, 3257.9052734375)
				moveto(-1077.94702148438, 2848.94555664063)
				moveto(-1205.08337402344, 2475.66162109375)
				moveto(-1275.13806152344, 2083.279296875)
				moveto(-1132.78967285156, 1651.00952148438)
				moveto(-756.865173339844, 1321.72277832031)
				moveto(-310.367370605469, 953.666015625)
				moveto(189.96728515625, 567.530151367188)
				moveto(722.825866699219, 221.418365478516)
				moveto(1201.4033203125, -39.4558486938477)
				moveto(1603.6494140625, -242.407852172852)
				moveto(1884.04077148438, -80.4217529296875)
				moveto(2194.4775390625, -75.6898651123047)
				moveto(2600.4287109375, -191.267364501953)
				moveto(3288.4453125, -406.4931640625)
				moveto(3856.34936523438, -588.831359863281)
				moveto(4215.4404296875, -697.169311523438)
				moveto(4569.32177734375, -803.277404785156)
				moveto(4985.84423828125, -922.239868164063)
				moveto(5478.0615234375, -1004.97509765625)
				moveto(5950.3125, -1082.5732421875)
				moveto(6394.751953125, -1155.6015625)
				moveto(6820.46728515625, -1225.55297851563)
				moveto(7211.06005859375, -1290.2880859375)
				moveto(7417.22119140625, -1520.75024414063)
				moveto(7397.10009765625, -1825.66467285156)
				moveto(7093.4345703125, -2072.01489257813)
				moveto(6700.11962890625, -2352.60034179688)
				moveto(6239.880859375, -2528.58447265625)
				moveto(5742.6806640625, -2596.06713867188)
				moveto(5669.19580078125, -3047.5478515625)
				moveto(5714.01318359375, -3546.67431640625)
				moveto(5779.18017578125, -4044.91870117188)
				moveto(5841.41162109375, -4533.796875)
				moveto(5993.4208984375, -4976.2587890625)
				moveto(6331.435546875, -5242.4521484375)
				moveto(6753.12841796875, -5268.0693359375)
				moveto(7153.32958984375, -5301.20068359375)
				moveto(7539.876953125, -5293.70703125)
				moveto(7914.04931640625, -5261.26025390625)
				moveto(8220.8388671875, -4810.94580078125)
				moveto(7625.55712890625, -4451.65234375)
				moveto(7279.4482421875, -4232.70654296875)
				moveto(6819.34228515625, -4146.22509765625)
				moveto(6924.14453125, -4566.46240234375)
				moveto(7461.30712890625, -4451.3974609375)
				moveto(7987.02587890625, -4227.154296875)
				moveto(8535.13671875, -4289.544921875)
				moveto(9027.2763671875, -4590.79052734375)
				moveto(9410.2451171875, -4994.1953125)
				moveto(9455.716796875, -5530.80712890625)
				moveto(9198.337890625, -5995.6962890625)
				moveto(8925.1826171875, -6435.1123046875)
				moveto(8577.580078125, -6934.2841796875)
				moveto(8167.109375, -7511.43212890625)
				moveto(8077.12060546875, -8093.400390625)
				moveto(8212.330078125, -8533.4072265625)
				moveto(8321.640625, -8954.2099609375)
				moveto(8391.0205078125, -9354.146484375)
				moveto(8428.927734375, -9739.3095703125)
				moveto(8236.2041015625, -10079.7626953125)
				moveto(7834.35791015625, -10267.51171875)
				moveto(7312.2255859375, -10271.4033203125)
				moveto(6766.33544921875, -10140.1220703125)
				moveto(6239.8466796875, -9905.3193359375)
				moveto(5755.25439453125, -9614.267578125)
				moveto(5290.630859375, -9314.9931640625)
				moveto(4770.28466796875, -9010.724609375)
				moveto(4117.03515625, -8689.08203125)
				moveto(3613.03759765625, -8303.5048828125)
				moveto(3240.74877929688, -7968.04541015625)
				moveto(2879.02807617188, -7672.64404296875)
				moveto(2520.33349609375, -7449.59228515625)
				moveto(2206.638671875, -7277.3505859375)
				moveto(1937.8115234375, -7105.35107421875)
				moveto(1411.46850585938, -6722.2099609375)
				moveto(871.271362304688, -6334.04833984375)
				moveto(497.658294677734, -6307.0625)
				moveto(113.552917480469, -6085.138671875)
				moveto(-315.519409179688, -5631.0283203125)
				moveto(-715.401306152344, -5148.45458984375)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				moveto(-1322.26086425781, -4541.7373046875)
				move(-1322.26086425781, -4541.7373046875)
				AdlibUnRegister("RunningBasic")
				AdlibUnRegister("RunningSpecial")
				While getmaploading() = 1
					Sleep(100)
				WEnd
				Sleep(5000)
			EndFunc

			Func runningbasic()
				Local $rnd = Random(1, 3, 1)
				If DllStructGetData(getskillbar(), "Recharge" & $rnd) = 0 Then
					useskill($rnd, 0)
				EndIf
			EndFunc

			Func runningspecial()
				For $i = 4 To 8
					If DllStructGetData(getskillbar(), "Recharge" & $i) = 0 Then useskill($i, 0)
				Next
			EndFunc
